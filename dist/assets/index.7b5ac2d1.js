var sr=Object.defineProperty;var ar=(s,i,a)=>i in s?sr(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a;var Ct=(s,i,a)=>(ar(s,typeof i!="symbol"?i+"":i,a),a);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const g of l)if(g.type==="childList")for(const f of g.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function a(l){const g={};return l.integrity&&(g.integrity=l.integrity),l.referrerpolicy&&(g.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?g.credentials="include":l.crossorigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function c(l){if(l.ep)return;l.ep=!0;const g=a(l);fetch(l.href,g)}})();function K(){}function gn(s){return s()}function rn(){return Object.create(null)}function Se(s){s.forEach(gn)}function Dt(s){return typeof s=="function"}function xe(s,i){return s!=s?i==i:s!==i||s&&typeof s=="object"||typeof s=="function"}function cr(s){return Object.keys(s).length===0}function lr(s){return s&&Dt(s.destroy)?s.destroy:K}function L(s,i){s.appendChild(i)}function te(s,i,a){s.insertBefore(i,a||null)}function H(s){s.parentNode&&s.parentNode.removeChild(s)}function Nt(s,i){for(let a=0;a<s.length;a+=1)s[a]&&s[a].d(i)}function F(s){return document.createElement(s)}function Ie(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Re(s){return document.createTextNode(s)}function le(){return Re(" ")}function fr(){return Re("")}function re(s,i,a,c){return s.addEventListener(i,a,c),()=>s.removeEventListener(i,a,c)}function R(s,i,a){a==null?s.removeAttribute(i):s.getAttribute(i)!==a&&s.setAttribute(i,a)}function _n(s){return s===""?null:+s}function hr(s){return Array.from(s.childNodes)}function on(s,i){i=""+i,s.wholeText!==i&&(s.data=i)}function Ye(s,i){s.value=i==null?"":i}function he(s,i,a,c){a===null?s.style.removeProperty(i):s.style.setProperty(i,a,c?"important":"")}function _e(s,i,a){s.classList[a?"add":"remove"](i)}function pr(s,i,{bubbles:a=!1,cancelable:c=!1}={}){const l=document.createEvent("CustomEvent");return l.initCustomEvent(s,a,c,i),l}let it;function ot(s){it=s}function bn(){if(!it)throw new Error("Function called outside component initialization");return it}function wn(s){bn().$$.on_mount.push(s)}function kn(){const s=bn();return(i,a,{cancelable:c=!1}={})=>{const l=s.$$.callbacks[i];if(l){const g=pr(i,a,{cancelable:c});return l.slice().forEach(f=>{f.call(s,g)}),!g.defaultPrevented}return!0}}const Je=[],Qe=[],dt=[],qt=[],dr=Promise.resolve();let At=!1;function yr(){At||(At=!0,dr.then(xn))}function jt(s){dt.push(s)}function Tt(s){qt.push(s)}const Et=new Set;let Ge=0;function xn(){if(Ge!==0)return;const s=it;do{try{for(;Ge<Je.length;){const i=Je[Ge];Ge++,ot(i),mr(i.$$)}}catch(i){throw Je.length=0,Ge=0,i}for(ot(null),Je.length=0,Ge=0;Qe.length;)Qe.pop()();for(let i=0;i<dt.length;i+=1){const a=dt[i];Et.has(a)||(Et.add(a),a())}dt.length=0}while(Je.length);for(;qt.length;)qt.pop()();At=!1,Et.clear(),ot(s)}function mr(s){if(s.fragment!==null){s.update(),Se(s.before_update);const i=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,i),s.after_update.forEach(jt)}}const yt=new Set;let Be;function Rt(){Be={r:0,c:[],p:Be}}function Qt(){Be.r||Se(Be.c),Be=Be.p}function fe(s,i){s&&s.i&&(yt.delete(s),s.i(i))}function pe(s,i,a,c){if(s&&s.o){if(yt.has(s))return;yt.add(s),Be.c.push(()=>{yt.delete(s),c&&(a&&s.d(1),c())}),s.o(i)}else c&&c()}const Cn=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function St(s,i,a){const c=s.$$.props[i];c!==void 0&&(s.$$.bound[c]=a,a(s.$$.ctx[c]))}function je(s){s&&s.c()}function Te(s,i,a,c){const{fragment:l,after_update:g}=s.$$;l&&l.m(i,a),c||jt(()=>{const f=s.$$.on_mount.map(gn).filter(Dt);s.$$.on_destroy?s.$$.on_destroy.push(...f):Se(f),s.$$.on_mount=[]}),g.forEach(jt)}function Ee(s,i){const a=s.$$;a.fragment!==null&&(Se(a.on_destroy),a.fragment&&a.fragment.d(i),a.on_destroy=a.fragment=null,a.ctx=[])}function vr(s,i){s.$$.dirty[0]===-1&&(Je.push(s),yr(),s.$$.dirty.fill(0)),s.$$.dirty[i/31|0]|=1<<i%31}function Oe(s,i,a,c,l,g,f,v=[-1]){const T=it;ot(s);const w=s.$$={fragment:null,ctx:[],props:g,update:K,not_equal:l,bound:rn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(T?T.$$.context:[])),callbacks:rn(),dirty:v,skip_bound:!1,root:i.target||T.$$.root};f&&f(w.root);let C=!1;if(w.ctx=a?a(s,i.props||{},(k,S,...D)=>{const Q=D.length?D[0]:S;return w.ctx&&l(w.ctx[k],w.ctx[k]=Q)&&(!w.skip_bound&&w.bound[k]&&w.bound[k](Q),C&&vr(s,k)),S}):[],w.update(),C=!0,Se(w.before_update),w.fragment=c?c(w.ctx):!1,i.target){if(i.hydrate){const k=hr(i.target);w.fragment&&w.fragment.l(k),k.forEach(H)}else w.fragment&&w.fragment.c();i.intro&&fe(s.$$.fragment),Te(s,i.target,i.anchor,i.customElement),xn()}ot(T)}class qe{$destroy(){Ee(this,1),this.$destroy=K}$on(i,a){if(!Dt(a))return K;const c=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return c.push(a),()=>{const l=c.indexOf(a);l!==-1&&c.splice(l,1)}}$set(i){this.$$set&&!cr(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const Ke=[];function mt(s,i=K){let a;const c=new Set;function l(v){if(xe(s,v)&&(s=v,a)){const T=!Ke.length;for(const w of c)w[1](),Ke.push(w,s);if(T){for(let w=0;w<Ke.length;w+=2)Ke[w][0](Ke[w+1]);Ke.length=0}}}function g(v){l(v(s))}function f(v,T=K){const w=[v,T];return c.add(w),c.size===1&&(a=i(l)||K),v(s),()=>{c.delete(w),c.size===0&&(a(),a=null)}}return{set:l,update:g,subscribe:f}}var ze={exports:{}},Tn={exports:{}};/*! For license information please see jsstore.commonjs2.min.js.LICENSE.txt */(()=>{var s={d:(y,d)=>{for(var _ in d)s.o(d,_)&&!s.o(y,_)&&Object.defineProperty(y,_,{enumerable:!0,get:d[_]})},o:(y,d)=>Object.prototype.hasOwnProperty.call(y,d),r:y=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(y,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(y,"__esModule",{value:!0})}},i={};s.r(i),s.d(i,{API:()=>l,CONNECTION_STATUS:()=>w,Connection:()=>ce,DATA_TYPE:()=>c,ERROR_TYPE:()=>k,EVENT:()=>g,IDB_MODE:()=>v,OCCURENCE:()=>T,QUERY_OPTION:()=>f,WORKER_STATUS:()=>a,forObj:()=>ge,promise:()=>D,promiseAll:()=>Ce,promiseResolve:()=>Q});var a,c,l,g,f,v,T,w,C=function(){function y(d,_){this.type=d,this._info=_,this.message=this.getMsg()}return y.prototype.throw=function(){throw this},y.prototype.log=function(d){this.status&&console.log(d)},y.prototype.logError=function(){console.error(this.get())},y.prototype.logWarning=function(){console.warn(this.get())},y.prototype.get=function(){return{message:this.message,type:this.type}},y.prototype.getMsg=function(){return this.type,this.message},y}(),k={InvalidUpdateColumn:"invalid_update_column",UndefinedColumn:"undefined_column",UndefinedValue:"undefined_value",UndefinedColumnName:"undefined_column_name",UndefinedDbName:"undefined_database_name",UndefinedColumnValue:"undefined_column_value",NotArray:"not_array",NoValueSupplied:"no_value_supplied",ColumnNotExist:"column_not_exist",NoIndexFound:"no_index_found",InvalidOp:"invalid_operator",NullValue:"null_value",WrongDataType:"wrong_data_type",TableNotExist:"table_not_exist",DbNotExist:"db_not_exist",ConnectionAborted:"connection_aborted",ConnectionClosed:"connection_closed",NotObject:"not_object",InvalidConfig:"invalid_config",DbBlocked:"Db_blocked",IndexedDbNotSupported:"indexeddb_not_supported",NullValueInWhere:"null_value_in_where",InvalidJoinQuery:"invalid_join_query",InvalidQuery:"invalid_query",ImportScriptsFailed:"import_scripts_failed",MethodNotExist:"method_not_exist",Unknown:"unknown",InvalidMiddleware:"invalid_middleware"};(function(y){y.Registered="registerd",y.Failed="failed",y.NotStarted="not_started"})(a||(a={})),function(y){y.String="string",y.Object="object",y.Array="array",y.Number="number",y.Boolean="boolean",y.Null="null",y.DateTime="date_time"}(c||(c={})),function(y){y.InitDb="init_db",y.Get="get",y.Set="set",y.Select="select",y.Insert="insert",y.Update="update",y.Remove="remove",y.OpenDb="open_db",y.Clear="clear",y.DropDb="drop_db",y.Count="count",y.ChangeLogStatus="change_log_status",y.Terminate="terminate",y.Transaction="transaction",y.CloseDb="close_db",y.Union="union",y.Intersect="intersect",y.ImportScripts="import_scripts",y.Middleware="middleware"}(l||(l={})),function(y){y.RequestQueueEmpty="requestQueueEmpty",y.RequestQueueFilled="requestQueueFilled",y.Upgrade="upgrade",y.Create="create",y.Open="open"}(g||(g={})),function(y){y.Where="where",y.Like="like",y.Regex="regex",y.In="in",y.Equal="=",y.Between="-",y.GreaterThan=">",y.LessThan="<",y.GreaterThanEqualTo=">=",y.LessThanEqualTo="<=",y.NotEqualTo="!=",y.Aggregate="aggregate",y.Max="max",y.Min="min",y.Avg="avg",y.Count="count",y.Sum="sum",y.List="list",y.Or="or",y.Skip="skip",y.Limit="limit",y.And="and",y.IgnoreCase="ignoreCase",y.Then="then"}(f||(f={})),function(y){y.ReadOnly="readonly",y.ReadWrite="readwrite"}(v||(v={})),function(y){y.First="f",y.Last="l",y.Any="a"}(T||(T={})),function(y){y.Connected="connected",y.Closed="closed",y.NotStarted="not_started",y.UnableToStart="unable_to_start",y.ClosedByJsStore="closed_by_jsstore"}(w||(w={}));var S,D=function(y){return new Promise(y)},Q=function(y){return Promise.resolve(y)},j=function(y,d,_){if(_||arguments.length===2)for(var O,$=0,J=d.length;$<J;$++)!O&&$ in d||(O||(O=Array.prototype.slice.call(d,0,$)),O[$]=d[$]);return y.concat(O||Array.prototype.slice.call(d))},W=function(){function y(d){this._events={},this._ctx=d}return y.prototype.on=function(d,_){return this._events[d]==null&&(this._events[d]=[]),this._events[d].push(_),this},y.prototype.off=function(d,_){if(this._events[d])if(_){var O=this._events[d].indexOf(_);this._events[d].splice(O,1)}else this._events[d]=[]},y.prototype.emit=function(d){for(var _=this,O=[],$=1;$<arguments.length;$++)O[$-1]=arguments[$];var J=this._events[d]||[],oe=0,B=J.length,U=[],Y=function(){var q=J[oe++];if(q){var ie=q.call.apply(q,j([_._ctx],O,!1));return ie&&ie.then?ie:Promise.resolve(ie)}};return new Promise(function(q){var ie=function(){oe<B?Y().then(function(de){U.push(de),ie()}):q(U)};ie()})},y.prototype.destroy=function(){this._events=null,this._ctx=null},y}(),P=function(){function y(d){this.isConOpened_=!1,this.isDbIdle_=!0,this.requestQueue_=[],this.isCodeExecuting_=!1,this.inactivityTimer_=-1e3,this.middlewares=[],this.eventBus_=new W(this),this.whiteListApi_=[l.InitDb,l.OpenDb,l.Get,l.Set,l.ChangeLogStatus,l.Terminate,l.DropDb],this.isWorker=!0,this.logger=new C(null),d?(this.worker_=d,this.worker_.onmessage=this.onMessageFromWorker_.bind(this)):(this.isWorker=!1,this.initQueryManager_())}return Object.defineProperty(y.prototype,"jsstoreWorker",{get:function(){return this.$worker||self.JsStoreWorker},enumerable:!1,configurable:!0}),y.prototype.initQueryManager_=function(){var d=this.jsstoreWorker;d&&(this.queryManager=new d.QueryManager(this.processFinishedQuery_.bind(this)))},y.prototype.onMessageFromWorker_=function(d){this.processFinishedQuery_(d.data)},y.prototype.processFinishedQuery_=function(d){var _=this.requestQueue_.shift();if(_){if(this.logger.log("request ".concat(_.name," finished")),d.error)_.onError(d.error);else{switch(_.name){case l.OpenDb:case l.InitDb:this.isConOpened_=!0;break;case l.Terminate:this.isConOpened_=!1,this.isWorker===!0&&this.worker_.terminate();case l.DropDb:this.isConOpened_=!1,this.requestQueue_=[],this.isDbIdle_=!0;break;case l.CloseDb:this.requestQueue_.length>0?this.openDb_():(this.isDbIdle_=!0,this.eventBus_.emit(g.RequestQueueEmpty,[]))}_.onSuccess(d.result)}this.isCodeExecuting_=!1,this.executeQry_()}},y.prototype.openDb_=function(){this.prcoessExecutionOfQry_({name:l.OpenDb,query:{name:this.database.name,version:this.database.version},onSuccess:function(){},onError:function(d){console.error(d)}},0)},y.prototype.executeMiddleware_=function(d){var _=this;return D(function(O){var $=0,J=_.middlewares.length-1,oe=function(){if($<=J){var B=_.middlewares[$++](d);B&&B.then||(B=Q(B)),B.then(function(U){oe()})}else O()};oe()})},y.prototype.callResultMiddleware=function(d,_){return D(function(O){var $=0,J=d.length-1,oe=function(){if($<=J){var B=d[$++](_);B.then||(B=Q(B)),B.then(function(U){_=U,oe()})}else O(_)};oe()})},y.prototype.pushApi=function(d){var _=this;return new Promise(function(O,$){var J=[];d.onResult=function(oe){J.push(function(B){return oe(B)})},_.executeMiddleware_(d).then(function(){d.onSuccess=function(oe){_.callResultMiddleware(J,oe).then(function(B){O(B)}).catch(function(B){d.onError(B)})},d.onError=function(oe){J=[],$(oe)},_.requestQueue_.length===0&&(_.eventBus_.emit(g.RequestQueueFilled,[]),[l.CloseDb,l.DropDb,l.OpenDb,l.Terminate].indexOf(d.name)>=0||!_.isDbIdle_||!_.isConOpened_?clearTimeout(_.inactivityTimer_):_.openDb_()),_.prcoessExecutionOfQry_(d)}).catch($)})},y.prototype.prcoessExecutionOfQry_=function(d,_){this.isDbIdle_=!1,_!=null?this.requestQueue_.splice(_,0,d):this.requestQueue_.push(d),this.logger.log("request pushed: "+d.name),this.executeQry_()},y.prototype.executeQry_=function(){var d=this,_=this.requestQueue_.length;if(!this.isCodeExecuting_&&_>0){if(this.isConOpened_===!0)return void this.sendRequestToWorker_(this.requestQueue_[0]);var O=this.requestQueue_.findIndex(function($){return d.whiteListApi_.indexOf($.name)>=0});O>=0&&(this.requestQueue_.splice(0,0,this.requestQueue_.splice(O,1)[0]),this.sendRequestToWorker_(this.requestQueue_[0]))}else _===0&&this.isDbIdle_===!1&&this.isConOpened_&&(this.inactivityTimer_=setTimeout(function(){d.prcoessExecutionOfQry_({name:l.CloseDb,onSuccess:function(){},onError:function($){console.error($)}})},100))},y.prototype.sendRequestToWorker_=function(d){this.isCodeExecuting_=!0,this.logger.log("request executing: "+d.name);var _={name:d.name,query:d.query};this.isWorker===!0?this.worker_.postMessage(_):this.queryManager.run(_)},y}(),z=(S=function(y,d){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,O){_.__proto__=O}||function(_,O){for(var $ in O)Object.prototype.hasOwnProperty.call(O,$)&&(_[$]=O[$])},S(y,d)},function(y,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function _(){this.constructor=y}S(y,d),y.prototype=d===null?Object.create(d):(_.prototype=d.prototype,new _)}),ce=function(y){function d(_){return y.call(this,_)||this}return z(d,y),d.prototype.initDb=function(_){var O=this;return this.database=_,this.pushApi({name:l.InitDb,query:_}).then(function($){var J,oe=$.database;return $.isCreated&&(J=$.oldVersion?O.eventBus_.emit(g.Upgrade,oe,$.oldVersion,$.newVersion):O.eventBus_.emit(g.Create,oe)),(J||Q()).then(function(B){return O.eventBus_.emit(g.Open,oe)}).then(function(B){return $.isCreated})})},d.prototype.dropDb=function(){return this.pushApi({name:l.DropDb})},d.prototype.select=function(_){return this.pushApi({name:l.Select,query:_})},d.prototype.count=function(_){return this.pushApi({name:l.Count,query:_})},d.prototype.insert=function(_){return this.pushApi({name:l.Insert,query:_})},d.prototype.update=function(_){return this.pushApi({name:l.Update,query:_})},d.prototype.remove=function(_){return this.pushApi({name:l.Remove,query:_})},d.prototype.clear=function(_){return this.pushApi({name:l.Clear,query:_})},Object.defineProperty(d.prototype,"logStatus",{set:function(_){this.logger.status=_,this.pushApi({name:l.ChangeLogStatus,query:_})},enumerable:!1,configurable:!0}),d.prototype.openDb=function(_,O){var $=this;return this.pushApi({name:l.OpenDb,query:{version:O,name:_}}).then(function(J){return $.database=J,J})},d.prototype.getDbList=function(){return console.warn("Api getDbList is recommended to use for debugging only. Do not use in code."),indexedDB.databases()},d.prototype.get=function(_){return this.pushApi({name:l.Get,query:_})},d.prototype.set=function(_,O){return this.pushApi({name:l.Set,query:{key:_,value:O}})},d.prototype.terminate=function(){return this.pushApi({name:l.Terminate})},d.prototype.transaction=function(_){return this.pushApi({name:l.Transaction,query:_})},d.prototype.on=function(_,O){this.eventBus_.on(_,O)},d.prototype.off=function(_,O){this.eventBus_.off(_,O)},d.prototype.union=function(_){return this.pushApi({name:l.Union,query:_})},d.prototype.intersect=function(_){return this.pushApi({name:l.Intersect,query:_})},d.prototype.addPlugin=function(_,O){return _.setup(this,O)},d.prototype.addMiddleware=function(_,O){return O?this.pushApi({name:l.Middleware,query:_}):(this.middlewares.push(_),Promise.resolve())},d.prototype.importScripts=function(){for(var _=[],O=0;O<arguments.length;O++)_[O]=arguments[O];return this.pushApi({name:l.ImportScripts,query:_})},d}(P),Ce=function(y){return Promise.all(y)},ge=function(y,d){for(var _ in y)d(_,y[_])};Tn.exports=i})();(function(s){s.exports=Tn.exports})(ze);var Ot={exports:{}};/*! For license information please see jsstore.worker.commonjs2.min.js.LICENSE.txt */var un;function gr(){return un||(un=1,(()=>{var s={d:(n,t)=>{for(var e in t)s.o(t,e)&&!s.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})},o:(n,t)=>Object.prototype.hasOwnProperty.call(n,t),r:n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}},i={};s.r(i),s.d(i,{QueryManager:()=>tn});var a,c,l,g,f,v,T,w,C=function(n){return Promise.resolve(n)},k=function(n){return new Promise(n)},S="not_array",D="no_value_supplied",Q="column_not_exist",j="no_index_found",W="null_value",P="wrong_data_type",z="table_not_exist",ce="not_object",Ce="Db_blocked",ge="indexeddb_not_supported",y="null_value_in_where",d="invalid_join_query",_="import_scripts_failed",O="method_not_exist",$="invalid_middleware";(function(n){n.Registered="registerd",n.Failed="failed",n.NotStarted="not_started"})(a||(a={})),function(n){n.String="string",n.Object="object",n.Array="array",n.Number="number",n.Boolean="boolean",n.Null="null",n.DateTime="date_time"}(c||(c={})),function(n){n.InitDb="init_db",n.Get="get",n.Set="set",n.Select="select",n.Insert="insert",n.Update="update",n.Remove="remove",n.OpenDb="open_db",n.Clear="clear",n.DropDb="drop_db",n.Count="count",n.ChangeLogStatus="change_log_status",n.Terminate="terminate",n.Transaction="transaction",n.CloseDb="close_db",n.Union="union",n.Intersect="intersect",n.ImportScripts="import_scripts",n.Middleware="middleware"}(l||(l={})),function(n){n.RequestQueueEmpty="requestQueueEmpty",n.RequestQueueFilled="requestQueueFilled",n.Upgrade="upgrade",n.Create="create",n.Open="open"}(g||(g={})),function(n){n.Where="where",n.Like="like",n.Regex="regex",n.In="in",n.Equal="=",n.Between="-",n.GreaterThan=">",n.LessThan="<",n.GreaterThanEqualTo=">=",n.LessThanEqualTo="<=",n.NotEqualTo="!=",n.Aggregate="aggregate",n.Max="max",n.Min="min",n.Avg="avg",n.Count="count",n.Sum="sum",n.List="list",n.Or="or",n.Skip="skip",n.Limit="limit",n.And="and",n.IgnoreCase="ignoreCase",n.Then="then"}(f||(f={})),function(n){n.ReadOnly="readonly",n.ReadWrite="readwrite"}(v||(v={})),function(n){n.First="f",n.Last="l",n.Any="a"}(T||(T={})),function(n){n.Connected="connected",n.Closed="closed",n.NotStarted="not_started",n.UnableToStart="unable_to_start",n.ClosedByJsStore="closed_by_jsstore"}(w||(w={}));var J,oe=function(){function n(t){this.columns=[],this.autoIncColumnValue={},this.columns=this.setColumn(t.columns),this.name=t.name,this.alter=t.alter||{}}return n.prototype.setColumn=function(t){var e=[],r=function(h){var p=t[h];p.name=h,p.autoIncrement&&(o.autoIncColumnValue[h]=0),p.primaryKey&&(o.primaryKey=h),p.enableSearch=p.enableSearch==null||p.enableSearch;var m=o.columns.indexOf(function(x){return x.name===h});if(m<0)e.push(p);else{var b=o.columns[m];Object.assign(b,p)}},o=this;for(var u in t)r(u);return e},n}(),B=function(){function n(){}return n.autoIncrementKey=function(t,e){return"JsStore_".concat(t,"_").concat(e,"_Value")},n.set=function(t,e,r){r.tx||r.createTransaction([n.tableName]);var o=r.objectStore(n.tableName);return k(function(u,h){var p=o.put({key:t,value:e});p.onsuccess=function(){u()},p.onerror=h})},n.get=function(t,e){e.tx||e.createTransaction([n.tableName]);var r=e.objectStore(n.tableName);return k(function(o,u){var h=r.get(e.keyRange(t));h.onsuccess=function(){var p=h.result;o(p&&p.value)},h.onerror=u})},n.remove=function(t,e){e.tx||e.createTransaction([n.tableName]);var r=e.objectStore(n.tableName);return k(function(o,u){var h=r.delete(e.keyRange(t));h.onsuccess=o,h.onerror=u})},n.tableName="JsStore_Meta",n.dbSchema="JsStore_DbSchema",n}(),U=function(n){this.name=n.name,this.version=n.version||1,n.tables.push({name:B.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=n.tables.map(function(t){return new oe(t)})},Y=function(n,t){for(var e in n)t(e,n[e])},q=function(){function n(t,e){this.type=t,this.info_=e,this.message=this.getMsg_()}return n.prototype.log=function(t){this.status&&console.log(t)},n.prototype.throw=function(){throw this.get()},n.prototype.logError=function(){console.error(this.get())},n.prototype.get=function(){return{message:this.message,type:this.type}},n.prototype.getMsg_=function(){var t,e,r=this.info_,o=((t={}).not_array=function(){e="Supplied value is not an array"},t.undefined_column=function(){e="Column is undefined in Where"},t.undefined_value=function(){e="Value is undefined in Where"},t.undefined_column_name=function(){e="Column name is undefined '"+r.TableName+"'"},t.undefined_database_name=function(){e="Database name is not supplied"},t.undefined_column_value=function(){e="Column value is undefined"},t.no_value_supplied=function(){e="No value is supplied"},t.invalid_operator=function(){e="Invalid Op Value '"+r.Op+"'"},t.column_not_exist=function(){var p=r.column;e=r.isOrder?"Column '".concat(p,"' in order query does not exist"):"Column '".concat(p,"' does not exist")},t.no_index_found=function(){e="No index found for column '"+r.column+"'. Query can not be executed without index."},t.null_value=function(){e="Null value is not allowed for column '"+r.ColumnName+"'"},t.wrong_data_type=function(){e="Supplied value for column '"+r.column+"' have wrong data type"},t.table_not_exist=function(){e="Table '"+r.tableName+"' does not exist"},t.db_not_exist=function(){e="Database with name ".concat(r.dbName," does not exist")},t.not_object=function(){e="supplied value is not object"},t.invalid_operator=function(){e="Invalid Config '"+r.Config+" '"},t.Db_blocked=function(){e="database is blocked, cant be deleted right now"},t.null_value_in_where=function(){e="Null/undefined is not allowed in where. Column '".concat(r.column,"' has null")},t.method_not_exist=function(){e="method '".concat(r,"' does not exist.")},t.indexeddb_not_supported=function(){e="Browser does not support indexeddb"},t.getInfo=function(){e=r},t.invalid_join_query=function(){o.getInfo()},t.import_scripts_failed=function(){o.getInfo()},t.invalid_middleware=function(){e="No function ".concat(r," is found.")},t),u=this.type,h=o[u];return h?h():(u||(this.type="unknown"),e=this.message),e},n}(),ie=function(){function n(){this.logger=new q(null)}return n.prototype.emptyTx=function(){this.tx&&(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},n.prototype.createTransactionIfNotExist=function(t,e){this.tx||this.createTransaction(t,e)},n.prototype.createTransaction=function(t,e){var r=this;return e===void 0&&(e=v.ReadWrite),this.tx=this.con.transaction(t,e),k(function(o,u){r.tx.oncomplete=o,r.tx.onabort=o,r.tx.onerror=u})},n.prototype.keyRange=function(t,e){var r;switch(e){case f.Between:r=IDBKeyRange.bound(t.low,t.high,!1,!1);break;case f.GreaterThan:r=IDBKeyRange.lowerBound(t,!0);break;case f.GreaterThanEqualTo:r=IDBKeyRange.lowerBound(t);break;case f.LessThan:r=IDBKeyRange.upperBound(t,!0);break;case f.LessThanEqualTo:r=IDBKeyRange.upperBound(t);break;default:r=IDBKeyRange.only(t)}return r},n.prototype.objectStore=function(t){return this.tx.objectStore(t)},n.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},n.prototype.close=function(){var t=this;return this.con&&this.con.close(),k(function(e){t.con=null,setTimeout(e,100)})},n.prototype.initDb=function(t){var e,r=this,o=!1,u=t.version;return k(function(h,p){var m=indexedDB.open(t.name,u);m.onsuccess=function(){r.con=m.result,r.con.onversionchange=function(b){b.target.close()},h({isCreated:o,oldVersion:e,newVersion:u})},m.onerror=function(b){console.error("error",b),p(b)},m.onupgradeneeded=function(b){e=b.oldVersion;var x=b.target,E=x.result;o=!0;var A=x.transaction,M=E.objectStoreNames,I=function(Z,V){var G=V.name;if(V.enableSearch&&!Z.indexNames.contains(G)){var ae=V.primaryKey?{unique:!0}:{unique:V.unique};ae.multiEntry=V.multiEntry;var ne=V.keyPath==null?G:V.keyPath;Z.createIndex(G,ne,ae)}},N=function(Z,V,G){var ae=V.columns.findIndex(function(ne){return ne.name===G});ae>=0&&(V.columns.splice(ae,1),Z.deleteIndex(G))};t.tables.forEach(function(Z){if(!M.contains(Z.name))return function(ne){var ve=ne.primaryKey?{keyPath:ne.primaryKey}:{autoIncrement:!0},be=E.createObjectStore(ne.name,ve);ne.columns.forEach(function(rt){I(be,rt)})}(Z);for(var V=A.objectStore(Z.name),G=e+1;G<=u;G++){var ae=Z.alter[G];ae&&(ae.add&&Z.setColumn(ae.add).forEach(function(ne){I(V,ne),Z.columns.push(ne)}),Y(ae.drop||{},function(ne){N(V,Z,ne)}),Y(ae.modify||{},function(ne,ve){var be=ve.multiEntry||ve.keyPath||ve.unique,rt=Z.columns.find(function(xt){return xt.name===ne}),we=Object.assign(rt,ve);we.name=ne,be&&(N(V,Z,ne),I(V,we),Z.columns.push(we))}))}});for(var X=function(Z,V){var G=M.item(Z);t.tables.findIndex(function(ae){return ae.name===G})<0&&E.deleteObjectStore(G)},me=0,De=M.length;me<De;me++)X(me)}})},n}(),de=function(n){return Promise.all(n)},ye=function(n){return Promise.reject(n)},ut=function(n){if(n instanceof q)return n.logError(),n.get();var t=void 0;return n.name?(t=new q(n.name)).message=n.message:(t=new q(n.target.error.name)).message=n.target.error.message,t.get()},We=function(){function n(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return Object.defineProperty(n.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),n.prototype.table=function(t){var e=t||this.tableName;return this.db.tables.find(function(r){return r.name===e})},n.prototype.primaryKey=function(t){var e=this.query;return!e.from&&e.store&&e.meta?e.meta.primaryKey:this.table(t).primaryKey},n.prototype.getColumnInfo=function(t,e){return this.table(e).columns.find(function(r){return r.name===t})},n.prototype.onException=function(t,e){return console.error(t),this.util.abortTransaction(),ye(function(r,o){return o===void 0&&(o="invalid_query"),r.name=o,ut(r)}(t,e))},n}(),ue=function(n){if(n==null)return c.Null;var t=typeof n;if(t==="object"){if(Array.isArray(n))return c.Array;if(n instanceof Date)return c.DateTime}return t},He=function(n){return n==null||typeof n=="number"&&isNaN(n)},qn=function(){function n(t,e){this.table=t,this.autoIncrementValue=e}return n.prototype.checkAndModifyValues=function(t){var e,r=this;this.query=t;var o=t.values,u=[];return o.every(function(h,p){return e=r.checkAndModifyValue(h),t.ignore&&e&&(u.push(p),e=null),!e}),u.forEach(function(h){o.splice(h,1)}),{err:e,values:o}},n.prototype.checkAndModifyValue=function(t){var e,r=this;return this.table.columns.every(function(o){return!(e=r.checkAndModifyColumnValue_(o,t))}),e},n.prototype.checkNotNullAndDataType_=function(t,e){return t.notNull&&He(e[t.name])?this.getError(W,{ColumnName:t.name}):t.dataType&&!He(e[t.name])&&ue(e[t.name])!==t.dataType?this.getError(P,{column:t.name}):void 0},n.prototype.checkAndModifyColumnValue_=function(t,e){var r=e[t.name];if(t.autoIncrement?He(r)?e[t.name]=++this.autoIncrementValue[t.name]:ue(r)===c.Number&&r>this.autoIncrementValue[t.name]&&(this.autoIncrementValue[t.name]=r):t.default!==void 0&&He(r)&&(e[t.name]=t.default),this.query.validation)return this.checkNotNullAndDataType_(t,e)},n.prototype.getError=function(t,e){return new q(t,e)},n}(),An=function(){function n(t){this.table=t}return n.prototype.check=function(t,e){var r,o=this;return typeof t===c.Object?this.table?this.table.columns.every(function(u){return u.name in t&&(r=o.checkByColumn_(u,t[u.name])),!r}):r=new q(z,{tableName:e}):r=new q(ce),r},n.prototype.checkByColumn_=function(t,e){if(t.notNull===!0&&He(e))return new q(W,{ColumnName:t.name});var r=ue(e),o=e!=null;if(t.dataType&&o&&r!==t.dataType&&r!=="object")return new q(P,{column:t.name});if(o&&r==="object"){var u=["+","-","*","/","{push}"];for(var h in e)if(u.indexOf(h)<0&&t.dataType&&r!==t.dataType)return new q(P,{column:t.name})}},n}(),Ze=function(){function n(t){this.db=t}return n.prototype.validate=function(t,e){switch(t){case l.Select:case l.Remove:case l.Count:return this.checkSelect(e);case l.Insert:return this.checkInsertQuery(e);case l.Update:return this.checkUpdate(e)}},n.prototype.getTable_=function(t){return this.db.tables.find(function(e){return e.name===t})},n.prototype.isInsertQryValid=function(t){var e,r=this.getTable_(t.into);if(r)switch(ue(t.values)){case c.Array:break;case c.Null:e=new q(D);break;default:e=new q(S)}else e=new q(z,{tableName:t.into});return{table:r,log:e}},n.prototype.checkUpdate=function(t){var e=new An(this.getTable_(t.in)).check(t.set,t.in);if(e)return e;if(t.where!=null){if(e=this.checkForNullInWhere_(t))return e;this.addGreatAndLessToNotOp_(t)}},n.prototype.checkSelect=function(t){if(!t.store&&!this.getTable_(t.from))return new q(z,{tableName:t.from});if(t.where){var e=this.checkForNullInWhere_(t);if(e)return e;this.addGreatAndLessToNotOp_(t)}},n.prototype.checkForNullInWhere_=function(t){for(var e in t.where)if(t.where[e]==null)return new q(y,{column:e})},n.prototype.addGreatAndLessToNotOp_=function(t){var e=t.where,r=function(m,b){return b.findIndex(function(x){return m[x][f.NotEqualTo]!=null})>=0},o=function(m,b){var x;return b.forEach(function(E){(x=m[E])[f.NotEqualTo]!=null&&(m[E][f.GreaterThan]=x[f.NotEqualTo],m[f.Or]===void 0?(m[f.Or]={},m[f.Or][E]={}):m[f.Or][E]===void 0&&(m[f.Or][E]={}),m[f.Or][E][f.LessThan]=x[f.NotEqualTo],delete m[E][f.NotEqualTo])}),m};if(ue(e)===c.Object){var u=Object.keys(e);if(r(e,u))if(u.length===1)t.where=o(e,u);else{var h=[];u.forEach(function(m){var b;h.push(o(((b={})[m]=e[m],b),[m]))}),t.where=h}}else{var p=[];e.forEach(function(m){var b=Object.keys(m);r(m,b)&&(m=o(m,b)),p.push(m)}),t.where=p}},n.prototype.checkInsertQuery=function(t){var e=this.isInsertQryValid(t),r=e.table,o=e.log;if(o)return o;if(!t.skipDataCheck){var u=new qn(r,r.autoIncColumnValue).checkAndModifyValues(t),h=u.values,p=u.err;return t.values=h,p}},n}(),jn=(J=function(n,t){return J=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])},J(n,t)},function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=n}J(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}),$t=function(n){function t(e,r){var o=n.call(this)||this;return o.valuesAffected_=[],e.validation==null&&(e.validation=!0),o.query=e,o.util=r,o.tableName=e.into,o}return jn(t,n),t.prototype.execute=function(e){var r=this,o=this.db,u=new Ze(o).validate(l.Insert,this.query);return u?ye(u):e().then(function(h){return r.insertData_(o).then(function(p){return r.query.return?r.valuesAffected_:r.rowAffected})}).catch(function(h){return r.util.abortTransaction(),ye(h)})},t.prototype.insertData_=function(e){var r,o,u,h=this,p=this.query;return r=p.return?function(m){h.valuesAffected_.push(m)}:function(m){++h.rowAffected},u=p.upsert?"put":"add",o=p.ignore&&!h.isTxQuery?function(m){return h.util.con.transaction(p.into,v.ReadWrite).objectStore(p.into)[u](m)}:(h.isTxQuery||h.util.createTransaction([p.into,B.tableName]),h.objectStore=h.util.objectStore(h.tableName),function(m){return h.objectStore[u](m)}),de(p.values.map(function(m){return k(function(b,x){var E=o(m);E.onerror=function(A){p.ignore?b():x(A)},E.onsuccess=function(){r(m),b()}})})).then(function(){B.set(B.dbSchema,e,h.util)})},t}(We),Mt=self.alert===void 0&&typeof ServiceWorkerGlobalScope>"u",In=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),!indexedDB)return!1;IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange}catch{return!1}return!0}(),$e=function(n){return Array.isArray(n)},st=function(n){return Object.keys(n)},Ae=function(n){return st(n).length},et=function(n){for(var t in n)return t},Dn=function(){function n(){}return n.prototype.setCaseAndValue=function(t,e){this.caseQuery_=t,this.setValue(e)},n.prototype.setCaseAndColumn=function(t,e){return this.caseQuery_=t,this.setColumn(e),this},n.prototype.setColumn=function(t){return this.columnName_=t,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},n.prototype.setValue=function(t){return this.value=t,this},n.prototype.evaluate=function(){for(var t=0;t<this.length_;t++)if(this.checkCase_(this.caseColumnQuery_[t])===!0)return this.caseColumnQuery_[t].then;var e=this.caseColumnQuery_[this.length_-1].then;return e==null?this.value[this.columnName_]:e},n.prototype.checkCase_=function(t){var e;for(e in t){switch(e){case f.GreaterThan:if(this.value[this.columnName_]>t[e])return!0;break;case f.Equal:if(this.value[this.columnName_]===t[e])return!0;break;case f.LessThan:if(this.value[this.columnName_]<t[e])return!0;break;case f.GreaterThanEqualTo:if(this.value[this.columnName_]>=t[e])return!0;break;case f.LessThanEqualTo:if(this.value[this.columnName_]<=t[e])return!0;break;case f.NotEqualTo:if(this.value[this.columnName_]!==t[e])return!0;break;case f.Between:if(this.value[this.columnName_]>t[e].low&&this.value[this.columnName_]<t[e].high)return!0}return!1}},n}(),at=function(n,t,e,r){if(this.limitAtEnd===!1&&this.skipAtEnd===!1){if(this.skipRecord)return this.limitRecord?r:e;if(this.limitRecord)return t}return n},Nn=function(n){var t=this,e=!1;return function(r){var o=r.target.result;o?e&&t.results.length!==t.limitRecord?(t.shouldAddValue(o)&&t.pushResult(o.value),o.continue()):(e=!0,o.advance(t.skipRecord)):n()}},Rn=function(n){var t=this,e=!1;return function(r){var o=r.target.result;o?e?(t.shouldAddValue(o)&&t.pushResult(o.value),o.continue()):(e=!0,o.advance(t.skipRecord)):n()}},vt=function(n){var t=this;return function(e){var r=e.target.result;r&&t.results.length!==t.limitRecord?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):n()}},gt=function(n){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):n()}},Qn=function(n){var t,e=this,r=!1;return function(o){(t=o.target.result)?r&&e.results.length!==e.limitRecord?(e.pushResult(t.value),t.continue()):(r=!0,t.advance(e.skipRecord)):n()}},Ln=function(n){var t,e=this,r=!1;return function(o){(t=o.target.result)?r?(e.pushResult(t.value),t.continue()):(r=!0,t.advance(e.skipRecord)):n()}},$n=function(n){var t,e=this;return function(r){(t=r.target.result)?(e.pushResult(t.value),t.continue()):n()}},Mn=function(n){var t,e=this;return function(r){(t=r.target.result)&&e.results.length!==e.limitRecord?(e.pushResult(t.value),t.continue()):n()}},Pt=function(n){return n.replace(/\s/g,"")},Bt=function(n){var t;if(!this.query.store)if(this.query.join==null)t=this.getColumnInfo(n);else{var e=Pt(n).split("."),r=e[1];t=this.getColumnInfo(r,e[0])}if(t==null){var o=this.results[0][n];if(o)return{dataType:ue(o),name:n};throw new q(Q,{column:n,isOrder:!0})}return t},Wt=function(n,t){return t.localeCompare(n)},Vt=function(n,t){return n.localeCompare(t)},Pn=function(n,t){return new String(t).localeCompare(n)},Bn=function(n,t){return new String(n).localeCompare(t)},Ft=function(n,t){return t-n},Ut=function(n,t){return n-t},Wn=function(n,t){return t.getTime()-n.getTime()},Vn=function(n,t){return n.getTime()-t.getTime()},Gt=function(n,t){switch(n.dataType){case c.String:return t.type==="asc"?Vt:Wt;case c.Number:return t.type==="asc"?Ut:Ft;case c.DateTime:return t.type==="asc"?Vn:Wn;default:return t.type==="asc"?Bn:Pn}},Kt=function(n){var t;n.type=Jt(n.type);var e=n.by,r=this.thenEvaluator;if(e!=null&&typeof e===c.Object){var o=e,u=function(b,x){return function(E,A){for(var M in o){r.setCaseAndValue(o,E);var I=r.setColumn(M).evaluate();r.setCaseAndValue(o,A);var N=r.setColumn(M).evaluate();return typeof E[I]===c.String?b(E[I],A[N]):x(E[I],A[N])}}},h=n.type==="asc"?u(Vt,Ut):u(Wt,Ft);this.results.sort(h)}else{var p=Bt.call(this,e);if(p!=null){var m=Gt(p,n);e=p.name,n.case==null?this.results.sort(function(b,x){return m(b[e],x[e])}):(r.setCaseAndColumn(((t={})[e]=n.case,t),e),this.results.sort(function(b,x){return m(r.setValue(b).evaluate(),r.setValue(x).evaluate())}))}}},Jt=function(n){return n==null?"asc":n.toLowerCase()},zt=function(n){var t,e,r=n.split("%");switch(r[1]?(t=r[1],e=r.length>2?T.Any:T.Last):(t=r[0],e=T.First),e){case T.First:return new RegExp("^".concat(t),"i");case T.Last:return new RegExp("".concat(t,"$"),"i");default:return new RegExp("".concat(t),"i")}},Yt=function(n){return ue(n)==="object"&&!(n instanceof RegExp)},Xt=function(n){if(Yt(n)){var t={};for(var e in n)t[e]=n[e]!=null&&Yt(n[e])?Xt(n[e]):n[e];return t}return n},tt=function(n,t,e){var r=ue(n);if(r!==ue(t))return!1;switch(r===c.DateTime&&(n=n.getTime(),t=t.getTime()),e){case f.GreaterThan:return n>t;case f.LessThan:return n<t;case f.LessThanEqualTo:return n<=t;case f.GreaterThanEqualTo:return n>=t;case f.NotEqualTo:return n!==t;default:return n===t}},_t=function(){function n(t,e){this.where=Xt(t),this.checkFlag=e}return n.prototype.remove=function(t){var e=t.pop();delete t.reduce(function(r,o){return r&&r[o]},this.where)[e]},n.prototype.check=function(t){var e=!0;if(!this.checkFlag)return e;for(var r in this.where){if(!e)return e;var o=this.where[r],u=t[r];if(ue(o)==="object")for(var h in o){if(!e)return e;switch(h){case f.In:e=this.checkIn(r,u);break;case f.Like:e=this.checkLike_(r,u);break;case f.Regex:e=this.checkRegex(r,u);break;case f.Between:case f.GreaterThan:case f.LessThan:case f.GreaterThanEqualTo:case f.LessThanEqualTo:case f.NotEqualTo:e=this.checkComparisionOp_(r,u,h);break;default:e=!1}}else e=tt(o,u)}return e},n.prototype.checkIn=function(t,e){return this.where[t][f.In].find(function(r){return tt(r,e)})!=null},n.prototype.checkLike_=function(t,e){return zt(this.where[t][f.Like]).test(e)},n.prototype.checkRegex=function(t,e){return this.where[t][f.Regex].test(e)},n.prototype.checkComparisionOp_=function(t,e,r){var o=this.where[t][r];return r!=f.Between?tt(e,o,r):tt(e,o.low,">=")&&tt(e,o.high,"<=")},n}(),Fn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),ct=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.limitAtEnd=!1,e.skipAtEnd=!1,e}return Fn(t,n),t.prototype.goToWhereLogic=function(){var e=this,r=this.query,o=r.where,u=function(){for(var x in o)if(e.objectStore.indexNames.contains(x))return x}();if(u==null&&(u=et(o),!r.store))return ye(new q(j,{column:u}));var h=o[u];if(ue(h)!=="object")return p=Ae(o)>1,this.whereChecker=new _t(o,p),this.whereChecker.remove([u]),this.executeWhereLogic(u,h,null,"next");var p=Ae(h)>1||Ae(o)>1;this.whereChecker=new _t(o,p);var m=et(h);switch(this.whereChecker.remove([u,m]),m){case f.Like:var b=zt(h[f.Like]);return this.executeRegexLogic(u,b);case f.Regex:return this.executeRegexLogic(u,h[f.Regex]);case f.In:return this.executeInLogic(u,h[f.In]);case f.Between:case f.GreaterThan:case f.LessThan:case f.GreaterThanEqualTo:case f.LessThanEqualTo:return this.executeWhereLogic(u,h,m,"next");case f.Aggregate:break;default:return this.executeWhereLogic(u,h,null,"next")}},t}(We),Ht=function(n,t){var e=this;return function(r){var o=r.target.result;e.results.length!==e.limitRecord&&o?(e.shouldAddValue(o)&&t(o.value),o.continue()):n()}},Zt=function(n,t){var e=this;return function(r){var o=r.target.result;o?(e.shouldAddValue(o)&&t(o.value),o.continue()):n()}},Me=function(){return Me=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},Me.apply(this,arguments)},Un=function(){function n(t){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=t}return Object.defineProperty(n.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),n.prototype.getTable=function(t){return this.select.table(t)},n.prototype.executeSelect=function(t){return new se(t,this.select.util).execute()},n.prototype.execute=function(){var t=this,e=this.query;this.joinQueryStack_=ue(e.join)===c.Object?[e.join]:e.join;var r=e.from,o=[];r&&o.push(r);for(var u=this.joinQueryStack_,h=0,p=u.length;h<p;h++){var m=u[h],b=this.getJoinTableInfo_(m.on);m.with===b.table1.table&&(b={table1:b.table2,table2:b.table1});var x=this.checkJoinQuery_(b,m);if(x)return ye(x);u[h].joinTableInfo=b,m.with&&o.push(m.with)}return!this.select.isTxQuery&&o.length>0&&this.select.util.createTransaction(o),this.executeSelect({from:r,where:e.where,case:e.case,flatten:e.flatten,store:e.store,meta:e.meta}).then(function(E){return t.results=E.map(function(A){var M;return(M={})[t.currentQueryStackIndex_]=A,M}),t.tablesFetched.push(u[0].joinTableInfo.table1.table),t.startExecutingJoinLogic_()})},n.prototype.onJoinQueryFinished_=function(){if(this.results.length!==0){var t=this.select;try{var e=[],r=st(this.results[0]).length;this.results.forEach(function(o){for(var u=o[0],h=1;h<r;h++)u=Me(Me({},u),o[h]);e.push(u)}),t.results=e,t.setLimitAndSkipEvaluationAtEnd_(),t.query.flatten=null,t.processOrderBy()}catch(o){return ye(new q(d,o.message))}}},n.prototype.startExecutingJoinLogic_=function(){var t=this,e=this.joinQueryStack_[this.currentQueryStackIndex_];if(!e)return this.onJoinQueryFinished_();try{var r=e.joinTableInfo;return this.executeSelect({from:e.with,where:e.where,case:e.case,flatten:e.flatten,store:e.store,meta:e.meta}).then(function(o){return t.jointables(e,r,o),t.tablesFetched.push(r.table2.table),++t.currentQueryStackIndex_,t.startExecutingJoinLogic_()})}catch(o){return ye(new q(d,o.message))}},n.prototype.jointables=function(t,e,r){var o,u=this,h=t.type,p=[],m=e.table1.column,b=e.table2.column,x=this.tablesFetched.indexOf(e.table1.table),E=this.currentQueryStackIndex_+1,A=t.as,M=A?function(I){for(var N in A){var X=A[N];I[X]===void 0&&(I[X]=I[N],delete I[N])}return I}:function(I){return I};h==="left"?function(){var I,N,X=0,me={};t.store?st(t.store).forEach(function(V){me[V]=null}):u.getTable(e.table2.table).columns.forEach(function(V){me[V.name]=null}),N=E===1?function(V,G){G[x][m]===V[b]&&I.push(V)}:function(V,G){var ae=G[x];ae!=null&&ae[m]===V[b]&&I.push(V)};var De=Object.assign(t.where||{},t.whereJoin||{}),Z=new _t(De,Ae(De)>0);u.results.forEach(function(V){I=[],r.forEach(function(G){N(G,V)}),I.length===0&&(I=[me]),I.forEach(function(G){G=M(G),Z.check(G)&&(p[X]=Me({},V),p[X++][E]=G)})})}():(o=0,u.results.forEach(function(I){r.forEach(function(N){I[x][m]===N[b]&&(p[o]=Me({},I),p[o++][E]=M(Me({},N)))})})),this.results=p},n.prototype.getJoinTableInfo_=function(t){var e=(t=Pt(t)).split("="),r=e[0].split("."),o=e[1].split(".");return{table1:{table:r[0],column:r[1]},table2:{table:o[0],column:o[1]}}},n.prototype.checkJoinQuery_=function(t,e){if(e.store)return null;var r,o=t.table1,u=t.table2,h=this.getTable(o.table),p=this.getTable(u.table);e.with!==u.table&&(r=new q(d,"on value should contains value of with")),h.columns.find(function(A){return A.name===o.column})==null?r=new q(d,"column ".concat(o.column," does not exist in table ").concat(o.table)):p.columns.find(function(A){return A.name===u.column})==null&&(r=new q(d,"column ".concat(u.column," does not exist in table ").concat(u.table))),e.as==null&&(e.as={}),h.columns.every(function(A){var M=p.columns.find(function(I){return I.name===A.name&&I.name!==o.column});return M==null||e.as[M.name]!=null||(r=new q(d,"column ".concat(A.name," exist in both table ").concat(o.table," & ").concat(u.table)),!1)});var m=e.where;if(m){var b={},x=function(A){p.columns.find(function(M){return M.name===A})||(b[A]=m[A],delete m[A])};for(var E in m)x(E);e.whereJoin=b,Ae(m)===0&&(e.where=null)}return r},n}(),Gn=function(){function n(t){this.data=t}return Object.defineProperty(n.prototype,"indexNames",{get:function(){var t=st(this.data[0]);return{contains:function(e){return t.indexOf(e)>=0}}},enumerable:!1,configurable:!0}),n.prototype.index=function(t){var e=this;return{openCursor:function(r){var o={},u=0,h={continue:function(){++u,m()}},p=function(b){o.onsuccess({target:{result:b}})},m=function(){var b=e.data[u];if(b){var x=b[t];x&&(r==null||r.includes(x))?(h.key=x,h.value=b,p(h)):h.continue()}else p(null)};return C().then(m),o}}},n}(),Kn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),lt=function(){return lt=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},lt.apply(this,arguments)},ft=function(n,t,e){if(e||arguments.length===2)for(var r,o=0,u=t.length;o<u;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return n.concat(r||Array.prototype.slice.call(t))},se=function(n){function t(e,r){var o=n.call(this)||this;o.sorted=!1,o.isSubQuery=!1,o.thenEvaluator=new Dn,o.returnResult_=function(){if(o.results.length>0){var h=o.query;if(h.flatten){var p=[],m=new Map;h.flatten.forEach(function(x){o.results.forEach(function(E,A){E[x].forEach(function(M){var I;p.push(lt(lt({},E),((I={})[x]=M,I)))}),m.set(A,!0)})});var b=0;m.forEach(function(x,E){o.results.splice(E-b,1),++b}),o.results=o.results.concat(p)}o.processGroupDistinctAggr(),o.processOrderBy(),o.skipAtEnd&&o.results.splice(0,h.skip),o.limitAtEnd&&(o.results=o.results.slice(0,h.limit))}return o.results},o.query=e,o.util=r,o.tableName=e.from,o.setPushResult(),$e(e.where)?(o.isArrayQry=!0,o.setLimitAndSkipEvaluationAtEnd_()):(o.skipRecord=e.skip,o.limitRecord=e.limit);var u=e.order;return u?(($e(u)||u.case||typeof u.by=="object")&&(u.idbSorting=!1),o.setLimitAndSkipEvaluationAtEnd_()):e.groupBy&&o.setLimitAndSkipEvaluationAtEnd_(),o}return Kn(t,n),t.prototype.execute=function(e){var r=this;e||(e=function(){return C(null)});var o=this.query;try{var u=new Ze(this.db).validate(l.Select,o);return u?ye(u):e().then(function(h){return r.initTransaction_(),(o.join==null?o.where!=null?$e(o.where)?r.processWhereArrayQry():r.processWhere_():r.executeWhereUndefinedLogic():r.executeJoinQuery()).then(r.returnResult_.bind(r))})}catch(h){return this.onException(h)}},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var r,o=this.query.where,u=this.primaryKey(),h=!0,p=[],m=function(){var x;if(r===f.And?h===!0?p=e.results:p.length>0&&(x=[],e.results.forEach(function(E){var A;A=E[u],p.findIndex(function(M){return M[u]===A})>=0&&x.push(E)}),p=x,x=null):(p.length>0&&(e.results=ft(ft([],p,!0),e.results,!0),e.removeDuplicates()),p=e.results),h=!1,o.length>0)return e.results=[],b();e.results=p},b=function(){var x=o.shift();return x[f.Or]&&Ae(x)===1?(r=f.Or,x=x[f.Or]):r=f.And,e.query.where=x,e.processWhere_().then(m)};return b()},t.prototype.initTransaction_=function(){var e=this.query.store;e?this.objectStore=new Gn(e):(this.isTxQuery||this.util.createTransactionIfNotExist([this.tableName],v.ReadOnly),this.objectStore=this.util.objectStore(this.tableName))},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(r){return e.whereChecker.check(r.value)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){var e=this.query;this.results.length>0&&(this.orInfo.results=ft(ft([],this.orInfo.results,!0),this.results,!0)),this.results=[];var r=et(this.orInfo.orQuery);if(r!=null){var o={};return o[r]=this.orInfo.orQuery[r],delete this.orInfo.orQuery[r],e.where=o,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var e=this.query.where;this.orInfo={orQuery:e.or,results:[]},this.setLimitAndSkipEvaluationAtEnd_(),delete e.or},t}(ct);se.prototype.executeInLogic=function(n,t){var e=this,r=this.skipRecord,o=function(h){r===0?e.pushResult(h):--r},u=at.call(this,gt,vt,Zt,Ht);return de(t.map(function(h){return k(function(p,m){var b=e.objectStore.index(n).openCursor(e.util.keyRange(h));b.onsuccess=u.call(e,p,o),b.onerror=m})}))},se.prototype.executeWhereUndefinedLogic=function(){var n,t=this,e=this.query,r=e.store;if(r)return this.results=r,this.setLimitAndSkipEvaluationAtEnd_(),C();var o=e.order,u=this.objectStore;if(o&&o.idbSorting!==!1&&o.by){if(!u.indexNames.contains(o.by))return ye(new q(Q,{column:o.by,isOrder:!0}));var h=o.type&&o.type.toLowerCase()==="desc"?"prev":"next";this.sorted=!0,n=u.index(o.by).openCursor(null,h)}else n=u.openCursor();var p=at.call(this,$n,Mn,Ln,Qn);return k(function(m,b){n.onerror=b,n.onsuccess=p.call(t,m)})},se.prototype.executeWhereLogic=function(n,t,e,r){var o=this;t=e?t[e]:t;var u=this.objectStore.index(n).openCursor(this.util.keyRange(t,e),r),h=at.call(this,gt,vt,Rn,Nn);return k(function(p,m){u.onerror=m,u.onsuccess=h.call(o,p)})},se.prototype.executeRegexLogic=function(n,t){var e=this,r=this.skipRecord,o=function(p){r===0?e.pushResult(p):--r};this.shouldAddValue=function(p){return t.test(p.key)&&e.whereChecker.check(p.value)};var u=this.objectStore.index(n).openCursor(),h=at.call(this,gt,vt,Zt,Ht);return k(function(p,m){u.onerror=m,u.onsuccess=h.call(e,p,o)})},se.prototype.setLimitAndSkipEvaluationAtEnd_=function(){this.query.limit&&(this.limitAtEnd=!0),this.query.skip&&(this.skipAtEnd=!0)},se.prototype.setPushResult=function(){var n=this,t=this.query.case;this.pushResult=t?function(e){var r;for(r in n.thenEvaluator.setCaseAndValue(t,e),t)e[r]=n.thenEvaluator.setColumn(r).evaluate();n.results.push(e)}:function(e){n.results.push(e)}},se.prototype.removeDuplicates=function(){for(var n=this.results,t=this.primaryKey(),e=new Map,r=0,o=n.length;r<o;r++)e.set(n[r][t],n[r]);this.results=Array.from(e.values())},se.prototype.executeJoinQuery=function(){return new Un(this).execute()},se.prototype.processGroupDistinctAggr=function(){var n=this.query;if(n.distinct){var t=[],e=this.results[0];for(var r in e)t.push(r);var o=this.primaryKey(),u=t.indexOf(o);t.splice(u,1),n.groupBy=t.length>0?t:null}n.groupBy?n.aggregate?this.executeAggregateGroupBy():this.processGroupBy():n.aggregate&&this.processAggregateQry()},se.prototype.processOrderBy=function(){var n=this.query.order;if(n&&this.results.length>0&&!this.sorted){var t=ue(n);if(t===c.Object)Kt.call(this,n);else if(t===c.Array){Kt.call(this,n[0]);for(var e=function(h,p){var m=n[h-1].by,b=n[h],x=b.by,E=Bt.call(r,x);if(E!=null){x=E.name,b.type=Jt(b.type);var A=Gt(E,b);r.results.sort(function(M,I){return M[m]===I[m]?A(M[x],I[x]):0})}},r=this,o=1,u=n.length;o<u;o++)e(o)}}},se.prototype.processAggregateQry=function(){var n,t=this.results,e=t.length,r={},o=function(){var N=0;for(var X in t)N+=t[X][n]?1:0;return N},u=function(){var N=0;for(var X in t)N=N>t[X][n]?N:t[X][n];return N},h=function(){var N=1/0,X=1/0;for(var me in t)N=N<(X=t[me][n]?t[me][n]:1/0)?N:X;return N},p=function(){var N=0;for(var X in t)N+=t[X][n];return N},m=function(){return p()/e},b=this.query.aggregate;for(var x in b){var E=b[x],A=ue(E),M=void 0;switch(x){case"count":M=o;break;case"max":M=u;break;case"min":M=h;break;case"sum":M=p;break;case"avg":M=m}switch(A){case c.String:n=E,r["".concat(x,"(").concat(n,")")]=M();break;case c.Array:for(var I in E)n=E[I],r["".concat(x,"(").concat(n,")")]=M()}}for(var x in r)t[0][x]=r[x];this.results=[t[0]]},se.prototype.executeAggregateGroupBy=function(){var n,t,e,r,o=this.query.groupBy,u=this.results,h=new Map,p=this.query.aggregate,m=function(){var De=function(){return e=(e=h.get(t))?e["count("+r+")"]:0,e+=u[n][r]?1:0},Z=function(){return(e=(e=h.get(t))?e["list("+r+")"]:[]).push(u[n][r]),e},V=function(){return e=(e=h.get(t))?e["max("+r+")"]:0,u[n][r]=u[n][r]?u[n][r]:0,e>u[n][r]?e:u[n][r]},G=function(){return e=(e=h.get(t))?e["min("+r+")"]:1/0,u[n][r]=u[n][r]?u[n][r]:1/0,e<u[n][r]?e:u[n][r]},ae=function(){return e=(e=h.get(t))?e["sum("+r+")"]:0,e+=u[n][r]?u[n][r]:0},ne=function(){var nn=(e=h.get(t))?e["sum("+r+")"]:0;nn+=u[n][r]?u[n][r]:0,u[n]["sum("+r+")"]=nn,e=e?e["count("+r+")"]:0,e+=u[n][r]?1:0,u[n]["count("+r+")"]=e};for(var ve in p){var be=p[ve],rt=ue(be),we=void 0;switch(ve){case f.Count:we=De;break;case f.Max:we=V;break;case f.Min:we=G;break;case f.Sum:we=ae;break;case f.Avg:we=ne;break;case f.List:we=Z}switch(rt){case c.String:r=be,u[n]["".concat(ve,"(").concat(r,")")]=we();break;case c.Array:for(var xt in be)r=be[xt],u[n]["".concat(ve,"(").concat(r,")")]=we()}}};if(ue(o)===c.String)for(n in u)t=u[n][o],m(),h.set(t,u[n]);else for(n in u){for(var b in t="",o)t+=u[n][o[b]];m(),h.set(t,u[n])}u=Array.from(h.values());var x=p.avg;if(x)if(ue(x)===c.String)for(n in u){var E=u[n]["sum("+x+")"],A=u[n]["count("+x+")"];u[n]["avg("+x+")"]=E/A,p.count!==x&&delete u[n]["count("+x+")"],p.sum!==x&&delete u[n]["sum("+x+")"]}else{var M=ue(p.count)===c.String,I=ue(p.sum)===c.String;for(n in u)for(var b in x){var N=x[b],X=u[n]["sum("+N+")"],me=u[n]["count("+N+")"];u[n]["avg("+N+")"]=X/me,M&&(p.count!==N||p.count.indexOf(N)===-1)&&delete u[n]["count("+N+")"],I&&(p.sum!==N||p.sum.indexOf(N)===-1)&&delete u[n]["sum("+N+")"]}}this.results=u},se.prototype.processGroupBy=function(){var n=this.query.groupBy,t=this.results,e=new Map,r=ue(n);if(r!==c.Object)if(r===c.String)for(var o in t)e.set(t[o][n],t[o]);else{var u=void 0;for(var o in t){for(var h in u="",n)u+=t[o][n[h]];e.set(u,t[o])}}else if(Object.keys(n).length===1){var p=et(n);for(var o in this.thenEvaluator.setCaseAndColumn(n,p),t)e.set(this.thenEvaluator.setValue(t[o]).evaluate(),t[o])}else for(var o in u=void 0,t){for(var h in u="",this.thenEvaluator.setCaseAndValue(n,t[o]),n)u+=this.thenEvaluator.setColumn(h).evaluate();e.set(u,t[o])}this.results=Array.from(e.values())};var bt=function(n){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r)&&++t.resultCount,r.continue()):n()}},Jn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ve=function(n){function t(e,r){var o=n.call(this)||this;return o.resultCount=0,o.query=e,o.util=r,o.tableName=e.from,o}return Jn(t,n),t.prototype.execute=function(e){var r=this,o=new Ze(this.db),u=this.query,h=o.validate(l.Count,u);return h?ye(h):e().then(function(p){var m;try{var b=function(){var x=new se(u,r.util);return x.isTxQuery=r.isTxQuery,x.execute().then(function(E){r.resultCount=E.length})};r.initTransaction_(),u.join==null?u.where!=null?u.where.or||$e(u.where)?m=b():(r.shouldAddValue=function(x){return r.whereChecker.check(x.value)},m=r.goToWhereLogic()):m=r.executeWhereUndefinedLogic():m=b()}catch(x){r.onException(x)}return m.then(function(x){return r.resultCount})})},t.prototype.initTransaction_=function(){var e=this.query.from;this.isTxQuery||this.util.createTransaction([e],v.ReadOnly),this.objectStore=this.util.objectStore(e)},t}(ct);Ve.prototype.executeWhereUndefinedLogic=function(){var n,t,e=this,r=this.objectStore,o=r.count?(n=r.count(),function(u){return function(){e.resultCount=n.result,u()}}):(n=r.openCursor(),function(u){return function(h){(t=h.target.result)?(++e.resultCount,t.continue()):u()}});return k(function(u,h){n.onerror=h,n.onsuccess=o(u)})},Ve.prototype.executeWhereLogic=function(n,t,e){var r,o=this;t=e?t[e]:t;var u=Ae(this.query.where)===1,h=this.objectStore;return k(function(p,m){u&&h.count?(r=h.index(n).count(o.util.keyRange(t,e))).onsuccess=function(){o.resultCount=r.result,p()}:(r=h.index(n).openCursor(o.util.keyRange(t,e))).onsuccess=bt.call(o,p),r.onerror=m})},Ve.prototype.executeRegexLogic=function(n,t){var e=this,r=this.objectStore.index(n).openCursor();return this.shouldAddValue=function(o){return t.test(o.key)&&e.whereChecker.check(o.value)},k(function(o,u){r.onerror=u,r.onsuccess=bt.call(e,o)})},Ve.prototype.executeInLogic=function(n,t){var e=this,r=this.objectStore,o=r.index(n),u=Ae(this.query.where)===1;return de(t.map(function(h){return p=h,m=e.util.keyRange(p),u&&r.count?k(function(b,x){var E=o.count(m);E.onsuccess=function(A){e.resultCount+=A.target.result,b()},E.onerror=x}):k(function(b,x){var E=o.openCursor(m);E.onsuccess=bt.call(e,b),E.onerror=x});var p,m}))};var nt=function(n){return($e(n)?n:n.split(".")).reduce(function(t,e){return t&&t[e]},self)},ht=function(n,t){var e=n.set,r=n.mapSet;if(r){var o=r(e,t);o!=null&&(e=o)}for(var u in e){var h=e[u];if(ue(h)!==c.Object)t[u]=h;else for(var p in h){var m=h[p];switch(p){case"+":t[u]+=m;break;case"-":t[u]-=m;break;case"*":t[u]*=m;break;case"/":t[u]/=m;break;case"{push}":t[u].push(m);break;default:t[u]=h}break}}return t},zn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Fe=function(n){function t(e,r){var o=n.call(this)||this;o.query=e,o.util=r,o.tableName=e.in;var u=e.mapSet;if(u){var h=ue(u)===c.String?nt(u):u;if(!h)throw new q(O,u);e.mapSet=h}return o}return zn(t,n),t.prototype.execute=function(e){var r=this,o=this.query;try{var u=new Ze(this.db).validate(l.Update,o);return u?ye(u):e().then(function(h){return r.initTransaction(),(o.where!=null?o.where.or||$e(o.where)?r.executeComplexLogic_():r.goToWhereLogic():r.executeWhereUndefinedLogic()).then(function(){return r.rowAffected})})}catch(h){return this.onException(h)}},t.prototype.executeComplexLogic_=function(){var e=this,r=this.query,o=new se({from:r.in,where:r.where,ignoreCase:r.ignoreCase},this.util);return o.isTxQuery=this.isTxQuery,o.execute().then(function(u){var h,p,m=e.primaryKey(r.in),b=[];u.forEach(function(E){b.push(E[m])}),u=null;var x=((h={})[m]=((p={})[f.In]=b,p),h);return e.query.where=x,e.initTransaction(),e.goToWhereLogic()})},t.prototype.initTransaction=function(){var e=this.query.in;this.isTxQuery||this.util.createTransaction([e]),this.objectStore=this.util.objectStore(e)},t}(ct);Fe.prototype.executeWhereUndefinedLogic=function(){var n=this,t=this.objectStore.openCursor();return k(function(e,r){t.onsuccess=function(o){var u=o.target.result;if(u)try{var h=u.update(ht(n.query,u.value));h.onsuccess=function(){++n.rowAffected,u.continue()},h.onerror=r}catch(p){r(p)}else e()},t.onerror=r})},Fe.prototype.executeWhereLogic=function(n,t,e){var r=this,o=this.query;t=e?t[e]:t;var u=this.objectStore.index(n).openCursor(this.util.keyRange(t,e));return k(function(h,p){u.onsuccess=function(m){var b=m.target.result;if(b)if(r.whereChecker.check(b.value))try{var x=b.update(ht(o,b.value));x.onsuccess=function(){++r.rowAffected,b.continue()},x.onerror=p}catch(E){p(E)}else b.continue();else h()},u.onerror=p})},Fe.prototype.executeRegexLogic=function(n,t){var e,r=this,o=this.objectStore.index(n).openCursor();return this.shouldAddValue=function(u){return t.test(u.key)&&r.whereChecker.check(u.value)},k(function(u,h){o.onsuccess=function(p){if(e=p.target.result)if(r.shouldAddValue(e))try{var m=e.update(ht(r.query,e.value));m.onsuccess=function(){++r.rowAffected,e.continue()},m.onerror=h}catch(b){h(b)}else e.continue();else u()},o.onerror=h})},Fe.prototype.executeInLogic=function(n,t){var e=this,r=this.objectStore.index(n),o=this.query;return de(t.map(function(u){return h=u,k(function(p,m){var b=r.openCursor(e.util.keyRange(h));b.onsuccess=function(x){var E=x.target.result;if(E){var A=E.value;if(e.whereChecker.check(A))try{var M=E.update(ht(o,A));M.onsuccess=function(){++e.rowAffected,E.continue()},M.onerror=m}catch(I){m(I)}else E.continue()}else p()},b.onerror=m});var h}))};var Yn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),wt=function(){return wt=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},wt.apply(this,arguments)},Xn=function(n){function t(e,r){var o=n.call(this)||this;return o.query=e,o.util=r,o}return Yn(t,n),t.prototype.execute=function(){var e,r,o=this,u=this.query,h=0,p={},m={},b=!0,x=u.queries,E=x.length;if(x.every(function(I,N){return!(N+1<E&&I.from!==x[N+1].from&&(b=!1,1))}),b){var A=this.primaryKey(x[0].from);e=function(I){return I[A]}}else e=function(I){var N="";for(var X in I)N+=I[X];return N};var M=function(){if(h<E)return(r=new se(x[h],o.util)).execute().then(function(ne){return p={},ne.forEach(function(ve){var be=e(ve);h===0?m[be]=ve:m[be]!=null&&(p[be]=ve)}),h>0&&(m=wt({},p)),++h,M()});var I,N=[],X=void 0,me=u.skip,De=u.limit,Z=!1,V=function(){N.push(p[I])},G=function(){N.length<De?V():Z=!0},ae=function(ne){me===0?ne():--me};if(X=u.skip&&u.limit?function(){ae(function(){G()})}:u.limit?G:u.skip?function(){ae(function(){V()})}:function(){V()},De){for(I in p)if(X(I),Z)break}else for(I in p)X(I);return r.results=N,Object.assign(r.query,{order:u.order,join:{}}),r.processOrderBy(),r.processGroupDistinctAggr(),r.results};return M()},t}(We),Hn=function(){function n(){}return n.prototype.execute=function(t){return k(function(e,r){var o=indexedDB.deleteDatabase(t);o.onblocked=function(){var u=new q(Ce);return r(ut(u))},o.onerror=function(u){return r(ut(u))},o.onsuccess=function(){e()}})},n}(),Zn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),er=function(n){function t(e,r){var o=n.call(this)||this;return o.query=e,o.util=r,o}return Zn(t,n),t.prototype.execute=function(){var e,r=this,o=this.query,u=0,h=new Map,p=!0,m=o.length;if(o.every(function(E,A){return!(A+1<m&&E.from!==o[A+1].from&&(p=!1,1))}),p){var b=this.primaryKey(o[0].from);e=function(E){return E[b]}}else e=function(E){var A="";for(var M in E)A+=E[M];return A};var x=function(){return u<o.length?new se(o[u++],r.util).execute().then(function(E){return E.forEach(function(A){h.set(e(A),A)}),x()}):Array.from(h.values())};return x()},t}(We),en=function(n){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r.value)&&(r.delete(),++t.rowAffected),r.continue()):n()}},tr=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ue=function(n){function t(e,r){var o=n.call(this)||this;return o.query=e,o.util=r,o.tableName=e.from,o}return tr(t,n),t.prototype.execute=function(e){var r,o=this,u=new Ze(this.db),h=this.query,p=u.validate(l.Remove,h);return p?ye(p):e().then(function(m){try{o.initTransaction_(),r=h.where!=null?$e(h.where)?o.processWhereArrayQry():o.processWhere_():o.executeWhereUndefinedLogic()}catch(b){return o.onException(b)}return r.then(function(){return o.rowAffected})})},t.prototype.processWhereArrayQry=function(){var e=this,r=new se(this.query,this.util);return r.isTxQuery=this.isTxQuery,r.execute().then(function(o){var u,h,p=[],m=e.primaryKey(e.query.from);o.forEach(function(x){p.push(x[m])}),o=null;var b=((u={})[m]=((h={})[f.In]=p,h),u);return e.query[f.Where]=b,e.processWhere_()})},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(r){return e.whereChecker.check(r)},this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var e=this,r=this._orInfo.OrQuery,o=et(r);if(o!=null){var u={};return u[o]=r[o],delete r[o],this.query.where=u,this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})}this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var e=this.query.where;this._orInfo={OrQuery:e.or},delete e.or},t}(ct);Ue.prototype.executeInLogic=function(n,t){var e=this,r=this.objectStore.index(n);return de(t.map(function(o){return u=o,k(function(h,p){var m=r.openCursor(e.util.keyRange(u));m.onsuccess=en.call(e,h),m.onerror=p});var u}))},Ue.prototype.executeWhereUndefinedLogic=function(){var n,t=this,e=this.objectStore.openCursor();return k(function(r,o){e.onsuccess=function(u){(n=u.target.result)?(n.delete(),++t.rowAffected,n.continue()):r()},e.onerror=o})},Ue.prototype.executeWhereLogic=function(n,t,e){var r=this;t=e?t[e]:t;var o=this.objectStore.index(n).openCursor(this.util.keyRange(t,e));return k(function(u,h){o.onsuccess=en.call(r,u),o.onerror=h})},Ue.prototype.executeRegexLogic=function(n,t){var e,r=this,o=this.objectStore.index(n).openCursor();return this.shouldAddValue=function(u){return t.test(u.key)&&r.whereChecker.check(u.value)},k(function(u,h){o.onsuccess=function(p){(e=p.target.result)?(r.shouldAddValue(e)&&(e.delete(),++r.rowAffected),e.continue()):u()},o.onerror=h})};var nr=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),rr=function(n){function t(e,r){var o=n.call(this)||this;return o.query=e,o.util=r,o.tableName=e,o}return nr(t,n),t.prototype.execute=function(e){var r=this,o=this.query;return this.isTxQuery||this.util.createTransaction([o,B.tableName]),e().then(function(u){var h=r.util.objectStore(o).clear();try{return k(function(p,m){h.onsuccess=function(b){var x=r.table(o);for(var E in x.autoIncColumnValue)x.autoIncColumnValue[E]=0;B.set(B.dbSchema,r.util.db,r.util).then(p).catch(m)},h.onerror=m})}catch(p){return r.onException(p)}})},t}(We),or=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),ir=function(n){function t(e,r){var o=n.call(this)||this;return o.results={},o.reqQueue=[],o.isQueryExecuting=!1,o.isTxStarted_=!1,o.query=e,o.util=r,o}return or(t,n),t.prototype.execute=function(e){var r=this;this.beforeExecute=e;var o=this.validate();return o?ye(o):(this.startExecution_(),k(function(u,h){r.onSuccess=u,r.onError=h}).then(function(u){return r.beforeExecute=null,r.log("transaction finished"),u}))},t.prototype.validate=function(){var e=this.query,r=this.notExistingTable_(e.tables);if(r)return new q(z,{tableName:r});var o=e.method;return nt(o)?void 0:new q(O,o)},t.prototype.startExecution_=function(){var e=this,r=this.query,o=function(p){return function(m){return e.pushReq_({name:p,query:m})}},u=r.method,h=nt(u);return this.log("transaction query started"),h.call(this,{data:r.data,insert:o(l.Insert),select:o(l.Select),update:o(l.Update),remove:o(l.Remove),count:o(l.Count),setResult:function(p,m){e.results[p]=m},getResult:function(p){return e.results[p]},abort:function(p){e.abortTx_(p)},start:function(){e.startTx_()}})},t.prototype.log=function(e){this.util.logger.log(e)},t.prototype.startTx_=function(){var e=this;try{this.isTxStarted_=!0;var r=this.query.tables;return r=r.concat(B.tableName),this.util.createTransaction(r).then(function(o){e.onSuccess(e.results)}).catch(function(o){e.onError(o)}),this.processExecutionOfQry_()}catch(o){this.onError(this.onException(o))}},t.prototype.onReqFinished_=function(e){var r=this.reqQueue.shift();this.log("finished request : ".concat(r.name," ")),r&&(e.error?(this.abortTx_("automatic abort of transaction due to error occured"),this.log("transaction aborted due to error occured"),this.onError(e.error)):(this.isQueryExecuting=!1,r.onSuccess&&r.onSuccess(e),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(e){this.reqQueue=[],this.util.abortTransaction(),this.log("transaction aborted. Msg : ".concat(e))},t.prototype.executeRequest_=function(e){var r,o=this;this.isQueryExecuting=!0,this.log("executing request : ".concat(e.name," "));var u=this.onReqFinished_.bind(this),h=e.query,p=function(m){r=new m(h,o.util)};switch(e.name){case l.Select:p(se);break;case l.Insert:p($t);break;case l.Update:p(Fe);break;case l.Remove:p(Ue);break;case l.Count:p(Ve)}r.isTxQuery=!0,r.execute(this.beforeExecute).then(u).catch(function(m){u({error:m})})},t.prototype.pushReq_=function(e){var r=k(function(o,u){e.onSuccess=function(h){o(h)},e.onError=function(h){u(h)}});return this.reqQueue.push(e),this.isTxStarted_===!0&&this.processExecutionOfQry_(),this.log("request pushed : ".concat(e.name)),r},t.prototype.processExecutionOfQry_=function(){this.isQueryExecuting===!1&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(e){var r=this,o=null;return e.every(function(u){return r.table(u)!=null||(o=u,!1)}),o},t}(We),kt=function(n){var t={name:n.name,version:n.version,tables:[]};return n.tables.forEach(function(e){var r={name:e.name,columns:{}};e.columns.forEach(function(o){r.columns[o.name]=o}),t.tables.push(r)}),t},tn=function(){function n(t){this.middlewares=[],this.util=new ie,this.onQryFinished=Mt?function(e){self.postMessage(e)}:t}return Object.defineProperty(n.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"logger",{get:function(){return this.util.logger},enumerable:!1,configurable:!0}),n.prototype.executeMiddleware_=function(t){var e=this,r=Ae(this.middlewares)-1;if(r<0)return C();var o={},u=this.db;return Object.defineProperty(o,"database",{get:function(){return kt(u)}}),k(function(h){var p=0,m=function(){if(p<=r){var b=nt(e.middlewares[p++])(t,o);b&&b.then||(b=Promise.resolve(b)),b.then(function(x){m()})}else h()};m()})},n.prototype.executeQuery=function(t,e){var r,o=t.query,u=this,h=u.util,p=function(m,b){r=new m(o,h).execute(b)};switch(t.name){case l.OpenDb:e(),r=u.openDb(o);break;case l.InitDb:e(),r=u.initDb(o);break;case l.CloseDb:e(),r=u.closeDb();break;case l.Insert:p($t,e);break;case l.Select:p(se,e);break;case l.Count:p(Ve,e);break;case l.Update:p(Fe,e);break;case l.Intersect:e(),p(Xn);break;case l.DropDb:e(),r=u.dropDb();break;case l.Terminate:e(),r=u.terminate();break;case l.Union:e(),p(er);break;case l.Remove:p(Ue,e);break;case l.Clear:p(rr,e);break;case l.Transaction:p(ir,e);break;case l.Get:e(),r=B.get(o,h);break;case l.Set:e(),r=B.set(o.key,o.value,h);break;case l.ImportScripts:e(),r=u.importScripts_(t);break;case l.ChangeLogStatus:e(),u.logger.status=o,r=Promise.resolve();break;case l.Middleware:return e(),nt(o)?(u.middlewares.push(o),C()):ye(new q($,o));default:r=C()}return u.logger.log("Executing query ".concat(t.name," in web worker")),r},n.prototype.callMiddleware_=function(t,e){return k(function(r){var o=0,u=Ae(t)-1,h=function(){if(o<=u){var p=t[o++](e);p instanceof Promise||(p=C(p)),p.then(function(m){e=m,h()})}else r(e)};h()})},n.prototype.run=function(t){var e=this,r=[],o=[];t.onResult=function(u){r.push(function(h){return u(h)})},t.beforeExecute=function(u){o.push(function(h){return u(h)})},this.executeMiddleware_(t).then(function(u){return e.executeQuery(t,function(){return e.callMiddleware_(o)}).then(function(h){return e.callMiddleware_(r,h).then(function(p){e.returnResult_({result:p})})})}).catch(function(u){r=[];var h={error:ut(u)};e.returnResult_(h)})},n.prototype.importScripts_=function(t){return k(function(e,r){try{importScripts.apply(void 0,t.query),e()}catch(o){r(new q(_,o.message))}})},n.prototype.returnResult_=function(t){this.logger.log("Query finished inside web worker"),this.util&&this.util.emptyTx(),this.onQryFinished(t)},n.prototype.dropDb=function(){var t=this.db.name;return this.terminate().then(function(){return new Hn().execute(t)})},n.prototype.closeDb=function(){return this.util.close()},n.prototype.terminate=function(){var t=this;return this.closeDb().then(function(){t.util.db=null})},n.prototype.openDb=function(t){var e=this;return this.closeDb().then(function(r){return(e.db&&t.name===e.db.name?e.initDb():e.initDb({name:t.name,tables:[],version:t.version})).then(function(){return e.db})})},n.prototype.initDb=function(t){var e=this;if(!In)return ye(new q(ge));var r=t?new U(t):this.db;return this.util=new ie,k(function(o,u){e.util.initDb(r).then(function(h){h.isCreated?B.get(B.dbSchema,e.util).then(function(p){p&&p.tables.forEach(function(m,b){var x=r.tables.find(function(M){return M.name===m.name});if(x)for(var E in m.autoIncColumnValue){var A=m.autoIncColumnValue[E];A&&(x.autoIncColumnValue[E]=A)}}),e.util.db=r,h.database=kt(e.db),B.set(B.dbSchema,r,e.util).then(function(){o(h)})}):B.get(B.dbSchema,e.util).then(function(p){e.util.db=p,h.database=kt(e.db),o(h)})}).catch(u)})},n}();if(Mt){var ur=new tn;self.onmessage=function(n){ur.run(n.data)}}Ot.exports=i})()),Ot.exports}var _r={setup(s,i){s.$worker=gr(),s.initQueryManager_()}};const br=_r,Ne=mt("move"),It=mt({width:30,color:"#000",drag:!1}),ke=new ze.exports.Connection;ke.addPlugin(br);const Xe=mt(),Le=mt();let En;Le.subscribe(s=>En=s);async function Sn(){let s=await ke.select({from:"Files"});s.length==0?(await Lt(),s=await ke.select({from:"Files"})):Xe.set(s);let i=localStorage.getItem("ccv");if(i==null)Le.set(s[0]);else{let a=await ke.select({from:"Files",where:{id:parseInt(i)}});a.length==0?Le.set(s[0]):Le.set(a[0])}return s}async function On(){await ke.initDb({name:"Canvas",tables:[{name:"Files",columns:{id:{autoIncrement:!0,primaryKey:!0},name:{dataType:ze.exports.DATA_TYPE.String,notNull:!0},blocks:{dataType:ze.exports.DATA_TYPE.Object,notNull:!0},createdData:{dataType:ze.exports.DATA_TYPE.DateTime,notNull:!0},lastUpdate:{dataType:ze.exports.DATA_TYPE.DateTime,notNull:!0}}}]})&&Lt(),await Sn()}On();async function sn(s,i){await ke.update({in:"Files",set:{blocks:i},where:{id:s}}),Xe.set(await ke.select({from:"Files"}))}async function Lt(s="New Canvas"){await ke.insert({into:"Files",values:[{name:s,blocks:{},createdData:new Date,lastUpdate:new Date}]}),Xe.set(await ke.select({from:"Files"}))}async function wr(s){if(await ke.remove({from:"Files",where:{id:s}}),En.id==s){let i=await Sn();Le.set(i[0])}Xe.set(await ke.select({from:"Files"}))}async function kr(){await ke.dropDb(),On()}function xr(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),R(a,"d","M18 11h-5V6h3l-4-4-4 4h3v5H6V8l-4 4 4 4v-3h5v5H8l4 4 4-4h-3v-5h5v3l4-4-4-4z"),R(i,"viewBox","0 0 24 24")},m(c,l){te(c,i,l),L(i,a)},p:K,i:K,o:K,d(c){c&&H(i)}}}class Cr extends qe{constructor(i){super(),Oe(this,i,null,xr,xe,{})}}function Tr(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),R(a,"d","M8.707 19.707 18 10.414 13.586 6l-9.293 9.293a1.003 1.003 0 0 0-.263.464L3 21l5.242-1.03c.176-.044.337-.135.465-.263zM21 7.414a2 2 0 0 0 0-2.828L19.414 3a2 2 0 0 0-2.828 0L15 4.586 19.414 9 21 7.414z"),R(i,"viewBox","0 0 24 24")},m(c,l){te(c,i,l),L(i,a)},p:K,i:K,o:K,d(c){c&&H(i)}}}class Er extends qe{constructor(i){super(),Oe(this,i,null,Tr,xe,{})}}function Sr(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),R(a,"d","M12.48 3 7.73 7.75 3 12.59a2 2 0 0 0 0 2.82l4.3 4.3A1 1 0 0 0 8 20h12v-2h-7l7.22-7.22a2 2 0 0 0 0-2.83L15.31 3a2 2 0 0 0-2.83 0zM8.41 18l-4-4 4.75-4.84.74-.75 4.95 4.95-4.56 4.56-.07.08z"),R(i,"viewBox","0 0 24 24")},m(c,l){te(c,i,l),L(i,a)},p:K,i:K,o:K,d(c){c&&H(i)}}}class Or extends qe{constructor(i){super(),Oe(this,i,null,Sr,xe,{})}}function qr(s){let i,a,c,l,g,f,v,T,w,C,k,S;return c=new Cr({}),f=new Er({}),w=new Or({}),{c(){i=F("nav"),a=F("button"),je(c.$$.fragment),l=le(),g=F("button"),je(f.$$.fragment),v=le(),T=F("button"),je(w.$$.fragment),R(a,"class","svelte-1t2igyd"),_e(a,"selected",s[0]=="move"),R(g,"class","svelte-1t2igyd"),_e(g,"selected",s[0]=="pen"),R(T,"class","svelte-1t2igyd"),_e(T,"selected",s[0]=="eraser"),R(i,"class","svelte-1t2igyd")},m(D,Q){te(D,i,Q),L(i,a),Te(c,a,null),L(i,l),L(i,g),Te(f,g,null),L(i,v),L(i,T),Te(w,T,null),C=!0,k||(S=[re(a,"click",s[1]),re(g,"click",s[2]),re(T,"click",s[3])],k=!0)},p(D,[Q]){(!C||Q&1)&&_e(a,"selected",D[0]=="move"),(!C||Q&1)&&_e(g,"selected",D[0]=="pen"),(!C||Q&1)&&_e(T,"selected",D[0]=="eraser")},i(D){C||(fe(c.$$.fragment,D),fe(f.$$.fragment,D),fe(w.$$.fragment,D),C=!0)},o(D){pe(c.$$.fragment,D),pe(f.$$.fragment,D),pe(w.$$.fragment,D),C=!1},d(D){D&&H(i),Ee(c),Ee(f),Ee(w),k=!1,Se(S)}}}function Ar(s,i,a){let c;return Ne.subscribe(v=>a(0,c=v)),[c,()=>Ne.set("move"),()=>Ne.set("pen"),()=>Ne.set("eraser")]}class jr extends qe{constructor(i){super(),Oe(this,i,Ar,qr,xe,{})}}function Ir(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),R(a,"d","M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"),R(i,"viewBox","0 0 24 24")},m(c,l){te(c,i,l),L(i,a)},p:K,i:K,o:K,d(c){c&&H(i)}}}class Dr extends qe{constructor(i){super(),Oe(this,i,null,Ir,xe,{})}}function Nr(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),R(a,"d","m16.192 6.344-4.243 4.242-4.242-4.242-1.414 1.414L10.535 12l-4.242 4.242 1.414 1.414 4.242-4.242 4.243 4.242 1.414-1.414L13.364 12l4.242-4.242z"),R(i,"viewBox","0 0 24 24")},m(c,l){te(c,i,l),L(i,a)},p:K,i:K,o:K,d(c){c&&H(i)}}}class Rr extends qe{constructor(i){super(),Oe(this,i,null,Nr,xe,{})}}function Qr(s){const i=a=>{s.contains(a.target)||s.dispatchEvent(new CustomEvent("outclick"))};return document.addEventListener("click",i,!0),{destroy(){document.removeEventListener("click",i,!0)}}}function an(s,i,a){const c=s.slice();return c[12]=i[a],c}function Lr(s){let i,a,c,l,g,f,v,T,w,C,k,S,D,Q,j,W,P,z,ce,Ce;l=new Rr({});let ge=s[1],y=[];for(let d=0;d<ge.length;d+=1)y[d]=cn(an(s,ge,d));return{c(){i=F("div"),a=F("span"),c=F("button"),je(l.$$.fragment),g=le(),f=F("h3"),f.textContent="Settings",v=le(),T=F("h4"),T.textContent="Files",w=le(),C=F("span");for(let d=0;d<y.length;d+=1)y[d].c();k=le(),S=F("span"),D=F("button"),D.textContent="Save",Q=le(),j=F("button"),j.textContent="New",W=le(),P=F("button"),P.textContent="Delete All",R(c,"class","close svelte-1nbyll3"),R(f,"class","title svelte-1nbyll3"),R(a,"class","svelte-1nbyll3"),R(T,"class","title svelte-1nbyll3"),R(C,"class","files svelte-1nbyll3"),R(D,"class","save svelte-1nbyll3"),R(j,"class","new svelte-1nbyll3"),R(S,"class","optbtn svelte-1nbyll3"),R(P,"class","rsa svelte-1nbyll3"),R(i,"class","view svelte-1nbyll3")},m(d,_){te(d,i,_),L(i,a),L(a,c),Te(l,c,null),L(a,g),L(a,f),L(i,v),L(i,T),L(i,w),L(i,C);for(let O=0;O<y.length;O+=1)y[O].m(C,null);L(i,k),L(i,S),L(S,D),L(S,Q),L(S,j),L(i,W),L(i,P),z=!0,ce||(Ce=[re(c,"click",s[5]),re(D,"click",s[8]),re(j,"click",s[9]),re(P,"click",s[10])],ce=!0)},p(d,_){if(_&6){ge=d[1];let O;for(O=0;O<ge.length;O+=1){const $=an(d,ge,O);y[O]?y[O].p($,_):(y[O]=cn($),y[O].c(),y[O].m(C,null))}for(;O<y.length;O+=1)y[O].d(1);y.length=ge.length}},i(d){z||(fe(l.$$.fragment,d),z=!0)},o(d){pe(l.$$.fragment,d),z=!1},d(d){d&&H(i),Ee(l),Nt(y,d),ce=!1,Se(Ce)}}}function $r(s){let i,a,c,l,g;return a=new Dr({}),{c(){i=F("button"),je(a.$$.fragment),R(i,"class","open svelte-1nbyll3")},m(f,v){te(f,i,v),Te(a,i,null),c=!0,l||(g=re(i,"click",s[4]),l=!0)},p:K,i(f){c||(fe(a.$$.fragment,f),c=!0)},o(f){pe(a.$$.fragment,f),c=!1},d(f){f&&H(i),Ee(a),l=!1,g()}}}function cn(s){let i,a=s[12].name+"",c,l,g=`${s[12].createdData.getDate()}.${s[12].createdData.getMonth()}.${s[12].createdData.getFullYear()}`,f,v,T,w,C,k;function S(){return s[6](s[12])}function D(){return s[7](s[12])}return{c(){i=F("button"),c=Re(a),l=Re(" / "),f=Re(g),v=le(),T=F("button"),T.textContent="X",w=le(),R(T,"class","del svelte-1nbyll3"),R(i,"class","svelte-1nbyll3"),_e(i,"sel",s[2].id==s[12].id)},m(Q,j){te(Q,i,j),L(i,c),L(i,l),L(i,f),L(i,v),L(i,T),L(i,w),C||(k=[re(T,"click",S),re(i,"dblclick",D)],C=!0)},p(Q,j){s=Q,j&2&&a!==(a=s[12].name+"")&&on(c,a),j&2&&g!==(g=`${s[12].createdData.getDate()}.${s[12].createdData.getMonth()}.${s[12].createdData.getFullYear()}`)&&on(f,g),j&6&&_e(i,"sel",s[2].id==s[12].id)},d(Q){Q&&H(i),C=!1,Se(k)}}}function Mr(s){let i,a,c,l,g,f;const v=[$r,Lr],T=[];function w(C,k){return C[0]?1:0}return a=w(s),c=T[a]=v[a](s),{c(){i=F("div"),c.c(),R(i,"class","settingBuble svelte-1nbyll3")},m(C,k){te(C,i,k),T[a].m(i,null),l=!0,g||(f=[lr(Qr.call(null,i)),re(i,"outclick",s[11])],g=!0)},p(C,[k]){let S=a;a=w(C),a===S?T[a].p(C,k):(Rt(),pe(T[S],1,1,()=>{T[S]=null}),Qt(),c=T[a],c?c.p(C,k):(c=T[a]=v[a](C),c.c()),fe(c,1),c.m(i,null))},i(C){l||(fe(c),l=!0)},o(C){pe(c),l=!1},d(C){C&&H(i),T[a].d(),g=!1,Se(f)}}}function Pr(s,i,a){const c=kn();let l=!1,g;Xe.subscribe(j=>a(1,g=j));let f;return Le.subscribe(j=>a(2,f=j)),[l,g,f,c,()=>a(0,l=!0),()=>a(0,l=!1),j=>wr(j.id),j=>{Le.set(j),localStorage.setItem("ccv",`${j.id}`)},async()=>c("save"),async()=>{let j=prompt("What do you name the new canvas: ");await Lt(j)},()=>kr(),()=>a(0,l=!1)]}class Br extends qe{constructor(i){super(),Oe(this,i,Pr,Mr,xe,{})}}const{window:Wr}=Cn;function Vr(s){let i,a,c,l,g;return{c(){i=F("canvas"),a=le(),c=F("div"),R(i,"class","svelte-attco8"),_e(i,"nocursor",s[1]!="move"),_e(i,"movecursor",s[1]=="move"),R(c,"class","brush svelte-attco8"),_e(c,"hide",s[1]=="move"),he(c,"width",`${s[2].width}px`),he(c,"height",`${s[2].width}px`),he(c,"top",`${s[5]}px`),he(c,"left",`${s[4]}px`),he(c,"border",`1px solid ${s[2].color}`)},m(f,v){te(f,i,v),s[10](i),te(f,a,v),te(f,c,v),s[11](c),l||(g=[re(Wr,"resize",s[6]),re(i,"mousedown",s[8]),re(i,"mousemove",s[7]),re(i,"mouseup",s[9])],l=!0)},p(f,[v]){v&2&&_e(i,"nocursor",f[1]!="move"),v&2&&_e(i,"movecursor",f[1]=="move"),v&2&&_e(c,"hide",f[1]=="move"),v&4&&he(c,"width",`${f[2].width}px`),v&4&&he(c,"height",`${f[2].width}px`),v&32&&he(c,"top",`${f[5]}px`),v&16&&he(c,"left",`${f[4]}px`),v&4&&he(c,"border",`1px solid ${f[2].color}`)},i:K,o:K,d(f){f&&H(i),s[10](null),f&&H(a),f&&H(c),s[11](null),l=!1,Se(g)}}}function Fr(s,i,a){let c=kn(),l;Ne.subscribe(d=>a(1,l=d));let g;It.subscribe(d=>a(2,g=d));let f,v,T=!1,w,C=0,k=0,S=newVector(500,500);function D(){a(0,f.width=window.innerWidth,f),a(0,f.height=window.innerHeight,f)}function Q(d){a(4,C=d.clientX),a(5,k=d.clientY),!!T&&(l=="pen"||l=="eraser")&&W(d)}function j(d,_){let O=newVector(d,_);if(S.distance(O)>8){let J=S.sub(O).norm().mul(10);return O.add(J)}return S}function W({clientX:d,clientY:_}){g.drag&&l!="eraser"?S=j(d,_):(S.x=d,S.y=_),v.lineTo(S.x,S.y),v.stroke(),v.beginPath(),v.moveTo(S.x,S.y)}function P(){v.globalCompositeOperation="source-over",v.lineWidth=g.width,v.lineCap="round",v.strokeStyle="white",a(0,f.style.opacity=".5",f)}function z(){v.lineWidth=g.width,v.lineCap="round",v.strokeStyle=g.color,a(0,f.style.opacity="",f)}function ce(d){d.button==0&&(T=!0,l=="pen"?z():l=="eraser"&&P(),S.x=d.clientX,S.y=d.clientY,v.beginPath(),v.moveTo(d.clientX,d.clientY),Q(d))}async function Ce({button:d}){d==0&&(T=!1,l=="pen"?c("imgout",{width:f.width,height:f.height,image:await createImageBitmap(v.getImageData(0,0,f.width,f.height))}):l=="eraser"&&c("imgoute",{width:f.width,height:f.height,image:await createImageBitmap(v.getImageData(0,0,f.width,f.height))}),setTimeout(()=>{v.clearRect(0,0,f.width,f.height)},60))}wn(()=>D());function ge(d){Qe[d?"unshift":"push"](()=>{f=d,a(0,f)})}function y(d){Qe[d?"unshift":"push"](()=>{w=d,a(3,w)})}return s.$$.update=()=>{s.$$.dirty&1&&f&&(v=f.getContext("2d"))},[f,l,g,w,C,k,D,Q,ce,Ce,ge,y]}class Ur extends qe{constructor(i){super(),Oe(this,i,Fr,Vr,xe,{})}}const{window:pt}=Cn;function ln(s,i,a){const c=s.slice();return c[28]=i[a],c}function fn(s,i,a){const c=s.slice();c[31]=i[a],c[34]=i,c[35]=a;const l=c[31];return c[32]=l.x,c[33]=l.y,c}function hn(s){let i,a=s[34],c=s[35];const l=()=>s[23](i,a,c),g=()=>s[23](null,a,c);return{c(){i=F("canvas"),R(i,"width",ee),R(i,"height",ee),he(i,"top",`${s[33]*ee}px`),he(i,"left",`${s[32]*ee}px`)},m(f,v){te(f,i,v),l()},p(f,v){s=f,(a!==s[34]||c!==s[35])&&(g(),a=s[34],c=s[35],l()),v[0]&512&&he(i,"top",`${s[33]*ee}px`),v[0]&512&&he(i,"left",`${s[32]*ee}px`)},d(f){f&&H(i),g()}}}function pn(s){let i,a=s[28],c=[];for(let l=0;l<a.length;l+=1)c[l]=hn(fn(s,a,l));return{c(){for(let l=0;l<c.length;l+=1)c[l].c();i=fr()},m(l,g){for(let f=0;f<c.length;f+=1)c[f].m(l,g);te(l,i,g)},p(l,g){if(g[0]&512){a=l[28];let f;for(f=0;f<a.length;f+=1){const v=fn(l,a,f);c[f]?c[f].p(v,g):(c[f]=hn(v),c[f].c(),c[f].m(i.parentNode,i))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(l){Nt(c,l),l&&H(i)}}}function Gr(s){let i,a,c,l,g=s[9],f=[];for(let v=0;v<g.length;v+=1)f[v]=pn(ln(s,g,v));return{c(){i=F("div"),a=F("div");for(let v=0;v<f.length;v+=1)f[v].c();R(a,"class","shift svelte-osbjy1"),he(a,"top",`${-s[3]}px`),he(a,"left",`${-s[2]}px`),R(i,"class","view svelte-osbjy1")},m(v,T){te(v,i,T),L(i,a);for(let w=0;w<f.length;w+=1)f[w].m(a,null);c||(l=[re(pt,"resize",s[13]),re(pt,"mousedown",s[20]),re(pt,"mouseup",s[21]),re(pt,"mousemove",s[22])],c=!0)},p(v,T){if(T[0]&512){g=v[9];let w;for(w=0;w<g.length;w+=1){const C=ln(v,g,w);f[w]?f[w].p(C,T):(f[w]=pn(C),f[w].c(),f[w].m(a,null))}for(;w<f.length;w+=1)f[w].d(1);f.length=g.length}T[0]&8&&he(a,"top",`${-v[3]}px`),T[0]&4&&he(a,"left",`${-v[2]}px`)},i:K,o:K,d(v){v&&H(i),Nt(f,v),c=!1,Se(l)}}}let ee=480;function Kr(s,i,a){let c;Ne.subscribe(U=>a(0,c=U));let l,g,f=0,v=0,T=0,w=0,C=0,k=0,S=C,D=k,Q={},j={},W=[],P,z=!1;function ce(){a(18,T=Math.floor(C/ee)),a(19,w=Math.floor(k/ee)),a(2,f=Math.abs(T*ee-C)),a(3,v=Math.abs(w*ee-k))}function Ce(){g=(window.innerWidth+ee)/ee,g=g%1>0?Math.floor(g)+1:g}function ge(){let U=[];for(let Y=0;Y<g;Y++){let q=[];for(let ie=0;ie<g;ie++)q.push({x:Y,y:ie,element:null});U.push(q)}a(9,W=U)}async function y(){for(let U of W)for(let Y of U){let q=`${T+Y.x},${w+Y.y}`;if(q in Q){if(Y.element!=null){let ie=Y.element.getContext("2d");ie.clearRect(0,0,ee,ee),Q[q]!=null&&(q in j||(j[q]=await createImageBitmap(Q[q])),ie.drawImage(j[q],0,0))}}else a(8,Q[q]=null,Q),Y.element!=null&&Y.element.getContext("2d").clearRect(0,0,ee,ee)}}const d=async U=>{for(let Y of W)for(let q of Y){let ie=`${T+q.x},${w+q.y}`,de=q.element.getContext("2d");de.globalCompositeOperation="source-over",de.drawImage(U,-(q.x*ee-f),-(q.y*ee-v)),a(8,Q[ie]=de.getImageData(0,0,ee,ee),Q)}},_=async U=>{for(let Y of W)for(let q of Y){let ie=`${T+q.x},${w+q.y}`,de=q.element.getContext("2d");de.globalCompositeOperation="destination-out",de.drawImage(U,-(q.x*ee-f)-1,-(q.y*ee-v)-1),a(8,Q[ie]=de.getImageData(0,0,ee,ee),Q)}},O=()=>{sn(l,Q)};ce(),Ce(),ge(),Le.subscribe(async U=>{!U||(a(1,l=U.id),a(6,S=C),a(7,D=k),a(8,Q=U.blocks),j={},console.log(Q),ce(),y())});const $=({button:U,clientX:Y,clientY:q})=>{(U==1||U==0&&c=="move")&&(a(11,z=!0),a(10,P={x:Y,y:q}))},J=({button:U})=>{(U==1||U==0&&c=="move")&&(a(11,z=!1),a(6,S=C),a(7,D=k)),setTimeout(()=>sn(l,Q),5e3)},oe=({clientX:U,clientY:Y})=>{z&&(a(4,C=P.x-U+S),a(5,k=P.y-Y+D),ce())};function B(U,Y,q){Qe[U?"unshift":"push"](()=>{Y[q].element=U,a(9,W)})}return s.$$.update=()=>{s.$$.dirty[0]&786432&&T!=null&&w!=null&&y()},[c,l,f,v,C,k,S,D,Q,W,P,z,ce,Ce,y,d,_,O,T,w,$,J,oe,B]}class Jr extends qe{constructor(i){super(),Oe(this,i,Kr,Gr,xe,{drawToMC:15,eraserMC:16,saveCanvas:17},null,[-1,-1])}get drawToMC(){return this.$$.ctx[15]}get eraserMC(){return this.$$.ctx[16]}get saveCanvas(){return this.$$.ctx[17]}}function dn(s){let i,a,c,l,g;return{c(){i=F("label"),a=Re("Color: "),c=F("input"),R(c,"type","color"),R(c,"class","svelte-14xd3si"),R(i,"for",""),R(i,"class","svelte-14xd3si")},m(f,v){te(f,i,v),L(i,a),L(i,c),Ye(c,s[1]),l||(g=re(c,"input",s[5]),l=!0)},p(f,v){v&2&&Ye(c,f[1])},d(f){f&&H(i),l=!1,g()}}}function yn(s){let i,a,c,l,g;return{c(){i=F("label"),a=Re("Drag: "),c=F("input"),R(c,"type","checkbox"),R(c,"class","svelte-14xd3si"),R(i,"for",""),R(i,"class","svelte-14xd3si")},m(f,v){te(f,i,v),L(i,a),L(i,c),Ye(c,s[2]),l||(g=re(c,"change",s[6]),l=!0)},p(f,v){v&4&&Ye(c,f[2])},d(f){f&&H(i),l=!1,g()}}}function zr(s){let i,a,c,l,g,f,v,T,w=s[3]=="pen"&&dn(s),C=s[3]=="pen"&&yn(s);return{c(){i=F("div"),a=F("label"),c=Re("Size: "),l=F("input"),g=le(),w&&w.c(),f=le(),C&&C.c(),R(l,"type","number"),R(l,"class","svelte-14xd3si"),R(a,"for",""),R(a,"class","svelte-14xd3si"),R(i,"class","props svelte-14xd3si")},m(k,S){te(k,i,S),L(i,a),L(a,c),L(a,l),Ye(l,s[0]),L(i,g),w&&w.m(i,null),L(i,f),C&&C.m(i,null),v||(T=re(l,"input",s[4]),v=!0)},p(k,[S]){S&1&&_n(l.value)!==k[0]&&Ye(l,k[0]),k[3]=="pen"?w?w.p(k,S):(w=dn(k),w.c(),w.m(i,f)):w&&(w.d(1),w=null),k[3]=="pen"?C?C.p(k,S):(C=yn(k),C.c(),C.m(i,null)):C&&(C.d(1),C=null)},i:K,o:K,d(k){k&&H(i),w&&w.d(),C&&C.d(),v=!1,T()}}}function Yr(s,i,a){let c;It.subscribe(k=>c=k);let l;Ne.subscribe(k=>a(3,l=k));let g=c.width,f=c.color,v=c.drag;function T(){g=_n(this.value),a(0,g)}function w(){f=this.value,a(1,f)}function C(){v=this.value,a(2,v)}return s.$$.update=()=>{s.$$.dirty&7&&It.set({width:g,color:f,drag:v})},[g,f,v,l,T,w,C]}class Xr extends qe{constructor(i){super(),Oe(this,i,Yr,zr,xe,{})}}function mn(s){let i,a,c,l,g,f,v,T,w,C;i=new jr({}),l=new Br({}),l.$on("save",s[11]);let k=(s[1]=="pen"||s[1]=="eraser")&&vn();return{c(){je(i.$$.fragment),a=le(),c=F("div"),je(l.$$.fragment),g=le(),k&&k.c(),f=le(),v=F("div"),T=le(),w=F("p"),w.textContent="Controls: Middle mouse button for movement, shift to hide ui overlay. If there is an error report and restart.",R(c,"class","sb svelte-yr4ca7"),R(w,"id","ist"),R(w,"class","svelte-yr4ca7")},m(S,D){Te(i,S,D),te(S,a,D),te(S,c,D),Te(l,c,null),L(c,g),k&&k.m(c,null),L(c,f),L(c,v),te(S,T,D),te(S,w,D),C=!0},p(S,D){S[1]=="pen"||S[1]=="eraser"?k?D&2&&fe(k,1):(k=vn(),k.c(),fe(k,1),k.m(c,f)):k&&(Rt(),pe(k,1,1,()=>{k=null}),Qt())},i(S){C||(fe(i.$$.fragment,S),fe(l.$$.fragment,S),fe(k),C=!0)},o(S){pe(i.$$.fragment,S),pe(l.$$.fragment,S),pe(k),C=!1},d(S){Ee(i,S),S&&H(a),S&&H(c),Ee(l),k&&k.d(),S&&H(T),S&&H(w)}}}function vn(s){let i,a;return i=new Xr({}),{c(){je(i.$$.fragment)},m(c,l){Te(i,c,l),a=!0},i(c){a||(fe(i.$$.fragment,c),a=!0)},o(c){pe(i.$$.fragment,c),a=!1},d(c){Ee(i,c)}}}function Hr(s){let i,a,c,l,g,f,v,T,w,C,k;function S(P){s[6](P)}function D(P){s[7](P)}function Q(P){s[8](P)}let j={};s[2]!==void 0&&(j.drawToMC=s[2]),s[3]!==void 0&&(j.eraserMC=s[3]),s[4]!==void 0&&(j.saveCanvas=s[4]),a=new Jr({props:j}),Qe.push(()=>St(a,"drawToMC",S)),Qe.push(()=>St(a,"eraserMC",D)),Qe.push(()=>St(a,"saveCanvas",Q)),v=new Ur({}),v.$on("imgout",s[9]),v.$on("imgoute",s[10]);let W=!s[0]&&mn(s);return{c(){i=F("main"),je(a.$$.fragment),f=le(),je(v.$$.fragment),T=le(),W&&W.c(),R(i,"class","svelte-yr4ca7")},m(P,z){te(P,i,z),Te(a,i,null),L(i,f),Te(v,i,null),L(i,T),W&&W.m(i,null),w=!0,C||(k=re(window,"keydown",s[5]),C=!0)},p(P,[z]){const ce={};!c&&z&4&&(c=!0,ce.drawToMC=P[2],Tt(()=>c=!1)),!l&&z&8&&(l=!0,ce.eraserMC=P[3],Tt(()=>l=!1)),!g&&z&16&&(g=!0,ce.saveCanvas=P[4],Tt(()=>g=!1)),a.$set(ce),P[0]?W&&(Rt(),pe(W,1,1,()=>{W=null}),Qt()):W?(W.p(P,z),z&1&&fe(W,1)):(W=mn(P),W.c(),fe(W,1),W.m(i,null))},i(P){w||(fe(a.$$.fragment,P),fe(v.$$.fragment,P),fe(W),w=!0)},o(P){pe(a.$$.fragment,P),pe(v.$$.fragment,P),pe(W),w=!1},d(P){P&&H(i),Ee(a),Ee(v),W&&W.d(),C=!1,k()}}}function Zr(s,i,a){let c=!1,l;Ne.subscribe(j=>a(1,l=j)),Xe.subscribe(j=>j);let g,f,v;wn(()=>{});const T=({shiftKey:j})=>{j&&a(0,c=!c)};function w(j){g=j,a(2,g)}function C(j){f=j,a(3,f)}function k(j){v=j,a(4,v)}return[c,l,g,f,v,T,w,C,k,({detail:j})=>{g(j.image)},({detail:j})=>{f(j.image)},()=>v()]}class eo extends qe{constructor(i){super(),Oe(this,i,Zr,Hr,xe,{})}}window.gcd=function(s,i){return i==0?s:gcd(i,s%i)};window.aspectRatio=function(s,i){let a=gcd(s,i);return[s/a,i/a]};class Pe{constructor(i=1,a=1){Ct(this,"x");Ct(this,"y");this.x=i,this.y=a}len(){return Math.sqrt(this.x**2+this.y**2)}norm(){let i=this.len();return new Pe(this.x/i,this.y/i)}distance(i){var a=this.x-i.x,c=this.y-i.y,l=Math.sqrt(a*a+c*c);return Math.abs(l)}angle(i){return(-(Math.atan2(this.x-i.x,this.y-i.y)*(180/Math.PI))%360+360)%360}add(i){let a=this.x+i.x,c=this.y+i.y;return new Pe(a,c)}sub(i){let a=this.x-i.x,c=this.y-i.y;return new Pe(a,c)}mul(i){return new Pe(this.x*i,this.y*i)}clone(){return new Pe(this.x,this.y)}}window.newVector=(s=0,i=0)=>new Pe(s,i);new eo({target:document.getElementById("app")});
