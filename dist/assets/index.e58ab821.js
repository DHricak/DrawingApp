var sr=Object.defineProperty;var ar=(s,i,a)=>i in s?sr(s,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[i]=a;var Tt=(s,i,a)=>(ar(s,typeof i!="symbol"?i+"":i,a),a);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const g of l)if(g.type==="childList")for(const f of g.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&c(f)}).observe(document,{childList:!0,subtree:!0});function a(l){const g={};return l.integrity&&(g.integrity=l.integrity),l.referrerpolicy&&(g.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?g.credentials="include":l.crossorigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function c(l){if(l.ep)return;l.ep=!0;const g=a(l);fetch(l.href,g)}})();function K(){}function _n(s){return s()}function on(){return Object.create(null)}function Se(s){s.forEach(_n)}function Nt(s){return typeof s=="function"}function xe(s,i){return s!=s?i==i:s!==i||s&&typeof s=="object"||typeof s=="function"}let pt;function cr(s,i){return pt||(pt=document.createElement("a")),pt.href=i,s===pt.href}function lr(s){return Object.keys(s).length===0}function fr(s){return s&&Nt(s.destroy)?s.destroy:K}function M(s,i){s.appendChild(i)}function Y(s,i,a){s.insertBefore(i,a||null)}function J(s){s.parentNode&&s.parentNode.removeChild(s)}function Rt(s,i){for(let a=0;a<s.length;a+=1)s[a]&&s[a].d(i)}function V(s){return document.createElement(s)}function Ie(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Re(s){return document.createTextNode(s)}function ce(){return Re(" ")}function hr(){return Re("")}function re(s,i,a,c){return s.addEventListener(i,a,c),()=>s.removeEventListener(i,a,c)}function I(s,i,a){a==null?s.removeAttribute(i):s.getAttribute(i)!==a&&s.setAttribute(i,a)}function bn(s){return s===""?null:+s}function pr(s){return Array.from(s.childNodes)}function un(s,i){i=""+i,s.wholeText!==i&&(s.data=i)}function Ye(s,i){s.value=i==null?"":i}function he(s,i,a,c){a===null?s.style.removeProperty(i):s.style.setProperty(i,a,c?"important":"")}function _e(s,i,a){s.classList[a?"add":"remove"](i)}function dr(s,i,{bubbles:a=!1,cancelable:c=!1}={}){const l=document.createEvent("CustomEvent");return l.initCustomEvent(s,a,c,i),l}let it;function ot(s){it=s}function wn(){if(!it)throw new Error("Function called outside component initialization");return it}function mr(s){wn().$$.on_mount.push(s)}function kn(){const s=wn();return(i,a,{cancelable:c=!1}={})=>{const l=s.$$.callbacks[i];if(l){const g=dr(i,a,{cancelable:c});return l.slice().forEach(f=>{f.call(s,g)}),!g.defaultPrevented}return!0}}const Je=[],Qe=[],mt=[],At=[],yr=Promise.resolve();let jt=!1;function vr(){jt||(jt=!0,yr.then(xn))}function It(s){mt.push(s)}function Et(s){At.push(s)}const St=new Set;let Ge=0;function xn(){if(Ge!==0)return;const s=it;do{try{for(;Ge<Je.length;){const i=Je[Ge];Ge++,ot(i),gr(i.$$)}}catch(i){throw Je.length=0,Ge=0,i}for(ot(null),Je.length=0,Ge=0;Qe.length;)Qe.pop()();for(let i=0;i<mt.length;i+=1){const a=mt[i];St.has(a)||(St.add(a),a())}mt.length=0}while(Je.length);for(;At.length;)At.pop()();jt=!1,St.clear(),ot(s)}function gr(s){if(s.fragment!==null){s.update(),Se(s.before_update);const i=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,i),s.after_update.forEach(It)}}const yt=new Set;let Be;function Qt(){Be={r:0,c:[],p:Be}}function Lt(){Be.r||Se(Be.c),Be=Be.p}function fe(s,i){s&&s.i&&(yt.delete(s),s.i(i))}function pe(s,i,a,c){if(s&&s.o){if(yt.has(s))return;yt.add(s),Be.c.push(()=>{yt.delete(s),c&&(a&&s.d(1),c())}),s.o(i)}else c&&c()}const Cn=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ot(s,i,a){const c=s.$$.props[i];c!==void 0&&(s.$$.bound[c]=a,a(s.$$.ctx[c]))}function je(s){s&&s.c()}function Te(s,i,a,c){const{fragment:l,after_update:g}=s.$$;l&&l.m(i,a),c||It(()=>{const f=s.$$.on_mount.map(_n).filter(Nt);s.$$.on_destroy?s.$$.on_destroy.push(...f):Se(f),s.$$.on_mount=[]}),g.forEach(It)}function Ee(s,i){const a=s.$$;a.fragment!==null&&(Se(a.on_destroy),a.fragment&&a.fragment.d(i),a.on_destroy=a.fragment=null,a.ctx=[])}function _r(s,i){s.$$.dirty[0]===-1&&(Je.push(s),vr(),s.$$.dirty.fill(0)),s.$$.dirty[i/31|0]|=1<<i%31}function Oe(s,i,a,c,l,g,f,v=[-1]){const T=it;ot(s);const k=s.$$={fragment:null,ctx:[],props:g,update:K,not_equal:l,bound:on(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(T?T.$$.context:[])),callbacks:on(),dirty:v,skip_bound:!1,root:i.target||T.$$.root};f&&f(k.root);let C=!1;if(k.ctx=a?a(s,i.props||{},(x,q,...$)=>{const R=$.length?$[0]:q;return k.ctx&&l(k.ctx[x],k.ctx[x]=R)&&(!k.skip_bound&&k.bound[x]&&k.bound[x](R),C&&_r(s,x)),q}):[],k.update(),C=!0,Se(k.before_update),k.fragment=c?c(k.ctx):!1,i.target){if(i.hydrate){const x=pr(i.target);k.fragment&&k.fragment.l(x),x.forEach(J)}else k.fragment&&k.fragment.c();i.intro&&fe(s.$$.fragment),Te(s,i.target,i.anchor,i.customElement),xn()}ot(T)}class qe{$destroy(){Ee(this,1),this.$destroy=K}$on(i,a){if(!Nt(a))return K;const c=this.$$.callbacks[i]||(this.$$.callbacks[i]=[]);return c.push(a),()=>{const l=c.indexOf(a);l!==-1&&c.splice(l,1)}}$set(i){this.$$set&&!lr(i)&&(this.$$.skip_bound=!0,this.$$set(i),this.$$.skip_bound=!1)}}const Ke=[];function vt(s,i=K){let a;const c=new Set;function l(v){if(xe(s,v)&&(s=v,a)){const T=!Ke.length;for(const k of c)k[1](),Ke.push(k,s);if(T){for(let k=0;k<Ke.length;k+=2)Ke[k][0](Ke[k+1]);Ke.length=0}}}function g(v){l(v(s))}function f(v,T=K){const k=[v,T];return c.add(k),c.size===1&&(a=i(l)||K),v(s),()=>{c.delete(k),c.size===0&&(a(),a=null)}}return{set:l,update:g,subscribe:f}}var ze={exports:{}},Tn={exports:{}};/*! For license information please see jsstore.commonjs2.min.js.LICENSE.txt */(()=>{var s={d:(m,d)=>{for(var _ in d)s.o(d,_)&&!s.o(m,_)&&Object.defineProperty(m,_,{enumerable:!0,get:d[_]})},o:(m,d)=>Object.prototype.hasOwnProperty.call(m,d),r:m=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(m,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(m,"__esModule",{value:!0})}},i={};s.r(i),s.d(i,{API:()=>l,CONNECTION_STATUS:()=>k,Connection:()=>le,DATA_TYPE:()=>c,ERROR_TYPE:()=>x,EVENT:()=>g,IDB_MODE:()=>v,OCCURENCE:()=>T,QUERY_OPTION:()=>f,WORKER_STATUS:()=>a,forObj:()=>ge,promise:()=>$,promiseAll:()=>Ce,promiseResolve:()=>R});var a,c,l,g,f,v,T,k,C=function(){function m(d,_){this.type=d,this._info=_,this.message=this.getMsg()}return m.prototype.throw=function(){throw this},m.prototype.log=function(d){this.status&&console.log(d)},m.prototype.logError=function(){console.error(this.get())},m.prototype.logWarning=function(){console.warn(this.get())},m.prototype.get=function(){return{message:this.message,type:this.type}},m.prototype.getMsg=function(){return this.type,this.message},m}(),x={InvalidUpdateColumn:"invalid_update_column",UndefinedColumn:"undefined_column",UndefinedValue:"undefined_value",UndefinedColumnName:"undefined_column_name",UndefinedDbName:"undefined_database_name",UndefinedColumnValue:"undefined_column_value",NotArray:"not_array",NoValueSupplied:"no_value_supplied",ColumnNotExist:"column_not_exist",NoIndexFound:"no_index_found",InvalidOp:"invalid_operator",NullValue:"null_value",WrongDataType:"wrong_data_type",TableNotExist:"table_not_exist",DbNotExist:"db_not_exist",ConnectionAborted:"connection_aborted",ConnectionClosed:"connection_closed",NotObject:"not_object",InvalidConfig:"invalid_config",DbBlocked:"Db_blocked",IndexedDbNotSupported:"indexeddb_not_supported",NullValueInWhere:"null_value_in_where",InvalidJoinQuery:"invalid_join_query",InvalidQuery:"invalid_query",ImportScriptsFailed:"import_scripts_failed",MethodNotExist:"method_not_exist",Unknown:"unknown",InvalidMiddleware:"invalid_middleware"};(function(m){m.Registered="registerd",m.Failed="failed",m.NotStarted="not_started"})(a||(a={})),function(m){m.String="string",m.Object="object",m.Array="array",m.Number="number",m.Boolean="boolean",m.Null="null",m.DateTime="date_time"}(c||(c={})),function(m){m.InitDb="init_db",m.Get="get",m.Set="set",m.Select="select",m.Insert="insert",m.Update="update",m.Remove="remove",m.OpenDb="open_db",m.Clear="clear",m.DropDb="drop_db",m.Count="count",m.ChangeLogStatus="change_log_status",m.Terminate="terminate",m.Transaction="transaction",m.CloseDb="close_db",m.Union="union",m.Intersect="intersect",m.ImportScripts="import_scripts",m.Middleware="middleware"}(l||(l={})),function(m){m.RequestQueueEmpty="requestQueueEmpty",m.RequestQueueFilled="requestQueueFilled",m.Upgrade="upgrade",m.Create="create",m.Open="open"}(g||(g={})),function(m){m.Where="where",m.Like="like",m.Regex="regex",m.In="in",m.Equal="=",m.Between="-",m.GreaterThan=">",m.LessThan="<",m.GreaterThanEqualTo=">=",m.LessThanEqualTo="<=",m.NotEqualTo="!=",m.Aggregate="aggregate",m.Max="max",m.Min="min",m.Avg="avg",m.Count="count",m.Sum="sum",m.List="list",m.Or="or",m.Skip="skip",m.Limit="limit",m.And="and",m.IgnoreCase="ignoreCase",m.Then="then"}(f||(f={})),function(m){m.ReadOnly="readonly",m.ReadWrite="readwrite"}(v||(v={})),function(m){m.First="f",m.Last="l",m.Any="a"}(T||(T={})),function(m){m.Connected="connected",m.Closed="closed",m.NotStarted="not_started",m.UnableToStart="unable_to_start",m.ClosedByJsStore="closed_by_jsstore"}(k||(k={}));var q,$=function(m){return new Promise(m)},R=function(m){return Promise.resolve(m)},S=function(m,d,_){if(_||arguments.length===2)for(var O,P=0,z=d.length;P<z;P++)!O&&P in d||(O||(O=Array.prototype.slice.call(d,0,P)),O[P]=d[P]);return m.concat(O||Array.prototype.slice.call(d))},j=function(){function m(d){this._events={},this._ctx=d}return m.prototype.on=function(d,_){return this._events[d]==null&&(this._events[d]=[]),this._events[d].push(_),this},m.prototype.off=function(d,_){if(this._events[d])if(_){var O=this._events[d].indexOf(_);this._events[d].splice(O,1)}else this._events[d]=[]},m.prototype.emit=function(d){for(var _=this,O=[],P=1;P<arguments.length;P++)O[P-1]=arguments[P];var z=this._events[d]||[],oe=0,W=z.length,U=[],H=function(){var A=z[oe++];if(A){var ie=A.call.apply(A,S([_._ctx],O,!1));return ie&&ie.then?ie:Promise.resolve(ie)}};return new Promise(function(A){var ie=function(){oe<W?H().then(function(de){U.push(de),ie()}):A(U)};ie()})},m.prototype.destroy=function(){this._events=null,this._ctx=null},m}(),Q=function(){function m(d){this.isConOpened_=!1,this.isDbIdle_=!0,this.requestQueue_=[],this.isCodeExecuting_=!1,this.inactivityTimer_=-1e3,this.middlewares=[],this.eventBus_=new j(this),this.whiteListApi_=[l.InitDb,l.OpenDb,l.Get,l.Set,l.ChangeLogStatus,l.Terminate,l.DropDb],this.isWorker=!0,this.logger=new C(null),d?(this.worker_=d,this.worker_.onmessage=this.onMessageFromWorker_.bind(this)):(this.isWorker=!1,this.initQueryManager_())}return Object.defineProperty(m.prototype,"jsstoreWorker",{get:function(){return this.$worker||self.JsStoreWorker},enumerable:!1,configurable:!0}),m.prototype.initQueryManager_=function(){var d=this.jsstoreWorker;d&&(this.queryManager=new d.QueryManager(this.processFinishedQuery_.bind(this)))},m.prototype.onMessageFromWorker_=function(d){this.processFinishedQuery_(d.data)},m.prototype.processFinishedQuery_=function(d){var _=this.requestQueue_.shift();if(_){if(this.logger.log("request ".concat(_.name," finished")),d.error)_.onError(d.error);else{switch(_.name){case l.OpenDb:case l.InitDb:this.isConOpened_=!0;break;case l.Terminate:this.isConOpened_=!1,this.isWorker===!0&&this.worker_.terminate();case l.DropDb:this.isConOpened_=!1,this.requestQueue_=[],this.isDbIdle_=!0;break;case l.CloseDb:this.requestQueue_.length>0?this.openDb_():(this.isDbIdle_=!0,this.eventBus_.emit(g.RequestQueueEmpty,[]))}_.onSuccess(d.result)}this.isCodeExecuting_=!1,this.executeQry_()}},m.prototype.openDb_=function(){this.prcoessExecutionOfQry_({name:l.OpenDb,query:{name:this.database.name,version:this.database.version},onSuccess:function(){},onError:function(d){console.error(d)}},0)},m.prototype.executeMiddleware_=function(d){var _=this;return $(function(O){var P=0,z=_.middlewares.length-1,oe=function(){if(P<=z){var W=_.middlewares[P++](d);W&&W.then||(W=R(W)),W.then(function(U){oe()})}else O()};oe()})},m.prototype.callResultMiddleware=function(d,_){return $(function(O){var P=0,z=d.length-1,oe=function(){if(P<=z){var W=d[P++](_);W.then||(W=R(W)),W.then(function(U){_=U,oe()})}else O(_)};oe()})},m.prototype.pushApi=function(d){var _=this;return new Promise(function(O,P){var z=[];d.onResult=function(oe){z.push(function(W){return oe(W)})},_.executeMiddleware_(d).then(function(){d.onSuccess=function(oe){_.callResultMiddleware(z,oe).then(function(W){O(W)}).catch(function(W){d.onError(W)})},d.onError=function(oe){z=[],P(oe)},_.requestQueue_.length===0&&(_.eventBus_.emit(g.RequestQueueFilled,[]),[l.CloseDb,l.DropDb,l.OpenDb,l.Terminate].indexOf(d.name)>=0||!_.isDbIdle_||!_.isConOpened_?clearTimeout(_.inactivityTimer_):_.openDb_()),_.prcoessExecutionOfQry_(d)}).catch(P)})},m.prototype.prcoessExecutionOfQry_=function(d,_){this.isDbIdle_=!1,_!=null?this.requestQueue_.splice(_,0,d):this.requestQueue_.push(d),this.logger.log("request pushed: "+d.name),this.executeQry_()},m.prototype.executeQry_=function(){var d=this,_=this.requestQueue_.length;if(!this.isCodeExecuting_&&_>0){if(this.isConOpened_===!0)return void this.sendRequestToWorker_(this.requestQueue_[0]);var O=this.requestQueue_.findIndex(function(P){return d.whiteListApi_.indexOf(P.name)>=0});O>=0&&(this.requestQueue_.splice(0,0,this.requestQueue_.splice(O,1)[0]),this.sendRequestToWorker_(this.requestQueue_[0]))}else _===0&&this.isDbIdle_===!1&&this.isConOpened_&&(this.inactivityTimer_=setTimeout(function(){d.prcoessExecutionOfQry_({name:l.CloseDb,onSuccess:function(){},onError:function(P){console.error(P)}})},100))},m.prototype.sendRequestToWorker_=function(d){this.isCodeExecuting_=!0,this.logger.log("request executing: "+d.name);var _={name:d.name,query:d.query};this.isWorker===!0?this.worker_.postMessage(_):this.queryManager.run(_)},m}(),X=(q=function(m,d){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,O){_.__proto__=O}||function(_,O){for(var P in O)Object.prototype.hasOwnProperty.call(O,P)&&(_[P]=O[P])},q(m,d)},function(m,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function _(){this.constructor=m}q(m,d),m.prototype=d===null?Object.create(d):(_.prototype=d.prototype,new _)}),le=function(m){function d(_){return m.call(this,_)||this}return X(d,m),d.prototype.initDb=function(_){var O=this;return this.database=_,this.pushApi({name:l.InitDb,query:_}).then(function(P){var z,oe=P.database;return P.isCreated&&(z=P.oldVersion?O.eventBus_.emit(g.Upgrade,oe,P.oldVersion,P.newVersion):O.eventBus_.emit(g.Create,oe)),(z||R()).then(function(W){return O.eventBus_.emit(g.Open,oe)}).then(function(W){return P.isCreated})})},d.prototype.dropDb=function(){return this.pushApi({name:l.DropDb})},d.prototype.select=function(_){return this.pushApi({name:l.Select,query:_})},d.prototype.count=function(_){return this.pushApi({name:l.Count,query:_})},d.prototype.insert=function(_){return this.pushApi({name:l.Insert,query:_})},d.prototype.update=function(_){return this.pushApi({name:l.Update,query:_})},d.prototype.remove=function(_){return this.pushApi({name:l.Remove,query:_})},d.prototype.clear=function(_){return this.pushApi({name:l.Clear,query:_})},Object.defineProperty(d.prototype,"logStatus",{set:function(_){this.logger.status=_,this.pushApi({name:l.ChangeLogStatus,query:_})},enumerable:!1,configurable:!0}),d.prototype.openDb=function(_,O){var P=this;return this.pushApi({name:l.OpenDb,query:{version:O,name:_}}).then(function(z){return P.database=z,z})},d.prototype.getDbList=function(){return console.warn("Api getDbList is recommended to use for debugging only. Do not use in code."),indexedDB.databases()},d.prototype.get=function(_){return this.pushApi({name:l.Get,query:_})},d.prototype.set=function(_,O){return this.pushApi({name:l.Set,query:{key:_,value:O}})},d.prototype.terminate=function(){return this.pushApi({name:l.Terminate})},d.prototype.transaction=function(_){return this.pushApi({name:l.Transaction,query:_})},d.prototype.on=function(_,O){this.eventBus_.on(_,O)},d.prototype.off=function(_,O){this.eventBus_.off(_,O)},d.prototype.union=function(_){return this.pushApi({name:l.Union,query:_})},d.prototype.intersect=function(_){return this.pushApi({name:l.Intersect,query:_})},d.prototype.addPlugin=function(_,O){return _.setup(this,O)},d.prototype.addMiddleware=function(_,O){return O?this.pushApi({name:l.Middleware,query:_}):(this.middlewares.push(_),Promise.resolve())},d.prototype.importScripts=function(){for(var _=[],O=0;O<arguments.length;O++)_[O]=arguments[O];return this.pushApi({name:l.ImportScripts,query:_})},d}(Q),Ce=function(m){return Promise.all(m)},ge=function(m,d){for(var _ in m)d(_,m[_])};Tn.exports=i})();(function(s){s.exports=Tn.exports})(ze);var qt={exports:{}};/*! For license information please see jsstore.worker.commonjs2.min.js.LICENSE.txt */var sn;function br(){return sn||(sn=1,(()=>{var s={d:(n,t)=>{for(var e in t)s.o(t,e)&&!s.o(n,e)&&Object.defineProperty(n,e,{enumerable:!0,get:t[e]})},o:(n,t)=>Object.prototype.hasOwnProperty.call(n,t),r:n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})}},i={};s.r(i),s.d(i,{QueryManager:()=>nn});var a,c,l,g,f,v,T,k,C=function(n){return Promise.resolve(n)},x=function(n){return new Promise(n)},q="not_array",$="no_value_supplied",R="column_not_exist",S="no_index_found",j="null_value",Q="wrong_data_type",X="table_not_exist",le="not_object",Ce="Db_blocked",ge="indexeddb_not_supported",m="null_value_in_where",d="invalid_join_query",_="import_scripts_failed",O="method_not_exist",P="invalid_middleware";(function(n){n.Registered="registerd",n.Failed="failed",n.NotStarted="not_started"})(a||(a={})),function(n){n.String="string",n.Object="object",n.Array="array",n.Number="number",n.Boolean="boolean",n.Null="null",n.DateTime="date_time"}(c||(c={})),function(n){n.InitDb="init_db",n.Get="get",n.Set="set",n.Select="select",n.Insert="insert",n.Update="update",n.Remove="remove",n.OpenDb="open_db",n.Clear="clear",n.DropDb="drop_db",n.Count="count",n.ChangeLogStatus="change_log_status",n.Terminate="terminate",n.Transaction="transaction",n.CloseDb="close_db",n.Union="union",n.Intersect="intersect",n.ImportScripts="import_scripts",n.Middleware="middleware"}(l||(l={})),function(n){n.RequestQueueEmpty="requestQueueEmpty",n.RequestQueueFilled="requestQueueFilled",n.Upgrade="upgrade",n.Create="create",n.Open="open"}(g||(g={})),function(n){n.Where="where",n.Like="like",n.Regex="regex",n.In="in",n.Equal="=",n.Between="-",n.GreaterThan=">",n.LessThan="<",n.GreaterThanEqualTo=">=",n.LessThanEqualTo="<=",n.NotEqualTo="!=",n.Aggregate="aggregate",n.Max="max",n.Min="min",n.Avg="avg",n.Count="count",n.Sum="sum",n.List="list",n.Or="or",n.Skip="skip",n.Limit="limit",n.And="and",n.IgnoreCase="ignoreCase",n.Then="then"}(f||(f={})),function(n){n.ReadOnly="readonly",n.ReadWrite="readwrite"}(v||(v={})),function(n){n.First="f",n.Last="l",n.Any="a"}(T||(T={})),function(n){n.Connected="connected",n.Closed="closed",n.NotStarted="not_started",n.UnableToStart="unable_to_start",n.ClosedByJsStore="closed_by_jsstore"}(k||(k={}));var z,oe=function(){function n(t){this.columns=[],this.autoIncColumnValue={},this.columns=this.setColumn(t.columns),this.name=t.name,this.alter=t.alter||{}}return n.prototype.setColumn=function(t){var e=[],r=function(h){var p=t[h];p.name=h,p.autoIncrement&&(o.autoIncColumnValue[h]=0),p.primaryKey&&(o.primaryKey=h),p.enableSearch=p.enableSearch==null||p.enableSearch;var y=o.columns.indexOf(function(w){return w.name===h});if(y<0)e.push(p);else{var b=o.columns[y];Object.assign(b,p)}},o=this;for(var u in t)r(u);return e},n}(),W=function(){function n(){}return n.autoIncrementKey=function(t,e){return"JsStore_".concat(t,"_").concat(e,"_Value")},n.set=function(t,e,r){r.tx||r.createTransaction([n.tableName]);var o=r.objectStore(n.tableName);return x(function(u,h){var p=o.put({key:t,value:e});p.onsuccess=function(){u()},p.onerror=h})},n.get=function(t,e){e.tx||e.createTransaction([n.tableName]);var r=e.objectStore(n.tableName);return x(function(o,u){var h=r.get(e.keyRange(t));h.onsuccess=function(){var p=h.result;o(p&&p.value)},h.onerror=u})},n.remove=function(t,e){e.tx||e.createTransaction([n.tableName]);var r=e.objectStore(n.tableName);return x(function(o,u){var h=r.delete(e.keyRange(t));h.onsuccess=o,h.onerror=u})},n.tableName="JsStore_Meta",n.dbSchema="JsStore_DbSchema",n}(),U=function(n){this.name=n.name,this.version=n.version||1,n.tables.push({name:W.tableName,columns:{key:{primaryKey:!0},value:{enableSearch:!1}}}),this.tables=n.tables.map(function(t){return new oe(t)})},H=function(n,t){for(var e in n)t(e,n[e])},A=function(){function n(t,e){this.type=t,this.info_=e,this.message=this.getMsg_()}return n.prototype.log=function(t){this.status&&console.log(t)},n.prototype.throw=function(){throw this.get()},n.prototype.logError=function(){console.error(this.get())},n.prototype.get=function(){return{message:this.message,type:this.type}},n.prototype.getMsg_=function(){var t,e,r=this.info_,o=((t={}).not_array=function(){e="Supplied value is not an array"},t.undefined_column=function(){e="Column is undefined in Where"},t.undefined_value=function(){e="Value is undefined in Where"},t.undefined_column_name=function(){e="Column name is undefined '"+r.TableName+"'"},t.undefined_database_name=function(){e="Database name is not supplied"},t.undefined_column_value=function(){e="Column value is undefined"},t.no_value_supplied=function(){e="No value is supplied"},t.invalid_operator=function(){e="Invalid Op Value '"+r.Op+"'"},t.column_not_exist=function(){var p=r.column;e=r.isOrder?"Column '".concat(p,"' in order query does not exist"):"Column '".concat(p,"' does not exist")},t.no_index_found=function(){e="No index found for column '"+r.column+"'. Query can not be executed without index."},t.null_value=function(){e="Null value is not allowed for column '"+r.ColumnName+"'"},t.wrong_data_type=function(){e="Supplied value for column '"+r.column+"' have wrong data type"},t.table_not_exist=function(){e="Table '"+r.tableName+"' does not exist"},t.db_not_exist=function(){e="Database with name ".concat(r.dbName," does not exist")},t.not_object=function(){e="supplied value is not object"},t.invalid_operator=function(){e="Invalid Config '"+r.Config+" '"},t.Db_blocked=function(){e="database is blocked, cant be deleted right now"},t.null_value_in_where=function(){e="Null/undefined is not allowed in where. Column '".concat(r.column,"' has null")},t.method_not_exist=function(){e="method '".concat(r,"' does not exist.")},t.indexeddb_not_supported=function(){e="Browser does not support indexeddb"},t.getInfo=function(){e=r},t.invalid_join_query=function(){o.getInfo()},t.import_scripts_failed=function(){o.getInfo()},t.invalid_middleware=function(){e="No function ".concat(r," is found.")},t),u=this.type,h=o[u];return h?h():(u||(this.type="unknown"),e=this.message),e},n}(),ie=function(){function n(){this.logger=new A(null)}return n.prototype.emptyTx=function(){this.tx&&(this.tx.oncomplete=null,this.tx.onabort=null,this.tx.onerror=null,this.tx=null)},n.prototype.createTransactionIfNotExist=function(t,e){this.tx||this.createTransaction(t,e)},n.prototype.createTransaction=function(t,e){var r=this;return e===void 0&&(e=v.ReadWrite),this.tx=this.con.transaction(t,e),x(function(o,u){r.tx.oncomplete=o,r.tx.onabort=o,r.tx.onerror=u})},n.prototype.keyRange=function(t,e){var r;switch(e){case f.Between:r=IDBKeyRange.bound(t.low,t.high,!1,!1);break;case f.GreaterThan:r=IDBKeyRange.lowerBound(t,!0);break;case f.GreaterThanEqualTo:r=IDBKeyRange.lowerBound(t);break;case f.LessThan:r=IDBKeyRange.upperBound(t,!0);break;case f.LessThanEqualTo:r=IDBKeyRange.upperBound(t);break;default:r=IDBKeyRange.only(t)}return r},n.prototype.objectStore=function(t){return this.tx.objectStore(t)},n.prototype.abortTransaction=function(){this.tx&&this.tx.abort()},n.prototype.close=function(){var t=this;return this.con&&this.con.close(),x(function(e){t.con=null,setTimeout(e,100)})},n.prototype.initDb=function(t){var e,r=this,o=!1,u=t.version;return x(function(h,p){var y=indexedDB.open(t.name,u);y.onsuccess=function(){r.con=y.result,r.con.onversionchange=function(b){b.target.close()},h({isCreated:o,oldVersion:e,newVersion:u})},y.onerror=function(b){console.error("error",b),p(b)},y.onupgradeneeded=function(b){e=b.oldVersion;var w=b.target,E=w.result;o=!0;var D=w.transaction,B=E.objectStoreNames,N=function(ee,F){var G=F.name;if(F.enableSearch&&!ee.indexNames.contains(G)){var ae=F.primaryKey?{unique:!0}:{unique:F.unique};ae.multiEntry=F.multiEntry;var ne=F.keyPath==null?G:F.keyPath;ee.createIndex(G,ne,ae)}},L=function(ee,F,G){var ae=F.columns.findIndex(function(ne){return ne.name===G});ae>=0&&(F.columns.splice(ae,1),ee.deleteIndex(G))};t.tables.forEach(function(ee){if(!B.contains(ee.name))return function(ne){var ve=ne.primaryKey?{keyPath:ne.primaryKey}:{autoIncrement:!0},be=E.createObjectStore(ne.name,ve);ne.columns.forEach(function(rt){N(be,rt)})}(ee);for(var F=D.objectStore(ee.name),G=e+1;G<=u;G++){var ae=ee.alter[G];ae&&(ae.add&&ee.setColumn(ae.add).forEach(function(ne){N(F,ne),ee.columns.push(ne)}),H(ae.drop||{},function(ne){L(F,ee,ne)}),H(ae.modify||{},function(ne,ve){var be=ve.multiEntry||ve.keyPath||ve.unique,rt=ee.columns.find(function(Ct){return Ct.name===ne}),we=Object.assign(rt,ve);we.name=ne,be&&(L(F,ee,ne),N(F,we),ee.columns.push(we))}))}});for(var Z=function(ee,F){var G=B.item(ee);t.tables.findIndex(function(ae){return ae.name===G})<0&&E.deleteObjectStore(G)},ye=0,De=B.length;ye<De;ye++)Z(ye)}})},n}(),de=function(n){return Promise.all(n)},me=function(n){return Promise.reject(n)},ut=function(n){if(n instanceof A)return n.logError(),n.get();var t=void 0;return n.name?(t=new A(n.name)).message=n.message:(t=new A(n.target.error.name)).message=n.target.error.message,t.get()},We=function(){function n(){this.rowAffected=0,this.isTxQuery=!1,this.results=[]}return Object.defineProperty(n.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),n.prototype.table=function(t){var e=t||this.tableName;return this.db.tables.find(function(r){return r.name===e})},n.prototype.primaryKey=function(t){var e=this.query;return!e.from&&e.store&&e.meta?e.meta.primaryKey:this.table(t).primaryKey},n.prototype.getColumnInfo=function(t,e){return this.table(e).columns.find(function(r){return r.name===t})},n.prototype.onException=function(t,e){return console.error(t),this.util.abortTransaction(),me(function(r,o){return o===void 0&&(o="invalid_query"),r.name=o,ut(r)}(t,e))},n}(),ue=function(n){if(n==null)return c.Null;var t=typeof n;if(t==="object"){if(Array.isArray(n))return c.Array;if(n instanceof Date)return c.DateTime}return t},He=function(n){return n==null||typeof n=="number"&&isNaN(n)},qn=function(){function n(t,e){this.table=t,this.autoIncrementValue=e}return n.prototype.checkAndModifyValues=function(t){var e,r=this;this.query=t;var o=t.values,u=[];return o.every(function(h,p){return e=r.checkAndModifyValue(h),t.ignore&&e&&(u.push(p),e=null),!e}),u.forEach(function(h){o.splice(h,1)}),{err:e,values:o}},n.prototype.checkAndModifyValue=function(t){var e,r=this;return this.table.columns.every(function(o){return!(e=r.checkAndModifyColumnValue_(o,t))}),e},n.prototype.checkNotNullAndDataType_=function(t,e){return t.notNull&&He(e[t.name])?this.getError(j,{ColumnName:t.name}):t.dataType&&!He(e[t.name])&&ue(e[t.name])!==t.dataType?this.getError(Q,{column:t.name}):void 0},n.prototype.checkAndModifyColumnValue_=function(t,e){var r=e[t.name];if(t.autoIncrement?He(r)?e[t.name]=++this.autoIncrementValue[t.name]:ue(r)===c.Number&&r>this.autoIncrementValue[t.name]&&(this.autoIncrementValue[t.name]=r):t.default!==void 0&&He(r)&&(e[t.name]=t.default),this.query.validation)return this.checkNotNullAndDataType_(t,e)},n.prototype.getError=function(t,e){return new A(t,e)},n}(),An=function(){function n(t){this.table=t}return n.prototype.check=function(t,e){var r,o=this;return typeof t===c.Object?this.table?this.table.columns.every(function(u){return u.name in t&&(r=o.checkByColumn_(u,t[u.name])),!r}):r=new A(X,{tableName:e}):r=new A(le),r},n.prototype.checkByColumn_=function(t,e){if(t.notNull===!0&&He(e))return new A(j,{ColumnName:t.name});var r=ue(e),o=e!=null;if(t.dataType&&o&&r!==t.dataType&&r!=="object")return new A(Q,{column:t.name});if(o&&r==="object"){var u=["+","-","*","/","{push}"];for(var h in e)if(u.indexOf(h)<0&&t.dataType&&r!==t.dataType)return new A(Q,{column:t.name})}},n}(),Ze=function(){function n(t){this.db=t}return n.prototype.validate=function(t,e){switch(t){case l.Select:case l.Remove:case l.Count:return this.checkSelect(e);case l.Insert:return this.checkInsertQuery(e);case l.Update:return this.checkUpdate(e)}},n.prototype.getTable_=function(t){return this.db.tables.find(function(e){return e.name===t})},n.prototype.isInsertQryValid=function(t){var e,r=this.getTable_(t.into);if(r)switch(ue(t.values)){case c.Array:break;case c.Null:e=new A($);break;default:e=new A(q)}else e=new A(X,{tableName:t.into});return{table:r,log:e}},n.prototype.checkUpdate=function(t){var e=new An(this.getTable_(t.in)).check(t.set,t.in);if(e)return e;if(t.where!=null){if(e=this.checkForNullInWhere_(t))return e;this.addGreatAndLessToNotOp_(t)}},n.prototype.checkSelect=function(t){if(!t.store&&!this.getTable_(t.from))return new A(X,{tableName:t.from});if(t.where){var e=this.checkForNullInWhere_(t);if(e)return e;this.addGreatAndLessToNotOp_(t)}},n.prototype.checkForNullInWhere_=function(t){for(var e in t.where)if(t.where[e]==null)return new A(m,{column:e})},n.prototype.addGreatAndLessToNotOp_=function(t){var e=t.where,r=function(y,b){return b.findIndex(function(w){return y[w][f.NotEqualTo]!=null})>=0},o=function(y,b){var w;return b.forEach(function(E){(w=y[E])[f.NotEqualTo]!=null&&(y[E][f.GreaterThan]=w[f.NotEqualTo],y[f.Or]===void 0?(y[f.Or]={},y[f.Or][E]={}):y[f.Or][E]===void 0&&(y[f.Or][E]={}),y[f.Or][E][f.LessThan]=w[f.NotEqualTo],delete y[E][f.NotEqualTo])}),y};if(ue(e)===c.Object){var u=Object.keys(e);if(r(e,u))if(u.length===1)t.where=o(e,u);else{var h=[];u.forEach(function(y){var b;h.push(o(((b={})[y]=e[y],b),[y]))}),t.where=h}}else{var p=[];e.forEach(function(y){var b=Object.keys(y);r(y,b)&&(y=o(y,b)),p.push(y)}),t.where=p}},n.prototype.checkInsertQuery=function(t){var e=this.isInsertQryValid(t),r=e.table,o=e.log;if(o)return o;if(!t.skipDataCheck){var u=new qn(r,r.autoIncColumnValue).checkAndModifyValues(t),h=u.values,p=u.err;return t.values=h,p}},n}(),jn=(z=function(n,t){return z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])},z(n,t)},function(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=n}z(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}),Mt=function(n){function t(e,r){var o=n.call(this)||this;return o.valuesAffected_=[],e.validation==null&&(e.validation=!0),o.query=e,o.util=r,o.tableName=e.into,o}return jn(t,n),t.prototype.execute=function(e){var r=this,o=this.db,u=new Ze(o).validate(l.Insert,this.query);return u?me(u):e().then(function(h){return r.insertData_(o).then(function(p){return r.query.return?r.valuesAffected_:r.rowAffected})}).catch(function(h){return r.util.abortTransaction(),me(h)})},t.prototype.insertData_=function(e){var r,o,u,h=this,p=this.query;return r=p.return?function(y){h.valuesAffected_.push(y)}:function(y){++h.rowAffected},u=p.upsert?"put":"add",o=p.ignore&&!h.isTxQuery?function(y){return h.util.con.transaction(p.into,v.ReadWrite).objectStore(p.into)[u](y)}:(h.isTxQuery||h.util.createTransaction([p.into,W.tableName]),h.objectStore=h.util.objectStore(h.tableName),function(y){return h.objectStore[u](y)}),de(p.values.map(function(y){return x(function(b,w){var E=o(y);E.onerror=function(D){p.ignore?b():w(D)},E.onsuccess=function(){r(y),b()}})})).then(function(){W.set(W.dbSchema,e,h.util)})},t}(We),Pt=self.alert===void 0&&typeof ServiceWorkerGlobalScope>"u",In=function(){try{if(indexedDB||(indexedDB=self.mozIndexedDB||self.webkitIndexedDB||self.msIndexedDB),!indexedDB)return!1;IDBTransaction=IDBTransaction||self.webkitIDBTransaction||self.msIDBTransaction,self.IDBKeyRange=self.IDBKeyRange||self.webkitIDBKeyRange||self.msIDBKeyRange}catch{return!1}return!0}(),$e=function(n){return Array.isArray(n)},st=function(n){return Object.keys(n)},Ae=function(n){return st(n).length},et=function(n){for(var t in n)return t},Dn=function(){function n(){}return n.prototype.setCaseAndValue=function(t,e){this.caseQuery_=t,this.setValue(e)},n.prototype.setCaseAndColumn=function(t,e){return this.caseQuery_=t,this.setColumn(e),this},n.prototype.setColumn=function(t){return this.columnName_=t,this.caseColumnQuery_=this.caseQuery_[this.columnName_],this.length_=this.caseColumnQuery_.length,this},n.prototype.setValue=function(t){return this.value=t,this},n.prototype.evaluate=function(){for(var t=0;t<this.length_;t++)if(this.checkCase_(this.caseColumnQuery_[t])===!0)return this.caseColumnQuery_[t].then;var e=this.caseColumnQuery_[this.length_-1].then;return e==null?this.value[this.columnName_]:e},n.prototype.checkCase_=function(t){var e;for(e in t){switch(e){case f.GreaterThan:if(this.value[this.columnName_]>t[e])return!0;break;case f.Equal:if(this.value[this.columnName_]===t[e])return!0;break;case f.LessThan:if(this.value[this.columnName_]<t[e])return!0;break;case f.GreaterThanEqualTo:if(this.value[this.columnName_]>=t[e])return!0;break;case f.LessThanEqualTo:if(this.value[this.columnName_]<=t[e])return!0;break;case f.NotEqualTo:if(this.value[this.columnName_]!==t[e])return!0;break;case f.Between:if(this.value[this.columnName_]>t[e].low&&this.value[this.columnName_]<t[e].high)return!0}return!1}},n}(),at=function(n,t,e,r){if(this.limitAtEnd===!1&&this.skipAtEnd===!1){if(this.skipRecord)return this.limitRecord?r:e;if(this.limitRecord)return t}return n},Nn=function(n){var t=this,e=!1;return function(r){var o=r.target.result;o?e&&t.results.length!==t.limitRecord?(t.shouldAddValue(o)&&t.pushResult(o.value),o.continue()):(e=!0,o.advance(t.skipRecord)):n()}},Rn=function(n){var t=this,e=!1;return function(r){var o=r.target.result;o?e?(t.shouldAddValue(o)&&t.pushResult(o.value),o.continue()):(e=!0,o.advance(t.skipRecord)):n()}},gt=function(n){var t=this;return function(e){var r=e.target.result;r&&t.results.length!==t.limitRecord?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):n()}},_t=function(n){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r)&&t.pushResult(r.value),r.continue()):n()}},Qn=function(n){var t,e=this,r=!1;return function(o){(t=o.target.result)?r&&e.results.length!==e.limitRecord?(e.pushResult(t.value),t.continue()):(r=!0,t.advance(e.skipRecord)):n()}},Ln=function(n){var t,e=this,r=!1;return function(o){(t=o.target.result)?r?(e.pushResult(t.value),t.continue()):(r=!0,t.advance(e.skipRecord)):n()}},$n=function(n){var t,e=this;return function(r){(t=r.target.result)?(e.pushResult(t.value),t.continue()):n()}},Mn=function(n){var t,e=this;return function(r){(t=r.target.result)&&e.results.length!==e.limitRecord?(e.pushResult(t.value),t.continue()):n()}},Bt=function(n){return n.replace(/\s/g,"")},Wt=function(n){var t;if(!this.query.store)if(this.query.join==null)t=this.getColumnInfo(n);else{var e=Bt(n).split("."),r=e[1];t=this.getColumnInfo(r,e[0])}if(t==null){var o=this.results[0][n];if(o)return{dataType:ue(o),name:n};throw new A(R,{column:n,isOrder:!0})}return t},Vt=function(n,t){return t.localeCompare(n)},Ft=function(n,t){return n.localeCompare(t)},Pn=function(n,t){return new String(t).localeCompare(n)},Bn=function(n,t){return new String(n).localeCompare(t)},Ut=function(n,t){return t-n},Gt=function(n,t){return n-t},Wn=function(n,t){return t.getTime()-n.getTime()},Vn=function(n,t){return n.getTime()-t.getTime()},Kt=function(n,t){switch(n.dataType){case c.String:return t.type==="asc"?Ft:Vt;case c.Number:return t.type==="asc"?Gt:Ut;case c.DateTime:return t.type==="asc"?Vn:Wn;default:return t.type==="asc"?Bn:Pn}},Jt=function(n){var t;n.type=zt(n.type);var e=n.by,r=this.thenEvaluator;if(e!=null&&typeof e===c.Object){var o=e,u=function(b,w){return function(E,D){for(var B in o){r.setCaseAndValue(o,E);var N=r.setColumn(B).evaluate();r.setCaseAndValue(o,D);var L=r.setColumn(B).evaluate();return typeof E[N]===c.String?b(E[N],D[L]):w(E[N],D[L])}}},h=n.type==="asc"?u(Ft,Gt):u(Vt,Ut);this.results.sort(h)}else{var p=Wt.call(this,e);if(p!=null){var y=Kt(p,n);e=p.name,n.case==null?this.results.sort(function(b,w){return y(b[e],w[e])}):(r.setCaseAndColumn(((t={})[e]=n.case,t),e),this.results.sort(function(b,w){return y(r.setValue(b).evaluate(),r.setValue(w).evaluate())}))}}},zt=function(n){return n==null?"asc":n.toLowerCase()},Yt=function(n){var t,e,r=n.split("%");switch(r[1]?(t=r[1],e=r.length>2?T.Any:T.Last):(t=r[0],e=T.First),e){case T.First:return new RegExp("^".concat(t),"i");case T.Last:return new RegExp("".concat(t,"$"),"i");default:return new RegExp("".concat(t),"i")}},Xt=function(n){return ue(n)==="object"&&!(n instanceof RegExp)},Ht=function(n){if(Xt(n)){var t={};for(var e in n)t[e]=n[e]!=null&&Xt(n[e])?Ht(n[e]):n[e];return t}return n},tt=function(n,t,e){var r=ue(n);if(r!==ue(t))return!1;switch(r===c.DateTime&&(n=n.getTime(),t=t.getTime()),e){case f.GreaterThan:return n>t;case f.LessThan:return n<t;case f.LessThanEqualTo:return n<=t;case f.GreaterThanEqualTo:return n>=t;case f.NotEqualTo:return n!==t;default:return n===t}},bt=function(){function n(t,e){this.where=Ht(t),this.checkFlag=e}return n.prototype.remove=function(t){var e=t.pop();delete t.reduce(function(r,o){return r&&r[o]},this.where)[e]},n.prototype.check=function(t){var e=!0;if(!this.checkFlag)return e;for(var r in this.where){if(!e)return e;var o=this.where[r],u=t[r];if(ue(o)==="object")for(var h in o){if(!e)return e;switch(h){case f.In:e=this.checkIn(r,u);break;case f.Like:e=this.checkLike_(r,u);break;case f.Regex:e=this.checkRegex(r,u);break;case f.Between:case f.GreaterThan:case f.LessThan:case f.GreaterThanEqualTo:case f.LessThanEqualTo:case f.NotEqualTo:e=this.checkComparisionOp_(r,u,h);break;default:e=!1}}else e=tt(o,u)}return e},n.prototype.checkIn=function(t,e){return this.where[t][f.In].find(function(r){return tt(r,e)})!=null},n.prototype.checkLike_=function(t,e){return Yt(this.where[t][f.Like]).test(e)},n.prototype.checkRegex=function(t,e){return this.where[t][f.Regex].test(e)},n.prototype.checkComparisionOp_=function(t,e,r){var o=this.where[t][r];return r!=f.Between?tt(e,o,r):tt(e,o.low,">=")&&tt(e,o.high,"<=")},n}(),Fn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),ct=function(n){function t(){var e=n!==null&&n.apply(this,arguments)||this;return e.limitAtEnd=!1,e.skipAtEnd=!1,e}return Fn(t,n),t.prototype.goToWhereLogic=function(){var e=this,r=this.query,o=r.where,u=function(){for(var w in o)if(e.objectStore.indexNames.contains(w))return w}();if(u==null&&(u=et(o),!r.store))return me(new A(S,{column:u}));var h=o[u];if(ue(h)!=="object")return p=Ae(o)>1,this.whereChecker=new bt(o,p),this.whereChecker.remove([u]),this.executeWhereLogic(u,h,null,"next");var p=Ae(h)>1||Ae(o)>1;this.whereChecker=new bt(o,p);var y=et(h);switch(this.whereChecker.remove([u,y]),y){case f.Like:var b=Yt(h[f.Like]);return this.executeRegexLogic(u,b);case f.Regex:return this.executeRegexLogic(u,h[f.Regex]);case f.In:return this.executeInLogic(u,h[f.In]);case f.Between:case f.GreaterThan:case f.LessThan:case f.GreaterThanEqualTo:case f.LessThanEqualTo:return this.executeWhereLogic(u,h,y,"next");case f.Aggregate:break;default:return this.executeWhereLogic(u,h,null,"next")}},t}(We),Zt=function(n,t){var e=this;return function(r){var o=r.target.result;e.results.length!==e.limitRecord&&o?(e.shouldAddValue(o)&&t(o.value),o.continue()):n()}},en=function(n,t){var e=this;return function(r){var o=r.target.result;o?(e.shouldAddValue(o)&&t(o.value),o.continue()):n()}},Me=function(){return Me=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},Me.apply(this,arguments)},Un=function(){function n(t){this.joinQueryStack_=[],this.currentQueryStackIndex_=0,this.tablesFetched=[],this.results=[],this.select=t}return Object.defineProperty(n.prototype,"query",{get:function(){return this.select.query},enumerable:!1,configurable:!0}),n.prototype.getTable=function(t){return this.select.table(t)},n.prototype.executeSelect=function(t){return new se(t,this.select.util).execute()},n.prototype.execute=function(){var t=this,e=this.query;this.joinQueryStack_=ue(e.join)===c.Object?[e.join]:e.join;var r=e.from,o=[];r&&o.push(r);for(var u=this.joinQueryStack_,h=0,p=u.length;h<p;h++){var y=u[h],b=this.getJoinTableInfo_(y.on);y.with===b.table1.table&&(b={table1:b.table2,table2:b.table1});var w=this.checkJoinQuery_(b,y);if(w)return me(w);u[h].joinTableInfo=b,y.with&&o.push(y.with)}return!this.select.isTxQuery&&o.length>0&&this.select.util.createTransaction(o),this.executeSelect({from:r,where:e.where,case:e.case,flatten:e.flatten,store:e.store,meta:e.meta}).then(function(E){return t.results=E.map(function(D){var B;return(B={})[t.currentQueryStackIndex_]=D,B}),t.tablesFetched.push(u[0].joinTableInfo.table1.table),t.startExecutingJoinLogic_()})},n.prototype.onJoinQueryFinished_=function(){if(this.results.length!==0){var t=this.select;try{var e=[],r=st(this.results[0]).length;this.results.forEach(function(o){for(var u=o[0],h=1;h<r;h++)u=Me(Me({},u),o[h]);e.push(u)}),t.results=e,t.setLimitAndSkipEvaluationAtEnd_(),t.query.flatten=null,t.processOrderBy()}catch(o){return me(new A(d,o.message))}}},n.prototype.startExecutingJoinLogic_=function(){var t=this,e=this.joinQueryStack_[this.currentQueryStackIndex_];if(!e)return this.onJoinQueryFinished_();try{var r=e.joinTableInfo;return this.executeSelect({from:e.with,where:e.where,case:e.case,flatten:e.flatten,store:e.store,meta:e.meta}).then(function(o){return t.jointables(e,r,o),t.tablesFetched.push(r.table2.table),++t.currentQueryStackIndex_,t.startExecutingJoinLogic_()})}catch(o){return me(new A(d,o.message))}},n.prototype.jointables=function(t,e,r){var o,u=this,h=t.type,p=[],y=e.table1.column,b=e.table2.column,w=this.tablesFetched.indexOf(e.table1.table),E=this.currentQueryStackIndex_+1,D=t.as,B=D?function(N){for(var L in D){var Z=D[L];N[Z]===void 0&&(N[Z]=N[L],delete N[L])}return N}:function(N){return N};h==="left"?function(){var N,L,Z=0,ye={};t.store?st(t.store).forEach(function(F){ye[F]=null}):u.getTable(e.table2.table).columns.forEach(function(F){ye[F.name]=null}),L=E===1?function(F,G){G[w][y]===F[b]&&N.push(F)}:function(F,G){var ae=G[w];ae!=null&&ae[y]===F[b]&&N.push(F)};var De=Object.assign(t.where||{},t.whereJoin||{}),ee=new bt(De,Ae(De)>0);u.results.forEach(function(F){N=[],r.forEach(function(G){L(G,F)}),N.length===0&&(N=[ye]),N.forEach(function(G){G=B(G),ee.check(G)&&(p[Z]=Me({},F),p[Z++][E]=G)})})}():(o=0,u.results.forEach(function(N){r.forEach(function(L){N[w][y]===L[b]&&(p[o]=Me({},N),p[o++][E]=B(Me({},L)))})})),this.results=p},n.prototype.getJoinTableInfo_=function(t){var e=(t=Bt(t)).split("="),r=e[0].split("."),o=e[1].split(".");return{table1:{table:r[0],column:r[1]},table2:{table:o[0],column:o[1]}}},n.prototype.checkJoinQuery_=function(t,e){if(e.store)return null;var r,o=t.table1,u=t.table2,h=this.getTable(o.table),p=this.getTable(u.table);e.with!==u.table&&(r=new A(d,"on value should contains value of with")),h.columns.find(function(D){return D.name===o.column})==null?r=new A(d,"column ".concat(o.column," does not exist in table ").concat(o.table)):p.columns.find(function(D){return D.name===u.column})==null&&(r=new A(d,"column ".concat(u.column," does not exist in table ").concat(u.table))),e.as==null&&(e.as={}),h.columns.every(function(D){var B=p.columns.find(function(N){return N.name===D.name&&N.name!==o.column});return B==null||e.as[B.name]!=null||(r=new A(d,"column ".concat(D.name," exist in both table ").concat(o.table," & ").concat(u.table)),!1)});var y=e.where;if(y){var b={},w=function(D){p.columns.find(function(B){return B.name===D})||(b[D]=y[D],delete y[D])};for(var E in y)w(E);e.whereJoin=b,Ae(y)===0&&(e.where=null)}return r},n}(),Gn=function(){function n(t){this.data=t}return Object.defineProperty(n.prototype,"indexNames",{get:function(){var t=st(this.data[0]);return{contains:function(e){return t.indexOf(e)>=0}}},enumerable:!1,configurable:!0}),n.prototype.index=function(t){var e=this;return{openCursor:function(r){var o={},u=0,h={continue:function(){++u,y()}},p=function(b){o.onsuccess({target:{result:b}})},y=function(){var b=e.data[u];if(b){var w=b[t];w&&(r==null||r.includes(w))?(h.key=w,h.value=b,p(h)):h.continue()}else p(null)};return C().then(y),o}}},n}(),Kn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),lt=function(){return lt=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},lt.apply(this,arguments)},ft=function(n,t,e){if(e||arguments.length===2)for(var r,o=0,u=t.length;o<u;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return n.concat(r||Array.prototype.slice.call(t))},se=function(n){function t(e,r){var o=n.call(this)||this;o.sorted=!1,o.isSubQuery=!1,o.thenEvaluator=new Dn,o.returnResult_=function(){if(o.results.length>0){var h=o.query;if(h.flatten){var p=[],y=new Map;h.flatten.forEach(function(w){o.results.forEach(function(E,D){E[w].forEach(function(B){var N;p.push(lt(lt({},E),((N={})[w]=B,N)))}),y.set(D,!0)})});var b=0;y.forEach(function(w,E){o.results.splice(E-b,1),++b}),o.results=o.results.concat(p)}o.processGroupDistinctAggr(),o.processOrderBy(),o.skipAtEnd&&o.results.splice(0,h.skip),o.limitAtEnd&&(o.results=o.results.slice(0,h.limit))}return o.results},o.query=e,o.util=r,o.tableName=e.from,o.setPushResult(),$e(e.where)?(o.isArrayQry=!0,o.setLimitAndSkipEvaluationAtEnd_()):(o.skipRecord=e.skip,o.limitRecord=e.limit);var u=e.order;return u?(($e(u)||u.case||typeof u.by=="object")&&(u.idbSorting=!1),o.setLimitAndSkipEvaluationAtEnd_()):e.groupBy&&o.setLimitAndSkipEvaluationAtEnd_(),o}return Kn(t,n),t.prototype.execute=function(e){var r=this;e||(e=function(){return C(null)});var o=this.query;try{var u=new Ze(this.db).validate(l.Select,o);return u?me(u):e().then(function(h){return r.initTransaction_(),(o.join==null?o.where!=null?$e(o.where)?r.processWhereArrayQry():r.processWhere_():r.executeWhereUndefinedLogic():r.executeJoinQuery()).then(r.returnResult_.bind(r))})}catch(h){return this.onException(h)}},t.prototype.processWhereArrayQry=function(){var e=this;this.isArrayQry=!0;var r,o=this.query.where,u=this.primaryKey(),h=!0,p=[],y=function(){var w;if(r===f.And?h===!0?p=e.results:p.length>0&&(w=[],e.results.forEach(function(E){var D;D=E[u],p.findIndex(function(B){return B[u]===D})>=0&&w.push(E)}),p=w,w=null):(p.length>0&&(e.results=ft(ft([],p,!0),e.results,!0),e.removeDuplicates()),p=e.results),h=!1,o.length>0)return e.results=[],b();e.results=p},b=function(){var w=o.shift();return w[f.Or]&&Ae(w)===1?(r=f.Or,w=w[f.Or]):r=f.And,e.query.where=w,e.processWhere_().then(y)};return b()},t.prototype.initTransaction_=function(){var e=this.query.store;e?this.objectStore=new Gn(e):(this.isTxQuery||this.util.createTransactionIfNotExist([this.tableName],v.ReadOnly),this.objectStore=this.util.objectStore(this.tableName))},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(r){return e.whereChecker.check(r.value)},this.query.where.or&&this.processOrLogic_(),this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQueryFinish_=function(){this.isOr=!1,this.results=this.orInfo.results,this.orInfo=null,this.removeDuplicates()},t.prototype.orQuerySuccess_=function(){var e=this.query;this.results.length>0&&(this.orInfo.results=ft(ft([],this.orInfo.results,!0),this.results,!0)),this.results=[];var r=et(this.orInfo.orQuery);if(r!=null){var o={};return o[r]=this.orInfo.orQuery[r],delete this.orInfo.orQuery[r],e.where=o,this.goToWhereLogic().then(this.onWhereEvaluated.bind(this))}return this.orQueryFinish_()},t.prototype.processOrLogic_=function(){this.isOr=!0;var e=this.query.where;this.orInfo={orQuery:e.or,results:[]},this.setLimitAndSkipEvaluationAtEnd_(),delete e.or},t}(ct);se.prototype.executeInLogic=function(n,t){var e=this,r=this.skipRecord,o=function(h){r===0?e.pushResult(h):--r},u=at.call(this,_t,gt,en,Zt);return de(t.map(function(h){return x(function(p,y){var b=e.objectStore.index(n).openCursor(e.util.keyRange(h));b.onsuccess=u.call(e,p,o),b.onerror=y})}))},se.prototype.executeWhereUndefinedLogic=function(){var n,t=this,e=this.query,r=e.store;if(r)return this.results=r,this.setLimitAndSkipEvaluationAtEnd_(),C();var o=e.order,u=this.objectStore;if(o&&o.idbSorting!==!1&&o.by){if(!u.indexNames.contains(o.by))return me(new A(R,{column:o.by,isOrder:!0}));var h=o.type&&o.type.toLowerCase()==="desc"?"prev":"next";this.sorted=!0,n=u.index(o.by).openCursor(null,h)}else n=u.openCursor();var p=at.call(this,$n,Mn,Ln,Qn);return x(function(y,b){n.onerror=b,n.onsuccess=p.call(t,y)})},se.prototype.executeWhereLogic=function(n,t,e,r){var o=this;t=e?t[e]:t;var u=this.objectStore.index(n).openCursor(this.util.keyRange(t,e),r),h=at.call(this,_t,gt,Rn,Nn);return x(function(p,y){u.onerror=y,u.onsuccess=h.call(o,p)})},se.prototype.executeRegexLogic=function(n,t){var e=this,r=this.skipRecord,o=function(p){r===0?e.pushResult(p):--r};this.shouldAddValue=function(p){return t.test(p.key)&&e.whereChecker.check(p.value)};var u=this.objectStore.index(n).openCursor(),h=at.call(this,_t,gt,en,Zt);return x(function(p,y){u.onerror=y,u.onsuccess=h.call(e,p,o)})},se.prototype.setLimitAndSkipEvaluationAtEnd_=function(){this.query.limit&&(this.limitAtEnd=!0),this.query.skip&&(this.skipAtEnd=!0)},se.prototype.setPushResult=function(){var n=this,t=this.query.case;this.pushResult=t?function(e){var r;for(r in n.thenEvaluator.setCaseAndValue(t,e),t)e[r]=n.thenEvaluator.setColumn(r).evaluate();n.results.push(e)}:function(e){n.results.push(e)}},se.prototype.removeDuplicates=function(){for(var n=this.results,t=this.primaryKey(),e=new Map,r=0,o=n.length;r<o;r++)e.set(n[r][t],n[r]);this.results=Array.from(e.values())},se.prototype.executeJoinQuery=function(){return new Un(this).execute()},se.prototype.processGroupDistinctAggr=function(){var n=this.query;if(n.distinct){var t=[],e=this.results[0];for(var r in e)t.push(r);var o=this.primaryKey(),u=t.indexOf(o);t.splice(u,1),n.groupBy=t.length>0?t:null}n.groupBy?n.aggregate?this.executeAggregateGroupBy():this.processGroupBy():n.aggregate&&this.processAggregateQry()},se.prototype.processOrderBy=function(){var n=this.query.order;if(n&&this.results.length>0&&!this.sorted){var t=ue(n);if(t===c.Object)Jt.call(this,n);else if(t===c.Array){Jt.call(this,n[0]);for(var e=function(h,p){var y=n[h-1].by,b=n[h],w=b.by,E=Wt.call(r,w);if(E!=null){w=E.name,b.type=zt(b.type);var D=Kt(E,b);r.results.sort(function(B,N){return B[y]===N[y]?D(B[w],N[w]):0})}},r=this,o=1,u=n.length;o<u;o++)e(o)}}},se.prototype.processAggregateQry=function(){var n,t=this.results,e=t.length,r={},o=function(){var L=0;for(var Z in t)L+=t[Z][n]?1:0;return L},u=function(){var L=0;for(var Z in t)L=L>t[Z][n]?L:t[Z][n];return L},h=function(){var L=1/0,Z=1/0;for(var ye in t)L=L<(Z=t[ye][n]?t[ye][n]:1/0)?L:Z;return L},p=function(){var L=0;for(var Z in t)L+=t[Z][n];return L},y=function(){return p()/e},b=this.query.aggregate;for(var w in b){var E=b[w],D=ue(E),B=void 0;switch(w){case"count":B=o;break;case"max":B=u;break;case"min":B=h;break;case"sum":B=p;break;case"avg":B=y}switch(D){case c.String:n=E,r["".concat(w,"(").concat(n,")")]=B();break;case c.Array:for(var N in E)n=E[N],r["".concat(w,"(").concat(n,")")]=B()}}for(var w in r)t[0][w]=r[w];this.results=[t[0]]},se.prototype.executeAggregateGroupBy=function(){var n,t,e,r,o=this.query.groupBy,u=this.results,h=new Map,p=this.query.aggregate,y=function(){var De=function(){return e=(e=h.get(t))?e["count("+r+")"]:0,e+=u[n][r]?1:0},ee=function(){return(e=(e=h.get(t))?e["list("+r+")"]:[]).push(u[n][r]),e},F=function(){return e=(e=h.get(t))?e["max("+r+")"]:0,u[n][r]=u[n][r]?u[n][r]:0,e>u[n][r]?e:u[n][r]},G=function(){return e=(e=h.get(t))?e["min("+r+")"]:1/0,u[n][r]=u[n][r]?u[n][r]:1/0,e<u[n][r]?e:u[n][r]},ae=function(){return e=(e=h.get(t))?e["sum("+r+")"]:0,e+=u[n][r]?u[n][r]:0},ne=function(){var rn=(e=h.get(t))?e["sum("+r+")"]:0;rn+=u[n][r]?u[n][r]:0,u[n]["sum("+r+")"]=rn,e=e?e["count("+r+")"]:0,e+=u[n][r]?1:0,u[n]["count("+r+")"]=e};for(var ve in p){var be=p[ve],rt=ue(be),we=void 0;switch(ve){case f.Count:we=De;break;case f.Max:we=F;break;case f.Min:we=G;break;case f.Sum:we=ae;break;case f.Avg:we=ne;break;case f.List:we=ee}switch(rt){case c.String:r=be,u[n]["".concat(ve,"(").concat(r,")")]=we();break;case c.Array:for(var Ct in be)r=be[Ct],u[n]["".concat(ve,"(").concat(r,")")]=we()}}};if(ue(o)===c.String)for(n in u)t=u[n][o],y(),h.set(t,u[n]);else for(n in u){for(var b in t="",o)t+=u[n][o[b]];y(),h.set(t,u[n])}u=Array.from(h.values());var w=p.avg;if(w)if(ue(w)===c.String)for(n in u){var E=u[n]["sum("+w+")"],D=u[n]["count("+w+")"];u[n]["avg("+w+")"]=E/D,p.count!==w&&delete u[n]["count("+w+")"],p.sum!==w&&delete u[n]["sum("+w+")"]}else{var B=ue(p.count)===c.String,N=ue(p.sum)===c.String;for(n in u)for(var b in w){var L=w[b],Z=u[n]["sum("+L+")"],ye=u[n]["count("+L+")"];u[n]["avg("+L+")"]=Z/ye,B&&(p.count!==L||p.count.indexOf(L)===-1)&&delete u[n]["count("+L+")"],N&&(p.sum!==L||p.sum.indexOf(L)===-1)&&delete u[n]["sum("+L+")"]}}this.results=u},se.prototype.processGroupBy=function(){var n=this.query.groupBy,t=this.results,e=new Map,r=ue(n);if(r!==c.Object)if(r===c.String)for(var o in t)e.set(t[o][n],t[o]);else{var u=void 0;for(var o in t){for(var h in u="",n)u+=t[o][n[h]];e.set(u,t[o])}}else if(Object.keys(n).length===1){var p=et(n);for(var o in this.thenEvaluator.setCaseAndColumn(n,p),t)e.set(this.thenEvaluator.setValue(t[o]).evaluate(),t[o])}else for(var o in u=void 0,t){for(var h in u="",this.thenEvaluator.setCaseAndValue(n,t[o]),n)u+=this.thenEvaluator.setColumn(h).evaluate();e.set(u,t[o])}this.results=Array.from(e.values())};var wt=function(n){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r)&&++t.resultCount,r.continue()):n()}},Jn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ve=function(n){function t(e,r){var o=n.call(this)||this;return o.resultCount=0,o.query=e,o.util=r,o.tableName=e.from,o}return Jn(t,n),t.prototype.execute=function(e){var r=this,o=new Ze(this.db),u=this.query,h=o.validate(l.Count,u);return h?me(h):e().then(function(p){var y;try{var b=function(){var w=new se(u,r.util);return w.isTxQuery=r.isTxQuery,w.execute().then(function(E){r.resultCount=E.length})};r.initTransaction_(),u.join==null?u.where!=null?u.where.or||$e(u.where)?y=b():(r.shouldAddValue=function(w){return r.whereChecker.check(w.value)},y=r.goToWhereLogic()):y=r.executeWhereUndefinedLogic():y=b()}catch(w){r.onException(w)}return y.then(function(w){return r.resultCount})})},t.prototype.initTransaction_=function(){var e=this.query.from;this.isTxQuery||this.util.createTransaction([e],v.ReadOnly),this.objectStore=this.util.objectStore(e)},t}(ct);Ve.prototype.executeWhereUndefinedLogic=function(){var n,t,e=this,r=this.objectStore,o=r.count?(n=r.count(),function(u){return function(){e.resultCount=n.result,u()}}):(n=r.openCursor(),function(u){return function(h){(t=h.target.result)?(++e.resultCount,t.continue()):u()}});return x(function(u,h){n.onerror=h,n.onsuccess=o(u)})},Ve.prototype.executeWhereLogic=function(n,t,e){var r,o=this;t=e?t[e]:t;var u=Ae(this.query.where)===1,h=this.objectStore;return x(function(p,y){u&&h.count?(r=h.index(n).count(o.util.keyRange(t,e))).onsuccess=function(){o.resultCount=r.result,p()}:(r=h.index(n).openCursor(o.util.keyRange(t,e))).onsuccess=wt.call(o,p),r.onerror=y})},Ve.prototype.executeRegexLogic=function(n,t){var e=this,r=this.objectStore.index(n).openCursor();return this.shouldAddValue=function(o){return t.test(o.key)&&e.whereChecker.check(o.value)},x(function(o,u){r.onerror=u,r.onsuccess=wt.call(e,o)})},Ve.prototype.executeInLogic=function(n,t){var e=this,r=this.objectStore,o=r.index(n),u=Ae(this.query.where)===1;return de(t.map(function(h){return p=h,y=e.util.keyRange(p),u&&r.count?x(function(b,w){var E=o.count(y);E.onsuccess=function(D){e.resultCount+=D.target.result,b()},E.onerror=w}):x(function(b,w){var E=o.openCursor(y);E.onsuccess=wt.call(e,b),E.onerror=w});var p,y}))};var nt=function(n){return($e(n)?n:n.split(".")).reduce(function(t,e){return t&&t[e]},self)},ht=function(n,t){var e=n.set,r=n.mapSet;if(r){var o=r(e,t);o!=null&&(e=o)}for(var u in e){var h=e[u];if(ue(h)!==c.Object)t[u]=h;else for(var p in h){var y=h[p];switch(p){case"+":t[u]+=y;break;case"-":t[u]-=y;break;case"*":t[u]*=y;break;case"/":t[u]/=y;break;case"{push}":t[u].push(y);break;default:t[u]=h}break}}return t},zn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Fe=function(n){function t(e,r){var o=n.call(this)||this;o.query=e,o.util=r,o.tableName=e.in;var u=e.mapSet;if(u){var h=ue(u)===c.String?nt(u):u;if(!h)throw new A(O,u);e.mapSet=h}return o}return zn(t,n),t.prototype.execute=function(e){var r=this,o=this.query;try{var u=new Ze(this.db).validate(l.Update,o);return u?me(u):e().then(function(h){return r.initTransaction(),(o.where!=null?o.where.or||$e(o.where)?r.executeComplexLogic_():r.goToWhereLogic():r.executeWhereUndefinedLogic()).then(function(){return r.rowAffected})})}catch(h){return this.onException(h)}},t.prototype.executeComplexLogic_=function(){var e=this,r=this.query,o=new se({from:r.in,where:r.where,ignoreCase:r.ignoreCase},this.util);return o.isTxQuery=this.isTxQuery,o.execute().then(function(u){var h,p,y=e.primaryKey(r.in),b=[];u.forEach(function(E){b.push(E[y])}),u=null;var w=((h={})[y]=((p={})[f.In]=b,p),h);return e.query.where=w,e.initTransaction(),e.goToWhereLogic()})},t.prototype.initTransaction=function(){var e=this.query.in;this.isTxQuery||this.util.createTransaction([e]),this.objectStore=this.util.objectStore(e)},t}(ct);Fe.prototype.executeWhereUndefinedLogic=function(){var n=this,t=this.objectStore.openCursor();return x(function(e,r){t.onsuccess=function(o){var u=o.target.result;if(u)try{var h=u.update(ht(n.query,u.value));h.onsuccess=function(){++n.rowAffected,u.continue()},h.onerror=r}catch(p){r(p)}else e()},t.onerror=r})},Fe.prototype.executeWhereLogic=function(n,t,e){var r=this,o=this.query;t=e?t[e]:t;var u=this.objectStore.index(n).openCursor(this.util.keyRange(t,e));return x(function(h,p){u.onsuccess=function(y){var b=y.target.result;if(b)if(r.whereChecker.check(b.value))try{var w=b.update(ht(o,b.value));w.onsuccess=function(){++r.rowAffected,b.continue()},w.onerror=p}catch(E){p(E)}else b.continue();else h()},u.onerror=p})},Fe.prototype.executeRegexLogic=function(n,t){var e,r=this,o=this.objectStore.index(n).openCursor();return this.shouldAddValue=function(u){return t.test(u.key)&&r.whereChecker.check(u.value)},x(function(u,h){o.onsuccess=function(p){if(e=p.target.result)if(r.shouldAddValue(e))try{var y=e.update(ht(r.query,e.value));y.onsuccess=function(){++r.rowAffected,e.continue()},y.onerror=h}catch(b){h(b)}else e.continue();else u()},o.onerror=h})},Fe.prototype.executeInLogic=function(n,t){var e=this,r=this.objectStore.index(n),o=this.query;return de(t.map(function(u){return h=u,x(function(p,y){var b=r.openCursor(e.util.keyRange(h));b.onsuccess=function(w){var E=w.target.result;if(E){var D=E.value;if(e.whereChecker.check(D))try{var B=E.update(ht(o,D));B.onsuccess=function(){++e.rowAffected,E.continue()},B.onerror=y}catch(N){y(N)}else E.continue()}else p()},b.onerror=y});var h}))};var Yn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),kt=function(){return kt=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},kt.apply(this,arguments)},Xn=function(n){function t(e,r){var o=n.call(this)||this;return o.query=e,o.util=r,o}return Yn(t,n),t.prototype.execute=function(){var e,r,o=this,u=this.query,h=0,p={},y={},b=!0,w=u.queries,E=w.length;if(w.every(function(N,L){return!(L+1<E&&N.from!==w[L+1].from&&(b=!1,1))}),b){var D=this.primaryKey(w[0].from);e=function(N){return N[D]}}else e=function(N){var L="";for(var Z in N)L+=N[Z];return L};var B=function(){if(h<E)return(r=new se(w[h],o.util)).execute().then(function(ne){return p={},ne.forEach(function(ve){var be=e(ve);h===0?y[be]=ve:y[be]!=null&&(p[be]=ve)}),h>0&&(y=kt({},p)),++h,B()});var N,L=[],Z=void 0,ye=u.skip,De=u.limit,ee=!1,F=function(){L.push(p[N])},G=function(){L.length<De?F():ee=!0},ae=function(ne){ye===0?ne():--ye};if(Z=u.skip&&u.limit?function(){ae(function(){G()})}:u.limit?G:u.skip?function(){ae(function(){F()})}:function(){F()},De){for(N in p)if(Z(N),ee)break}else for(N in p)Z(N);return r.results=L,Object.assign(r.query,{order:u.order,join:{}}),r.processOrderBy(),r.processGroupDistinctAggr(),r.results};return B()},t}(We),Hn=function(){function n(){}return n.prototype.execute=function(t){return x(function(e,r){var o=indexedDB.deleteDatabase(t);o.onblocked=function(){var u=new A(Ce);return r(ut(u))},o.onerror=function(u){return r(ut(u))},o.onsuccess=function(){e()}})},n}(),Zn=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),er=function(n){function t(e,r){var o=n.call(this)||this;return o.query=e,o.util=r,o}return Zn(t,n),t.prototype.execute=function(){var e,r=this,o=this.query,u=0,h=new Map,p=!0,y=o.length;if(o.every(function(E,D){return!(D+1<y&&E.from!==o[D+1].from&&(p=!1,1))}),p){var b=this.primaryKey(o[0].from);e=function(E){return E[b]}}else e=function(E){var D="";for(var B in E)D+=E[B];return D};var w=function(){return u<o.length?new se(o[u++],r.util).execute().then(function(E){return E.forEach(function(D){h.set(e(D),D)}),w()}):Array.from(h.values())};return w()},t}(We),tn=function(n){var t=this;return function(e){var r=e.target.result;r?(t.shouldAddValue(r.value)&&(r.delete(),++t.rowAffected),r.continue()):n()}},tr=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ue=function(n){function t(e,r){var o=n.call(this)||this;return o.query=e,o.util=r,o.tableName=e.from,o}return tr(t,n),t.prototype.execute=function(e){var r,o=this,u=new Ze(this.db),h=this.query,p=u.validate(l.Remove,h);return p?me(p):e().then(function(y){try{o.initTransaction_(),r=h.where!=null?$e(h.where)?o.processWhereArrayQry():o.processWhere_():o.executeWhereUndefinedLogic()}catch(b){return o.onException(b)}return r.then(function(){return o.rowAffected})})},t.prototype.processWhereArrayQry=function(){var e=this,r=new se(this.query,this.util);return r.isTxQuery=this.isTxQuery,r.execute().then(function(o){var u,h,p=[],y=e.primaryKey(e.query.from);o.forEach(function(w){p.push(w[y])}),o=null;var b=((u={})[y]=((h={})[f.In]=p,h),u);return e.query[f.Where]=b,e.processWhere_()})},t.prototype.processWhere_=function(){var e=this;return this.shouldAddValue=function(r){return e.whereChecker.check(r)},this.query.where.or&&this.processOrLogic(),this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})},t.prototype.initTransaction_=function(){this.isTxQuery||this.util.createTransaction([this.query.from]),this.objectStore=this.util.objectStore(this.query.from)},t.prototype.onWhereEvaluated=function(){if(this.isOr)return this.orQuerySuccess_()},t.prototype.orQuerySuccess_=function(){var e=this,r=this._orInfo.OrQuery,o=et(r);if(o!=null){var u={};return u[o]=r[o],delete r[o],this.query.where=u,this.goToWhereLogic().then(function(){return e.onWhereEvaluated()})}this.isOr=!0},t.prototype.processOrLogic=function(){this.isOr=!0;var e=this.query.where;this._orInfo={OrQuery:e.or},delete e.or},t}(ct);Ue.prototype.executeInLogic=function(n,t){var e=this,r=this.objectStore.index(n);return de(t.map(function(o){return u=o,x(function(h,p){var y=r.openCursor(e.util.keyRange(u));y.onsuccess=tn.call(e,h),y.onerror=p});var u}))},Ue.prototype.executeWhereUndefinedLogic=function(){var n,t=this,e=this.objectStore.openCursor();return x(function(r,o){e.onsuccess=function(u){(n=u.target.result)?(n.delete(),++t.rowAffected,n.continue()):r()},e.onerror=o})},Ue.prototype.executeWhereLogic=function(n,t,e){var r=this;t=e?t[e]:t;var o=this.objectStore.index(n).openCursor(this.util.keyRange(t,e));return x(function(u,h){o.onsuccess=tn.call(r,u),o.onerror=h})},Ue.prototype.executeRegexLogic=function(n,t){var e,r=this,o=this.objectStore.index(n).openCursor();return this.shouldAddValue=function(u){return t.test(u.key)&&r.whereChecker.check(u.value)},x(function(u,h){o.onsuccess=function(p){(e=p.target.result)?(r.shouldAddValue(e)&&(e.delete(),++r.rowAffected),e.continue()):u()},o.onerror=h})};var nr=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),rr=function(n){function t(e,r){var o=n.call(this)||this;return o.query=e,o.util=r,o.tableName=e,o}return nr(t,n),t.prototype.execute=function(e){var r=this,o=this.query;return this.isTxQuery||this.util.createTransaction([o,W.tableName]),e().then(function(u){var h=r.util.objectStore(o).clear();try{return x(function(p,y){h.onsuccess=function(b){var w=r.table(o);for(var E in w.autoIncColumnValue)w.autoIncColumnValue[E]=0;W.set(W.dbSchema,r.util.db,r.util).then(p).catch(y)},h.onerror=y})}catch(p){return r.onException(p)}})},t}(We),or=function(){var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])},n(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),ir=function(n){function t(e,r){var o=n.call(this)||this;return o.results={},o.reqQueue=[],o.isQueryExecuting=!1,o.isTxStarted_=!1,o.query=e,o.util=r,o}return or(t,n),t.prototype.execute=function(e){var r=this;this.beforeExecute=e;var o=this.validate();return o?me(o):(this.startExecution_(),x(function(u,h){r.onSuccess=u,r.onError=h}).then(function(u){return r.beforeExecute=null,r.log("transaction finished"),u}))},t.prototype.validate=function(){var e=this.query,r=this.notExistingTable_(e.tables);if(r)return new A(X,{tableName:r});var o=e.method;return nt(o)?void 0:new A(O,o)},t.prototype.startExecution_=function(){var e=this,r=this.query,o=function(p){return function(y){return e.pushReq_({name:p,query:y})}},u=r.method,h=nt(u);return this.log("transaction query started"),h.call(this,{data:r.data,insert:o(l.Insert),select:o(l.Select),update:o(l.Update),remove:o(l.Remove),count:o(l.Count),setResult:function(p,y){e.results[p]=y},getResult:function(p){return e.results[p]},abort:function(p){e.abortTx_(p)},start:function(){e.startTx_()}})},t.prototype.log=function(e){this.util.logger.log(e)},t.prototype.startTx_=function(){var e=this;try{this.isTxStarted_=!0;var r=this.query.tables;return r=r.concat(W.tableName),this.util.createTransaction(r).then(function(o){e.onSuccess(e.results)}).catch(function(o){e.onError(o)}),this.processExecutionOfQry_()}catch(o){this.onError(this.onException(o))}},t.prototype.onReqFinished_=function(e){var r=this.reqQueue.shift();this.log("finished request : ".concat(r.name," ")),r&&(e.error?(this.abortTx_("automatic abort of transaction due to error occured"),this.log("transaction aborted due to error occured"),this.onError(e.error)):(this.isQueryExecuting=!1,r.onSuccess&&r.onSuccess(e),this.processExecutionOfQry_()))},t.prototype.abortTx_=function(e){this.reqQueue=[],this.util.abortTransaction(),this.log("transaction aborted. Msg : ".concat(e))},t.prototype.executeRequest_=function(e){var r,o=this;this.isQueryExecuting=!0,this.log("executing request : ".concat(e.name," "));var u=this.onReqFinished_.bind(this),h=e.query,p=function(y){r=new y(h,o.util)};switch(e.name){case l.Select:p(se);break;case l.Insert:p(Mt);break;case l.Update:p(Fe);break;case l.Remove:p(Ue);break;case l.Count:p(Ve)}r.isTxQuery=!0,r.execute(this.beforeExecute).then(u).catch(function(y){u({error:y})})},t.prototype.pushReq_=function(e){var r=x(function(o,u){e.onSuccess=function(h){o(h)},e.onError=function(h){u(h)}});return this.reqQueue.push(e),this.isTxStarted_===!0&&this.processExecutionOfQry_(),this.log("request pushed : ".concat(e.name)),r},t.prototype.processExecutionOfQry_=function(){this.isQueryExecuting===!1&&this.reqQueue.length>0&&this.executeRequest_(this.reqQueue[0])},t.prototype.notExistingTable_=function(e){var r=this,o=null;return e.every(function(u){return r.table(u)!=null||(o=u,!1)}),o},t}(We),xt=function(n){var t={name:n.name,version:n.version,tables:[]};return n.tables.forEach(function(e){var r={name:e.name,columns:{}};e.columns.forEach(function(o){r.columns[o.name]=o}),t.tables.push(r)}),t},nn=function(){function n(t){this.middlewares=[],this.util=new ie,this.onQryFinished=Pt?function(e){self.postMessage(e)}:t}return Object.defineProperty(n.prototype,"db",{get:function(){return this.util.db},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"logger",{get:function(){return this.util.logger},enumerable:!1,configurable:!0}),n.prototype.executeMiddleware_=function(t){var e=this,r=Ae(this.middlewares)-1;if(r<0)return C();var o={},u=this.db;return Object.defineProperty(o,"database",{get:function(){return xt(u)}}),x(function(h){var p=0,y=function(){if(p<=r){var b=nt(e.middlewares[p++])(t,o);b&&b.then||(b=Promise.resolve(b)),b.then(function(w){y()})}else h()};y()})},n.prototype.executeQuery=function(t,e){var r,o=t.query,u=this,h=u.util,p=function(y,b){r=new y(o,h).execute(b)};switch(t.name){case l.OpenDb:e(),r=u.openDb(o);break;case l.InitDb:e(),r=u.initDb(o);break;case l.CloseDb:e(),r=u.closeDb();break;case l.Insert:p(Mt,e);break;case l.Select:p(se,e);break;case l.Count:p(Ve,e);break;case l.Update:p(Fe,e);break;case l.Intersect:e(),p(Xn);break;case l.DropDb:e(),r=u.dropDb();break;case l.Terminate:e(),r=u.terminate();break;case l.Union:e(),p(er);break;case l.Remove:p(Ue,e);break;case l.Clear:p(rr,e);break;case l.Transaction:p(ir,e);break;case l.Get:e(),r=W.get(o,h);break;case l.Set:e(),r=W.set(o.key,o.value,h);break;case l.ImportScripts:e(),r=u.importScripts_(t);break;case l.ChangeLogStatus:e(),u.logger.status=o,r=Promise.resolve();break;case l.Middleware:return e(),nt(o)?(u.middlewares.push(o),C()):me(new A(P,o));default:r=C()}return u.logger.log("Executing query ".concat(t.name," in web worker")),r},n.prototype.callMiddleware_=function(t,e){return x(function(r){var o=0,u=Ae(t)-1,h=function(){if(o<=u){var p=t[o++](e);p instanceof Promise||(p=C(p)),p.then(function(y){e=y,h()})}else r(e)};h()})},n.prototype.run=function(t){var e=this,r=[],o=[];t.onResult=function(u){r.push(function(h){return u(h)})},t.beforeExecute=function(u){o.push(function(h){return u(h)})},this.executeMiddleware_(t).then(function(u){return e.executeQuery(t,function(){return e.callMiddleware_(o)}).then(function(h){return e.callMiddleware_(r,h).then(function(p){e.returnResult_({result:p})})})}).catch(function(u){r=[];var h={error:ut(u)};e.returnResult_(h)})},n.prototype.importScripts_=function(t){return x(function(e,r){try{importScripts.apply(void 0,t.query),e()}catch(o){r(new A(_,o.message))}})},n.prototype.returnResult_=function(t){this.logger.log("Query finished inside web worker"),this.util&&this.util.emptyTx(),this.onQryFinished(t)},n.prototype.dropDb=function(){var t=this.db.name;return this.terminate().then(function(){return new Hn().execute(t)})},n.prototype.closeDb=function(){return this.util.close()},n.prototype.terminate=function(){var t=this;return this.closeDb().then(function(){t.util.db=null})},n.prototype.openDb=function(t){var e=this;return this.closeDb().then(function(r){return(e.db&&t.name===e.db.name?e.initDb():e.initDb({name:t.name,tables:[],version:t.version})).then(function(){return e.db})})},n.prototype.initDb=function(t){var e=this;if(!In)return me(new A(ge));var r=t?new U(t):this.db;return this.util=new ie,x(function(o,u){e.util.initDb(r).then(function(h){h.isCreated?W.get(W.dbSchema,e.util).then(function(p){p&&p.tables.forEach(function(y,b){var w=r.tables.find(function(B){return B.name===y.name});if(w)for(var E in y.autoIncColumnValue){var D=y.autoIncColumnValue[E];D&&(w.autoIncColumnValue[E]=D)}}),e.util.db=r,h.database=xt(e.db),W.set(W.dbSchema,r,e.util).then(function(){o(h)})}):W.get(W.dbSchema,e.util).then(function(p){e.util.db=p,h.database=xt(e.db),o(h)})}).catch(u)})},n}();if(Pt){var ur=new nn;self.onmessage=function(n){ur.run(n.data)}}qt.exports=i})()),qt.exports}var wr={setup(s,i){s.$worker=br(),s.initQueryManager_()}};const kr=wr,Ne=vt("move"),Dt=vt({width:30,color:"#000",drag:!1}),ke=new ze.exports.Connection;ke.addPlugin(kr);const Xe=vt(),Le=vt();let En;Le.subscribe(s=>En=s);async function Sn(){let s=await ke.select({from:"Files"});s.length==0?(await $t(),s=await ke.select({from:"Files"})):Xe.set(s);let i=localStorage.getItem("ccv");if(i==null)Le.set(s[0]);else{let a=await ke.select({from:"Files",where:{id:parseInt(i)}});a.length==0?Le.set(s[0]):Le.set(a[0])}return s}async function On(){await ke.initDb({name:"Canvas",tables:[{name:"Files",columns:{id:{autoIncrement:!0,primaryKey:!0},name:{dataType:ze.exports.DATA_TYPE.String,notNull:!0},blocks:{dataType:ze.exports.DATA_TYPE.Object,notNull:!0},createdData:{dataType:ze.exports.DATA_TYPE.DateTime,notNull:!0},lastUpdate:{dataType:ze.exports.DATA_TYPE.DateTime,notNull:!0}}}]})&&$t(),await Sn()}On();async function an(s,i){await ke.update({in:"Files",set:{blocks:i},where:{id:s}}),Xe.set(await ke.select({from:"Files"}))}async function $t(s="New Canvas"){await ke.insert({into:"Files",values:[{name:s,blocks:{},createdData:new Date,lastUpdate:new Date}]}),Xe.set(await ke.select({from:"Files"}))}async function xr(s){if(await ke.remove({from:"Files",where:{id:s}}),En.id==s){let i=await Sn();Le.set(i[0])}Xe.set(await ke.select({from:"Files"}))}async function Cr(){await ke.dropDb(),On()}function Tr(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),I(a,"d","M18 11h-5V6h3l-4-4-4 4h3v5H6V8l-4 4 4 4v-3h5v5H8l4 4 4-4h-3v-5h5v3l4-4-4-4z"),I(i,"viewBox","0 0 24 24")},m(c,l){Y(c,i,l),M(i,a)},p:K,i:K,o:K,d(c){c&&J(i)}}}class Er extends qe{constructor(i){super(),Oe(this,i,null,Tr,xe,{})}}function Sr(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),I(a,"d","M8.707 19.707 18 10.414 13.586 6l-9.293 9.293a1.003 1.003 0 0 0-.263.464L3 21l5.242-1.03c.176-.044.337-.135.465-.263zM21 7.414a2 2 0 0 0 0-2.828L19.414 3a2 2 0 0 0-2.828 0L15 4.586 19.414 9 21 7.414z"),I(i,"viewBox","0 0 24 24")},m(c,l){Y(c,i,l),M(i,a)},p:K,i:K,o:K,d(c){c&&J(i)}}}class Or extends qe{constructor(i){super(),Oe(this,i,null,Sr,xe,{})}}function qr(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),I(a,"d","M12.48 3 7.73 7.75 3 12.59a2 2 0 0 0 0 2.82l4.3 4.3A1 1 0 0 0 8 20h12v-2h-7l7.22-7.22a2 2 0 0 0 0-2.83L15.31 3a2 2 0 0 0-2.83 0zM8.41 18l-4-4 4.75-4.84.74-.75 4.95 4.95-4.56 4.56-.07.08z"),I(i,"viewBox","0 0 24 24")},m(c,l){Y(c,i,l),M(i,a)},p:K,i:K,o:K,d(c){c&&J(i)}}}class Ar extends qe{constructor(i){super(),Oe(this,i,null,qr,xe,{})}}function jr(s){let i,a,c,l,g,f,v,T,k,C,x,q;return c=new Er({}),f=new Or({}),k=new Ar({}),{c(){i=V("nav"),a=V("button"),je(c.$$.fragment),l=ce(),g=V("button"),je(f.$$.fragment),v=ce(),T=V("button"),je(k.$$.fragment),I(a,"class","svelte-1t2igyd"),_e(a,"selected",s[0]=="move"),I(g,"class","svelte-1t2igyd"),_e(g,"selected",s[0]=="pen"),I(T,"class","svelte-1t2igyd"),_e(T,"selected",s[0]=="eraser"),I(i,"class","svelte-1t2igyd")},m($,R){Y($,i,R),M(i,a),Te(c,a,null),M(i,l),M(i,g),Te(f,g,null),M(i,v),M(i,T),Te(k,T,null),C=!0,x||(q=[re(a,"click",s[1]),re(g,"click",s[2]),re(T,"click",s[3])],x=!0)},p($,[R]){(!C||R&1)&&_e(a,"selected",$[0]=="move"),(!C||R&1)&&_e(g,"selected",$[0]=="pen"),(!C||R&1)&&_e(T,"selected",$[0]=="eraser")},i($){C||(fe(c.$$.fragment,$),fe(f.$$.fragment,$),fe(k.$$.fragment,$),C=!0)},o($){pe(c.$$.fragment,$),pe(f.$$.fragment,$),pe(k.$$.fragment,$),C=!1},d($){$&&J(i),Ee(c),Ee(f),Ee(k),x=!1,Se(q)}}}function Ir(s,i,a){let c;return Ne.subscribe(v=>a(0,c=v)),[c,()=>Ne.set("move"),()=>Ne.set("pen"),()=>Ne.set("eraser")]}class Dr extends qe{constructor(i){super(),Oe(this,i,Ir,jr,xe,{})}}function Nr(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),I(a,"d","M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"),I(i,"viewBox","0 0 24 24")},m(c,l){Y(c,i,l),M(i,a)},p:K,i:K,o:K,d(c){c&&J(i)}}}class Rr extends qe{constructor(i){super(),Oe(this,i,null,Nr,xe,{})}}function Qr(s){let i,a;return{c(){i=Ie("svg"),a=Ie("path"),I(a,"d","m16.192 6.344-4.243 4.242-4.242-4.242-1.414 1.414L10.535 12l-4.242 4.242 1.414 1.414 4.242-4.242 4.243 4.242 1.414-1.414L13.364 12l4.242-4.242z"),I(i,"viewBox","0 0 24 24")},m(c,l){Y(c,i,l),M(i,a)},p:K,i:K,o:K,d(c){c&&J(i)}}}class Lr extends qe{constructor(i){super(),Oe(this,i,null,Qr,xe,{})}}function $r(s){const i=a=>{s.contains(a.target)||s.dispatchEvent(new CustomEvent("outclick"))};return document.addEventListener("click",i,!0),{destroy(){document.removeEventListener("click",i,!0)}}}function cn(s,i,a){const c=s.slice();return c[12]=i[a],c}function Mr(s){let i,a,c,l,g,f,v,T,k,C,x,q,$,R,S,j,Q,X,le,Ce;l=new Lr({});let ge=s[1],m=[];for(let d=0;d<ge.length;d+=1)m[d]=ln(cn(s,ge,d));return{c(){i=V("div"),a=V("span"),c=V("button"),je(l.$$.fragment),g=ce(),f=V("h3"),f.textContent="Settings",v=ce(),T=V("h4"),T.textContent="Files",k=ce(),C=V("span");for(let d=0;d<m.length;d+=1)m[d].c();x=ce(),q=V("span"),$=V("button"),$.textContent="Save",R=ce(),S=V("button"),S.textContent="New",j=ce(),Q=V("button"),Q.textContent="Delete All",I(c,"class","close svelte-1nbyll3"),I(f,"class","title svelte-1nbyll3"),I(a,"class","svelte-1nbyll3"),I(T,"class","title svelte-1nbyll3"),I(C,"class","files svelte-1nbyll3"),I($,"class","save svelte-1nbyll3"),I(S,"class","new svelte-1nbyll3"),I(q,"class","optbtn svelte-1nbyll3"),I(Q,"class","rsa svelte-1nbyll3"),I(i,"class","view svelte-1nbyll3")},m(d,_){Y(d,i,_),M(i,a),M(a,c),Te(l,c,null),M(a,g),M(a,f),M(i,v),M(i,T),M(i,k),M(i,C);for(let O=0;O<m.length;O+=1)m[O].m(C,null);M(i,x),M(i,q),M(q,$),M(q,R),M(q,S),M(i,j),M(i,Q),X=!0,le||(Ce=[re(c,"click",s[5]),re($,"click",s[8]),re(S,"click",s[9]),re(Q,"click",s[10])],le=!0)},p(d,_){if(_&6){ge=d[1];let O;for(O=0;O<ge.length;O+=1){const P=cn(d,ge,O);m[O]?m[O].p(P,_):(m[O]=ln(P),m[O].c(),m[O].m(C,null))}for(;O<m.length;O+=1)m[O].d(1);m.length=ge.length}},i(d){X||(fe(l.$$.fragment,d),X=!0)},o(d){pe(l.$$.fragment,d),X=!1},d(d){d&&J(i),Ee(l),Rt(m,d),le=!1,Se(Ce)}}}function Pr(s){let i,a,c,l,g;return a=new Rr({}),{c(){i=V("button"),je(a.$$.fragment),I(i,"class","open svelte-1nbyll3")},m(f,v){Y(f,i,v),Te(a,i,null),c=!0,l||(g=re(i,"click",s[4]),l=!0)},p:K,i(f){c||(fe(a.$$.fragment,f),c=!0)},o(f){pe(a.$$.fragment,f),c=!1},d(f){f&&J(i),Ee(a),l=!1,g()}}}function ln(s){let i,a=s[12].name+"",c,l,g=`${s[12].createdData.getDate()}.${s[12].createdData.getMonth()}.${s[12].createdData.getFullYear()}`,f,v,T,k,C,x;function q(){return s[6](s[12])}function $(){return s[7](s[12])}return{c(){i=V("button"),c=Re(a),l=Re(" / "),f=Re(g),v=ce(),T=V("button"),T.textContent="X",k=ce(),I(T,"class","del svelte-1nbyll3"),I(i,"class","svelte-1nbyll3"),_e(i,"sel",s[2].id==s[12].id)},m(R,S){Y(R,i,S),M(i,c),M(i,l),M(i,f),M(i,v),M(i,T),M(i,k),C||(x=[re(T,"click",q),re(i,"dblclick",$)],C=!0)},p(R,S){s=R,S&2&&a!==(a=s[12].name+"")&&un(c,a),S&2&&g!==(g=`${s[12].createdData.getDate()}.${s[12].createdData.getMonth()}.${s[12].createdData.getFullYear()}`)&&un(f,g),S&6&&_e(i,"sel",s[2].id==s[12].id)},d(R){R&&J(i),C=!1,Se(x)}}}function Br(s){let i,a,c,l,g,f;const v=[Pr,Mr],T=[];function k(C,x){return C[0]?1:0}return a=k(s),c=T[a]=v[a](s),{c(){i=V("div"),c.c(),I(i,"class","settingBuble svelte-1nbyll3")},m(C,x){Y(C,i,x),T[a].m(i,null),l=!0,g||(f=[fr($r.call(null,i)),re(i,"outclick",s[11])],g=!0)},p(C,[x]){let q=a;a=k(C),a===q?T[a].p(C,x):(Qt(),pe(T[q],1,1,()=>{T[q]=null}),Lt(),c=T[a],c?c.p(C,x):(c=T[a]=v[a](C),c.c()),fe(c,1),c.m(i,null))},i(C){l||(fe(c),l=!0)},o(C){pe(c),l=!1},d(C){C&&J(i),T[a].d(),g=!1,Se(f)}}}function Wr(s,i,a){const c=kn();let l=!1,g;Xe.subscribe(S=>a(1,g=S));let f;return Le.subscribe(S=>a(2,f=S)),[l,g,f,c,()=>a(0,l=!0),()=>a(0,l=!1),S=>xr(S.id),S=>{Le.set(S),localStorage.setItem("ccv",`${S.id}`)},async()=>c("save"),async()=>{let S=prompt("What do you name the new canvas: ");await $t(S)},()=>Cr(),()=>a(0,l=!1)]}class Vr extends qe{constructor(i){super(),Oe(this,i,Wr,Br,xe,{})}}const{window:Fr}=Cn;function Ur(s){let i,a,c,l,g;return{c(){i=V("canvas"),a=ce(),c=V("div"),I(i,"class","svelte-attco8"),_e(i,"nocursor",s[1]!="move"),_e(i,"movecursor",s[1]=="move"),I(c,"class","brush svelte-attco8"),_e(c,"hide",s[1]=="move"),he(c,"width",`${s[2].width}px`),he(c,"height",`${s[2].width}px`),he(c,"top",`${s[5]}px`),he(c,"left",`${s[4]}px`),he(c,"border",`1px solid ${s[2].color}`)},m(f,v){Y(f,i,v),s[10](i),Y(f,a,v),Y(f,c,v),s[11](c),l||(g=[re(Fr,"resize",s[6]),re(i,"mousedown",s[8]),re(i,"mousemove",s[7]),re(i,"mouseup",s[9])],l=!0)},p(f,[v]){v&2&&_e(i,"nocursor",f[1]!="move"),v&2&&_e(i,"movecursor",f[1]=="move"),v&2&&_e(c,"hide",f[1]=="move"),v&4&&he(c,"width",`${f[2].width}px`),v&4&&he(c,"height",`${f[2].width}px`),v&32&&he(c,"top",`${f[5]}px`),v&16&&he(c,"left",`${f[4]}px`),v&4&&he(c,"border",`1px solid ${f[2].color}`)},i:K,o:K,d(f){f&&J(i),s[10](null),f&&J(a),f&&J(c),s[11](null),l=!1,Se(g)}}}function Gr(s,i,a){let c=kn(),l;Ne.subscribe(d=>a(1,l=d));let g;Dt.subscribe(d=>a(2,g=d));let f,v,T=!1,k,C=0,x=0,q=newVector(500,500);function $(){a(0,f.width=window.innerWidth,f),a(0,f.height=window.innerHeight,f)}function R(d){a(4,C=d.clientX),a(5,x=d.clientY),!!T&&(l=="pen"||l=="eraser")&&j(d)}function S(d,_){let O=newVector(d,_);if(q.distance(O)>8){let z=q.sub(O).norm().mul(10);return O.add(z)}return q}function j({clientX:d,clientY:_}){g.drag&&l!="eraser"?q=S(d,_):(q.x=d,q.y=_),v.lineTo(q.x,q.y),v.stroke(),v.beginPath(),v.moveTo(q.x,q.y)}function Q(){v.globalCompositeOperation="source-over",v.lineWidth=g.width,v.lineCap="round",v.strokeStyle="white",a(0,f.style.opacity=".5",f)}function X(){v.lineWidth=g.width,v.lineCap="round",v.strokeStyle=g.color,a(0,f.style.opacity="",f)}function le(d){d.button==0&&(T=!0,l=="pen"?X():l=="eraser"&&Q(),q.x=d.clientX,q.y=d.clientY,v.beginPath(),v.moveTo(d.clientX,d.clientY),R(d))}async function Ce({button:d}){d==0&&(T=!1,l=="pen"?c("imgout",{width:f.width,height:f.height,image:await createImageBitmap(v.getImageData(0,0,f.width,f.height))}):l=="eraser"&&c("imgoute",{width:f.width,height:f.height,image:await createImageBitmap(v.getImageData(0,0,f.width,f.height))}),setTimeout(()=>{v.clearRect(0,0,f.width,f.height)},60))}mr(()=>$());function ge(d){Qe[d?"unshift":"push"](()=>{f=d,a(0,f)})}function m(d){Qe[d?"unshift":"push"](()=>{k=d,a(3,k)})}return s.$$.update=()=>{s.$$.dirty&1&&f&&(v=f.getContext("2d"))},[f,l,g,k,C,x,$,R,le,Ce,ge,m]}class Kr extends qe{constructor(i){super(),Oe(this,i,Gr,Ur,xe,{})}}const{window:dt}=Cn;function fn(s,i,a){const c=s.slice();return c[28]=i[a],c}function hn(s,i,a){const c=s.slice();c[31]=i[a],c[34]=i,c[35]=a;const l=c[31];return c[32]=l.x,c[33]=l.y,c}function pn(s){let i,a=s[34],c=s[35];const l=()=>s[23](i,a,c),g=()=>s[23](null,a,c);return{c(){i=V("canvas"),I(i,"width",te),I(i,"height",te),he(i,"top",`${s[33]*te}px`),he(i,"left",`${s[32]*te}px`)},m(f,v){Y(f,i,v),l()},p(f,v){s=f,(a!==s[34]||c!==s[35])&&(g(),a=s[34],c=s[35],l()),v[0]&512&&he(i,"top",`${s[33]*te}px`),v[0]&512&&he(i,"left",`${s[32]*te}px`)},d(f){f&&J(i),g()}}}function dn(s){let i,a=s[28],c=[];for(let l=0;l<a.length;l+=1)c[l]=pn(hn(s,a,l));return{c(){for(let l=0;l<c.length;l+=1)c[l].c();i=hr()},m(l,g){for(let f=0;f<c.length;f+=1)c[f].m(l,g);Y(l,i,g)},p(l,g){if(g[0]&512){a=l[28];let f;for(f=0;f<a.length;f+=1){const v=hn(l,a,f);c[f]?c[f].p(v,g):(c[f]=pn(v),c[f].c(),c[f].m(i.parentNode,i))}for(;f<c.length;f+=1)c[f].d(1);c.length=a.length}},d(l){Rt(c,l),l&&J(i)}}}function Jr(s){let i,a,c,l,g=s[9],f=[];for(let v=0;v<g.length;v+=1)f[v]=dn(fn(s,g,v));return{c(){i=V("div"),a=V("div");for(let v=0;v<f.length;v+=1)f[v].c();I(a,"class","shift svelte-osbjy1"),he(a,"top",`${-s[3]}px`),he(a,"left",`${-s[2]}px`),I(i,"class","view svelte-osbjy1")},m(v,T){Y(v,i,T),M(i,a);for(let k=0;k<f.length;k+=1)f[k].m(a,null);c||(l=[re(dt,"resize",s[13]),re(dt,"mousedown",s[20]),re(dt,"mouseup",s[21]),re(dt,"mousemove",s[22])],c=!0)},p(v,T){if(T[0]&512){g=v[9];let k;for(k=0;k<g.length;k+=1){const C=fn(v,g,k);f[k]?f[k].p(C,T):(f[k]=dn(C),f[k].c(),f[k].m(a,null))}for(;k<f.length;k+=1)f[k].d(1);f.length=g.length}T[0]&8&&he(a,"top",`${-v[3]}px`),T[0]&4&&he(a,"left",`${-v[2]}px`)},i:K,o:K,d(v){v&&J(i),Rt(f,v),c=!1,Se(l)}}}let te=480;function zr(s,i,a){let c;Ne.subscribe(U=>a(0,c=U));let l,g,f=0,v=0,T=0,k=0,C=0,x=0,q=C,$=x,R={},S={},j=[],Q,X=!1;function le(){a(18,T=Math.floor(C/te)),a(19,k=Math.floor(x/te)),a(2,f=Math.abs(T*te-C)),a(3,v=Math.abs(k*te-x))}function Ce(){g=(window.innerWidth+te)/te,g=g%1>0?Math.floor(g)+1:g}function ge(){let U=[];for(let H=0;H<g;H++){let A=[];for(let ie=0;ie<g;ie++)A.push({x:H,y:ie,element:null});U.push(A)}a(9,j=U)}async function m(){for(let U of j)for(let H of U){let A=`${T+H.x},${k+H.y}`;if(A in R){if(H.element!=null){let ie=H.element.getContext("2d");ie.clearRect(0,0,te,te),R[A]!=null&&(A in S||(S[A]=await createImageBitmap(R[A])),ie.drawImage(S[A],0,0))}}else a(8,R[A]=null,R),H.element!=null&&H.element.getContext("2d").clearRect(0,0,te,te)}}const d=async U=>{for(let H of j)for(let A of H){let ie=`${T+A.x},${k+A.y}`,de=A.element.getContext("2d");de.globalCompositeOperation="source-over",de.drawImage(U,-(A.x*te-f),-(A.y*te-v)),a(8,R[ie]=de.getImageData(0,0,te,te),R)}},_=async U=>{for(let H of j)for(let A of H){let ie=`${T+A.x},${k+A.y}`,de=A.element.getContext("2d");de.globalCompositeOperation="destination-out",de.drawImage(U,-(A.x*te-f)-1,-(A.y*te-v)-1),a(8,R[ie]=de.getImageData(0,0,te,te),R)}},O=()=>{an(l,R)};le(),Ce(),ge(),Le.subscribe(async U=>{!U||(a(1,l=U.id),a(6,q=C),a(7,$=x),a(8,R=U.blocks),S={},console.log(R),le(),m())});const P=({button:U,clientX:H,clientY:A})=>{(U==1||U==0&&c=="move")&&(a(11,X=!0),a(10,Q={x:H,y:A}))},z=({button:U})=>{(U==1||U==0&&c=="move")&&(a(11,X=!1),a(6,q=C),a(7,$=x)),setTimeout(()=>an(l,R),5e3)},oe=({clientX:U,clientY:H})=>{X&&(a(4,C=Q.x-U+q),a(5,x=Q.y-H+$),le())};function W(U,H,A){Qe[U?"unshift":"push"](()=>{H[A].element=U,a(9,j)})}return s.$$.update=()=>{s.$$.dirty[0]&786432&&T!=null&&k!=null&&m()},[c,l,f,v,C,x,q,$,R,j,Q,X,le,Ce,m,d,_,O,T,k,P,z,oe,W]}class Yr extends qe{constructor(i){super(),Oe(this,i,zr,Jr,xe,{drawToMC:15,eraserMC:16,saveCanvas:17},null,[-1,-1])}get drawToMC(){return this.$$.ctx[15]}get eraserMC(){return this.$$.ctx[16]}get saveCanvas(){return this.$$.ctx[17]}}function mn(s){let i,a,c,l,g;return{c(){i=V("label"),a=Re("Color: "),c=V("input"),I(c,"type","color"),I(c,"class","svelte-14xd3si"),I(i,"for",""),I(i,"class","svelte-14xd3si")},m(f,v){Y(f,i,v),M(i,a),M(i,c),Ye(c,s[1]),l||(g=re(c,"input",s[5]),l=!0)},p(f,v){v&2&&Ye(c,f[1])},d(f){f&&J(i),l=!1,g()}}}function yn(s){let i,a,c,l,g;return{c(){i=V("label"),a=Re("Drag: "),c=V("input"),I(c,"type","checkbox"),I(c,"class","svelte-14xd3si"),I(i,"for",""),I(i,"class","svelte-14xd3si")},m(f,v){Y(f,i,v),M(i,a),M(i,c),Ye(c,s[2]),l||(g=re(c,"change",s[6]),l=!0)},p(f,v){v&4&&Ye(c,f[2])},d(f){f&&J(i),l=!1,g()}}}function Xr(s){let i,a,c,l,g,f,v,T,k=s[3]=="pen"&&mn(s),C=s[3]=="pen"&&yn(s);return{c(){i=V("div"),a=V("label"),c=Re("Size: "),l=V("input"),g=ce(),k&&k.c(),f=ce(),C&&C.c(),I(l,"type","number"),I(l,"class","svelte-14xd3si"),I(a,"for",""),I(a,"class","svelte-14xd3si"),I(i,"class","props svelte-14xd3si")},m(x,q){Y(x,i,q),M(i,a),M(a,c),M(a,l),Ye(l,s[0]),M(i,g),k&&k.m(i,null),M(i,f),C&&C.m(i,null),v||(T=re(l,"input",s[4]),v=!0)},p(x,[q]){q&1&&bn(l.value)!==x[0]&&Ye(l,x[0]),x[3]=="pen"?k?k.p(x,q):(k=mn(x),k.c(),k.m(i,f)):k&&(k.d(1),k=null),x[3]=="pen"?C?C.p(x,q):(C=yn(x),C.c(),C.m(i,null)):C&&(C.d(1),C=null)},i:K,o:K,d(x){x&&J(i),k&&k.d(),C&&C.d(),v=!1,T()}}}function Hr(s,i,a){let c;Dt.subscribe(x=>c=x);let l;Ne.subscribe(x=>a(3,l=x));let g=c.width,f=c.color,v=c.drag;function T(){g=bn(this.value),a(0,g)}function k(){f=this.value,a(1,f)}function C(){v=this.value,a(2,v)}return s.$$.update=()=>{s.$$.dirty&7&&Dt.set({width:g,color:f,drag:v})},[g,f,v,l,T,k,C]}class Zr extends qe{constructor(i){super(),Oe(this,i,Hr,Xr,xe,{})}}function vn(s){let i,a,c,l,g,f,v,T,k,C,x,q,$,R;a=new Dr({}),g=new Vr({}),g.$on("save",s[11]);let S=(s[1]=="pen"||s[1]=="eraser")&&gn();return{c(){i=V("div"),je(a.$$.fragment),c=ce(),l=V("div"),je(g.$$.fragment),f=ce(),S&&S.c(),v=ce(),T=V("div"),k=ce(),C=V("p"),C.textContent="Controls: Middle mouse button for movement, shift to hide ui overlay. If there is an error report and restart.",x=ce(),q=V("iframe"),I(i,"class","tb"),I(l,"class","sb svelte-1ccz2k"),I(C,"id","ist"),I(C,"class","svelte-1ccz2k"),I(q,"id","gfl"),cr(q.src,$="/DrawingApp/dist/ghbtn.html")||I(q,"src",$),I(q,"frameborder","0"),I(q,"width","200"),I(q,"height","28"),I(q,"allowtransparency","true"),I(q,"class","svelte-1ccz2k")},m(j,Q){Y(j,i,Q),Te(a,i,null),Y(j,c,Q),Y(j,l,Q),Te(g,l,null),M(l,f),S&&S.m(l,null),M(l,v),M(l,T),Y(j,k,Q),Y(j,C,Q),Y(j,x,Q),Y(j,q,Q),R=!0},p(j,Q){j[1]=="pen"||j[1]=="eraser"?S?Q&2&&fe(S,1):(S=gn(),S.c(),fe(S,1),S.m(l,v)):S&&(Qt(),pe(S,1,1,()=>{S=null}),Lt())},i(j){R||(fe(a.$$.fragment,j),fe(g.$$.fragment,j),fe(S),R=!0)},o(j){pe(a.$$.fragment,j),pe(g.$$.fragment,j),pe(S),R=!1},d(j){j&&J(i),Ee(a),j&&J(c),j&&J(l),Ee(g),S&&S.d(),j&&J(k),j&&J(C),j&&J(x),j&&J(q)}}}function gn(s){let i,a;return i=new Zr({}),{c(){je(i.$$.fragment)},m(c,l){Te(i,c,l),a=!0},i(c){a||(fe(i.$$.fragment,c),a=!0)},o(c){pe(i.$$.fragment,c),a=!1},d(c){Ee(i,c)}}}function eo(s){let i,a,c,l,g,f,v,T,k,C,x;function q(Q){s[6](Q)}function $(Q){s[7](Q)}function R(Q){s[8](Q)}let S={};s[2]!==void 0&&(S.drawToMC=s[2]),s[3]!==void 0&&(S.eraserMC=s[3]),s[4]!==void 0&&(S.saveCanvas=s[4]),a=new Yr({props:S}),Qe.push(()=>Ot(a,"drawToMC",q)),Qe.push(()=>Ot(a,"eraserMC",$)),Qe.push(()=>Ot(a,"saveCanvas",R)),v=new Kr({}),v.$on("imgout",s[9]),v.$on("imgoute",s[10]);let j=!s[0]&&vn(s);return{c(){i=V("main"),je(a.$$.fragment),f=ce(),je(v.$$.fragment),T=ce(),j&&j.c(),I(i,"class","svelte-1ccz2k")},m(Q,X){Y(Q,i,X),Te(a,i,null),M(i,f),Te(v,i,null),M(i,T),j&&j.m(i,null),k=!0,C||(x=re(window,"keydown",s[5]),C=!0)},p(Q,[X]){const le={};!c&&X&4&&(c=!0,le.drawToMC=Q[2],Et(()=>c=!1)),!l&&X&8&&(l=!0,le.eraserMC=Q[3],Et(()=>l=!1)),!g&&X&16&&(g=!0,le.saveCanvas=Q[4],Et(()=>g=!1)),a.$set(le),Q[0]?j&&(Qt(),pe(j,1,1,()=>{j=null}),Lt()):j?(j.p(Q,X),X&1&&fe(j,1)):(j=vn(Q),j.c(),fe(j,1),j.m(i,null))},i(Q){k||(fe(a.$$.fragment,Q),fe(v.$$.fragment,Q),fe(j),k=!0)},o(Q){pe(a.$$.fragment,Q),pe(v.$$.fragment,Q),pe(j),k=!1},d(Q){Q&&J(i),Ee(a),Ee(v),j&&j.d(),C=!1,x()}}}function to(s,i,a){let c=!1,l;Ne.subscribe(S=>a(1,l=S)),Xe.subscribe(S=>S);let g,f,v;const T=({shiftKey:S})=>{S&&a(0,c=!c)};function k(S){g=S,a(2,g)}function C(S){f=S,a(3,f)}function x(S){v=S,a(4,v)}return[c,l,g,f,v,T,k,C,x,({detail:S})=>{g(S.image)},({detail:S})=>{f(S.image)},()=>v()]}class no extends qe{constructor(i){super(),Oe(this,i,to,eo,xe,{})}}window.gcd=function(s,i){return i==0?s:gcd(i,s%i)};window.aspectRatio=function(s,i){let a=gcd(s,i);return[s/a,i/a]};class Pe{constructor(i=1,a=1){Tt(this,"x");Tt(this,"y");this.x=i,this.y=a}len(){return Math.sqrt(this.x**2+this.y**2)}norm(){let i=this.len();return new Pe(this.x/i,this.y/i)}distance(i){var a=this.x-i.x,c=this.y-i.y,l=Math.sqrt(a*a+c*c);return Math.abs(l)}angle(i){return(-(Math.atan2(this.x-i.x,this.y-i.y)*(180/Math.PI))%360+360)%360}add(i){let a=this.x+i.x,c=this.y+i.y;return new Pe(a,c)}sub(i){let a=this.x-i.x,c=this.y-i.y;return new Pe(a,c)}mul(i){return new Pe(this.x*i,this.y*i)}clone(){return new Pe(this.x,this.y)}}window.newVector=(s=0,i=0)=>new Pe(s,i);new no({target:document.getElementById("app")});
